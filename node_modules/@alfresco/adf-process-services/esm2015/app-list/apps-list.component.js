/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { AppsProcessService, TranslationService, CustomEmptyContentTemplateDirective } from '@alfresco/adf-core';
import { Component, EventEmitter, Input, Output, ContentChild } from '@angular/core';
import { Observable, of } from 'rxjs';
import { IconModel } from './icon.model';
import { share } from 'rxjs/operators';
export class AppsListComponent {
    /**
     * @param {?} appsProcessService
     * @param {?} translationService
     */
    constructor(appsProcessService, translationService) {
        this.appsProcessService = appsProcessService;
        this.translationService = translationService;
        /**
         * (**required**) Defines the layout of the apps. There are two possible
         * values, "GRID" and "LIST".
         */
        this.layoutType = AppsListComponent.LAYOUT_GRID;
        /**
         * Emitted when an app entry is clicked.
         */
        this.appClick = new EventEmitter();
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        this.appList = [];
        this.loading = false;
        this.hasEmptyCustomContentTemplate = false;
        this.apps$ = new Observable((observer) => this.appsObserver = observer)
            .pipe(share());
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!this.isValidType()) {
            this.setDefaultLayoutType();
        }
        this.apps$.subscribe((app) => {
            this.appList.push(app);
        });
        this.iconsMDL = new IconModel();
        this.load();
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        if (this.emptyCustomContent) {
            this.hasEmptyCustomContentTemplate = true;
        }
    }
    /**
     * @private
     * @return {?}
     */
    load() {
        this.loading = true;
        this.appsProcessService.getDeployedApplications()
            .subscribe((res) => {
            this.filterApps(res).forEach((app) => {
                if (this.isDefaultApp(app)) {
                    app.theme = AppsListComponent.DEFAULT_TASKS_APP_THEME;
                    app.icon = AppsListComponent.DEFAULT_TASKS_APP_ICON;
                    this.appsObserver.next(app);
                }
                else if (app.deploymentId) {
                    this.appsObserver.next(app);
                }
                this.loading = false;
            });
        }, (err) => {
            this.error.emit(err);
            this.loading = false;
        });
    }
    /**
     * @param {?} app
     * @return {?}
     */
    isDefaultApp(app) {
        return app.defaultAppId === AppsListComponent.DEFAULT_TASKS_APP;
    }
    /**
     * @param {?} app
     * @return {?}
     */
    getAppName(app) {
        return this.isDefaultApp(app)
            ? this.translationService.get(AppsListComponent.DEFAULT_TASKS_APP_NAME)
            : of(app.name);
    }
    /**
     * Pass the selected app as next
     * @param {?} app
     * @return {?}
     */
    selectApp(app) {
        this.currentApp = app;
        this.appClick.emit(app);
    }
    /**
     * Return true if the appId is the current app
     * @param {?} appId
     * @return {?}
     */
    isSelected(appId) {
        return (this.currentApp !== undefined && appId === this.currentApp.id);
    }
    /**
     * @private
     * @param {?} apps
     * @return {?}
     */
    filterApps(apps) {
        /** @type {?} */
        let filteredApps = [];
        if (this.filtersAppId) {
            apps.filter((app) => {
                this.filtersAppId.forEach((filter) => {
                    if (app.defaultAppId === filter.defaultAppId ||
                        app.deploymentId === filter.deploymentId ||
                        app.name === filter.name ||
                        app.id === filter.id ||
                        app.modelId === filter.modelId ||
                        app.tenantId === filter.tenantId) {
                        filteredApps.push(app);
                    }
                });
            });
        }
        else {
            return apps;
        }
        return filteredApps;
    }
    /**
     * Check if the value of the layoutType property is an allowed value
     * @return {?}
     */
    isValidType() {
        if (this.layoutType && (this.layoutType === AppsListComponent.LAYOUT_LIST || this.layoutType === AppsListComponent.LAYOUT_GRID)) {
            return true;
        }
        return false;
    }
    /**
     * Assign the default value to LayoutType
     * @return {?}
     */
    setDefaultLayoutType() {
        this.layoutType = AppsListComponent.LAYOUT_GRID;
    }
    /**
     * Return true if the layout type is LIST
     * @return {?}
     */
    isList() {
        return this.layoutType === AppsListComponent.LAYOUT_LIST;
    }
    /**
     * Return true if the layout type is GRID
     * @return {?}
     */
    isGrid() {
        return this.layoutType === AppsListComponent.LAYOUT_GRID;
    }
    /**
     * @return {?}
     */
    isEmpty() {
        return this.appList.length === 0;
    }
    /**
     * @return {?}
     */
    isLoading() {
        return this.loading;
    }
    /**
     * @param {?} app
     * @return {?}
     */
    getTheme(app) {
        return app.theme ? app.theme : '';
    }
    /**
     * @param {?} app
     * @return {?}
     */
    getBackgroundIcon(app) {
        return this.iconsMDL.mapGlyphiconToMaterialDesignIcons(app.icon);
    }
}
AppsListComponent.LAYOUT_LIST = 'LIST';
AppsListComponent.LAYOUT_GRID = 'GRID';
AppsListComponent.DEFAULT_TASKS_APP = 'tasks';
AppsListComponent.DEFAULT_TASKS_APP_NAME = 'ADF_TASK_LIST.APPS.TASK_APP_NAME';
AppsListComponent.DEFAULT_TASKS_APP_THEME = 'theme-2';
AppsListComponent.DEFAULT_TASKS_APP_ICON = 'glyphicon-asterisk';
AppsListComponent.DEFAULT_TASKS_APP_MATERIAL_ICON = 'favorite_border';
AppsListComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-apps',
                template: "<div class=\"menu-container\" *ngIf=\"!isEmpty()\">\n    <mat-list *ngIf=\"isList()\" class=\"adf-app-list\">\n        <mat-list-item class=\"adf-app-list-item\" (click)=\"selectApp(app)\" (keyup.enter)=\"selectApp(app)\" *ngFor=\"let app of appList\" tabindex=\"0\" role=\"button\" title=\"{{app.name}}\">\n            <mat-icon matListIcon>touch_app</mat-icon>\n            <span matLine>{{getAppName(app) | async}}</span>\n        </mat-list-item>\n    </mat-list>\n    <div fxLayout=\"row wrap\" *ngIf=\"isGrid()\" class=\"adf-app-listgrid\">\n        <div *ngFor=\"let app of appList\"\n            class=\"adf-app-listgrid-item\"\n            fxFlex=\"33.33333%\" fxFlex.lt-md=\"50%\" fxFlex.lt-sm=\"100%\">\n                <mat-card tabindex=\"0\"\n                    fxLayout=\"column\"\n                    role=\"button\"\n                    class=\"adf-app-listgrid-item-card\"\n                    title=\"{{getAppName(app) | async}}\"\n                    [ngClass]=\"[getTheme(app)]\"\n                    (click)=\"selectApp(app)\"\n                    (keyup.enter)=\"selectApp(app)\">\n                        <div class=\"adf-app-listgrid-item-card-logo\">\n                            <mat-icon class=\"adf-app-listgrid-item-card-logo-icon\">{{getBackgroundIcon(app)}}</mat-icon>\n                        </div>\n                        <div mat-card-title class=\"adf-app-listgrid-item-card-title\">\n                            <h1>{{getAppName(app) | async}}</h1>\n                        </div>\n                        <mat-card-subtitle class=\"adf-app-listgrid-item-card-subtitle\" fxFlex=\"1 0 auto\">\n                            <div class=\"adf-line-clamp\">{{app.description}}</div>\n                        </mat-card-subtitle>\n\n                        <mat-card-actions class=\"adf-app-listgrid-item-card-actions\">\n                            <mat-icon class=\"adf-app-listgrid-item-card-actions-icon\" *ngIf=\"isSelected(app.id)\">done</mat-icon>\n                        </mat-card-actions>\n                </mat-card>\n        </div>\n    </div>\n</div>\n\n<ng-container *ngIf=\"isLoading(); else empty\">\n    <div class=\"adf-app-list-spinner\">\n        <mat-spinner></mat-spinner>\n    </div>\n</ng-container>\n\n<ng-template #empty>\n    <div class=\"adf-app-list-empty\" *ngIf=\"isEmpty()\">\n        <ng-content select=\"adf-custom-empty-content\" *ngIf=\"hasEmptyCustomContentTemplate; else defaultEmptyTemplate\" class=\"adf-custom-empty-template\"></ng-content>\n\n        <ng-template #defaultEmptyTemplate>\n            <adf-empty-content\n                icon=\"apps\"\n                [title]=\"'ADF_TASK_LIST.APPS.TITLE' | translate\"\n                [subtitle]=\"'ADF_TASK_LIST.APPS.SUBTITLE' | translate\">\n            </adf-empty-content>\n        </ng-template>\n    </div>\n</ng-template>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
AppsListComponent.ctorParameters = () => [
    { type: AppsProcessService },
    { type: TranslationService }
];
AppsListComponent.propDecorators = {
    emptyCustomContent: [{ type: ContentChild, args: [CustomEmptyContentTemplateDirective,] }],
    layoutType: [{ type: Input }],
    filtersAppId: [{ type: Input }],
    appClick: [{ type: Output }],
    error: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    AppsListComponent.LAYOUT_LIST;
    /** @type {?} */
    AppsListComponent.LAYOUT_GRID;
    /** @type {?} */
    AppsListComponent.DEFAULT_TASKS_APP;
    /** @type {?} */
    AppsListComponent.DEFAULT_TASKS_APP_NAME;
    /** @type {?} */
    AppsListComponent.DEFAULT_TASKS_APP_THEME;
    /** @type {?} */
    AppsListComponent.DEFAULT_TASKS_APP_ICON;
    /** @type {?} */
    AppsListComponent.DEFAULT_TASKS_APP_MATERIAL_ICON;
    /** @type {?} */
    AppsListComponent.prototype.emptyCustomContent;
    /**
     * (**required**) Defines the layout of the apps. There are two possible
     * values, "GRID" and "LIST".
     * @type {?}
     */
    AppsListComponent.prototype.layoutType;
    /**
     * Provides a way to filter the apps to show.
     * @type {?}
     */
    AppsListComponent.prototype.filtersAppId;
    /**
     * Emitted when an app entry is clicked.
     * @type {?}
     */
    AppsListComponent.prototype.appClick;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    AppsListComponent.prototype.error;
    /**
     * @type {?}
     * @private
     */
    AppsListComponent.prototype.appsObserver;
    /** @type {?} */
    AppsListComponent.prototype.apps$;
    /** @type {?} */
    AppsListComponent.prototype.currentApp;
    /** @type {?} */
    AppsListComponent.prototype.appList;
    /**
     * @type {?}
     * @private
     */
    AppsListComponent.prototype.iconsMDL;
    /** @type {?} */
    AppsListComponent.prototype.loading;
    /** @type {?} */
    AppsListComponent.prototype.hasEmptyCustomContentTemplate;
    /**
     * @type {?}
     * @private
     */
    AppsListComponent.prototype.appsProcessService;
    /**
     * @type {?}
     * @private
     */
    AppsListComponent.prototype.translationService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwcy1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImFwcC1saXN0L2FwcHMtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLGtCQUFrQixFQUFFLG1DQUFtQyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDakgsT0FBTyxFQUFvQixTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9HLE9BQU8sRUFBRSxVQUFVLEVBQVksRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRWhELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBT3ZDLE1BQU0sT0FBTyxpQkFBaUI7Ozs7O0lBNEMxQixZQUNZLGtCQUFzQyxFQUN0QyxrQkFBc0M7UUFEdEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUN0Qyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9COzs7OztRQTdCbEQsZUFBVSxHQUFXLGlCQUFpQixDQUFDLFdBQVcsQ0FBQzs7OztRQVFuRCxhQUFRLEdBQW1ELElBQUksWUFBWSxFQUFvQyxDQUFDOzs7O1FBSWhILFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQU9uRCxZQUFPLEdBQXdDLEVBQUUsQ0FBQztRQUlsRCxZQUFPLEdBQVksS0FBSyxDQUFDO1FBRXpCLGtDQUE2QixHQUFZLEtBQUssQ0FBQztRQUt2QyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksVUFBVSxDQUFtQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxRQUFRLENBQUM7YUFD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O0lBR2hILGtDQUNtRDs7Ozs7SUFFbkQseUNBQWlFOztJQUNqRSxrQ0FBb0Q7O0lBRXBELHVDQUE2Qzs7SUFFN0Msb0NBQWtEOzs7OztJQUVsRCxxQ0FBNEI7O0lBRTVCLG9DQUF5Qjs7SUFFekIsMERBQStDOzs7OztJQUczQywrQ0FBOEM7Ozs7O0lBQzlDLCtDQUE4QyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFwcHNQcm9jZXNzU2VydmljZSwgVHJhbnNsYXRpb25TZXJ2aWNlLCBDdXN0b21FbXB0eUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBBZnRlckNvbnRlbnRJbml0LCBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBDb250ZW50Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIE9ic2VydmVyLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWwgfSBmcm9tICcuLi90YXNrLWxpc3QnO1xuaW1wb3J0IHsgSWNvbk1vZGVsIH0gZnJvbSAnLi9pY29uLm1vZGVsJztcbmltcG9ydCB7IHNoYXJlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1hcHBzJyxcbiAgICB0ZW1wbGF0ZVVybDogJ2FwcHMtbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vYXBwcy1saXN0LmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQXBwc0xpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQge1xuXG4gICAgcHVibGljIHN0YXRpYyBMQVlPVVRfTElTVDogc3RyaW5nID0gJ0xJU1QnO1xuICAgIHB1YmxpYyBzdGF0aWMgTEFZT1VUX0dSSUQ6IHN0cmluZyA9ICdHUklEJztcbiAgICBwdWJsaWMgc3RhdGljIERFRkFVTFRfVEFTS1NfQVBQOiBzdHJpbmcgPSAndGFza3MnO1xuICAgIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9UQVNLU19BUFBfTkFNRTogc3RyaW5nID0gJ0FERl9UQVNLX0xJU1QuQVBQUy5UQVNLX0FQUF9OQU1FJztcbiAgICBwdWJsaWMgc3RhdGljIERFRkFVTFRfVEFTS1NfQVBQX1RIRU1FOiBzdHJpbmcgPSAndGhlbWUtMic7XG4gICAgcHVibGljIHN0YXRpYyBERUZBVUxUX1RBU0tTX0FQUF9JQ09OOiBzdHJpbmcgPSAnZ2x5cGhpY29uLWFzdGVyaXNrJztcbiAgICBwdWJsaWMgc3RhdGljIERFRkFVTFRfVEFTS1NfQVBQX01BVEVSSUFMX0lDT046IHN0cmluZyA9ICdmYXZvcml0ZV9ib3JkZXInO1xuXG4gICAgQENvbnRlbnRDaGlsZChDdXN0b21FbXB0eUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSlcbiAgICBlbXB0eUN1c3RvbUNvbnRlbnQ6IEN1c3RvbUVtcHR5Q29udGVudFRlbXBsYXRlRGlyZWN0aXZlO1xuXG4gICAgLyoqICgqKnJlcXVpcmVkKiopIERlZmluZXMgdGhlIGxheW91dCBvZiB0aGUgYXBwcy4gVGhlcmUgYXJlIHR3byBwb3NzaWJsZVxuICAgICAqIHZhbHVlcywgXCJHUklEXCIgYW5kIFwiTElTVFwiLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgbGF5b3V0VHlwZTogc3RyaW5nID0gQXBwc0xpc3RDb21wb25lbnQuTEFZT1VUX0dSSUQ7XG5cbiAgICAvKiogUHJvdmlkZXMgYSB3YXkgdG8gZmlsdGVyIHRoZSBhcHBzIHRvIHNob3cuICovXG4gICAgQElucHV0KClcbiAgICBmaWx0ZXJzQXBwSWQ6IGFueVtdO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhbiBhcHAgZW50cnkgaXMgY2xpY2tlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBhcHBDbGljazogRXZlbnRFbWl0dGVyPEFwcERlZmluaXRpb25SZXByZXNlbnRhdGlvbk1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8QXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWw+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIHByaXZhdGUgYXBwc09ic2VydmVyOiBPYnNlcnZlcjxBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbD47XG4gICAgYXBwcyQ6IE9ic2VydmFibGU8QXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWw+O1xuXG4gICAgY3VycmVudEFwcDogQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWw7XG5cbiAgICBhcHBMaXN0OiBBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbCBbXSA9IFtdO1xuXG4gICAgcHJpdmF0ZSBpY29uc01ETDogSWNvbk1vZGVsO1xuXG4gICAgbG9hZGluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgaGFzRW1wdHlDdXN0b21Db250ZW50VGVtcGxhdGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGFwcHNQcm9jZXNzU2VydmljZTogQXBwc1Byb2Nlc3NTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgICAgICB0aGlzLmFwcHMkID0gbmV3IE9ic2VydmFibGU8QXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWw+KChvYnNlcnZlcikgPT4gdGhpcy5hcHBzT2JzZXJ2ZXIgPSBvYnNlcnZlcilcbiAgICAgICAgICAgICAgICAucGlwZShzaGFyZSgpKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWRUeXBlKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdExheW91dFR5cGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXBwcyQuc3Vic2NyaWJlKChhcHA6IGFueSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hcHBMaXN0LnB1c2goYXBwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaWNvbnNNREwgPSBuZXcgSWNvbk1vZGVsKCk7XG4gICAgICAgIHRoaXMubG9hZCgpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZW1wdHlDdXN0b21Db250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLmhhc0VtcHR5Q3VzdG9tQ29udGVudFRlbXBsYXRlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbG9hZCgpIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5hcHBzUHJvY2Vzc1NlcnZpY2UuZ2V0RGVwbG95ZWRBcHBsaWNhdGlvbnMoKVxuICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlczogQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyQXBwcyhyZXMpLmZvckVhY2goKGFwcDogQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWZhdWx0QXBwKGFwcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC50aGVtZSA9IEFwcHNMaXN0Q29tcG9uZW50LkRFRkFVTFRfVEFTS1NfQVBQX1RIRU1FO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLmljb24gPSBBcHBzTGlzdENvbXBvbmVudC5ERUZBVUxUX1RBU0tTX0FQUF9JQ09OO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBzT2JzZXJ2ZXIubmV4dChhcHApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFwcC5kZXBsb3ltZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwc09ic2VydmVyLm5leHQoYXBwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgaXNEZWZhdWx0QXBwKGFwcCkge1xuICAgICAgICByZXR1cm4gYXBwLmRlZmF1bHRBcHBJZCA9PT0gQXBwc0xpc3RDb21wb25lbnQuREVGQVVMVF9UQVNLU19BUFA7XG4gICAgfVxuXG4gICAgZ2V0QXBwTmFtZShhcHApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNEZWZhdWx0QXBwKGFwcClcbiAgICAgICAgICAgID8gdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuZ2V0KEFwcHNMaXN0Q29tcG9uZW50LkRFRkFVTFRfVEFTS1NfQVBQX05BTUUpXG4gICAgICAgICAgICA6IG9mKGFwcC5uYW1lKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXNzIHRoZSBzZWxlY3RlZCBhcHAgYXMgbmV4dFxuICAgICAqIEBwYXJhbSBhcHBcbiAgICAgKi9cbiAgICBwdWJsaWMgc2VsZWN0QXBwKGFwcDogQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWwpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50QXBwID0gYXBwO1xuICAgICAgICB0aGlzLmFwcENsaWNrLmVtaXQoYXBwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgYXBwSWQgaXMgdGhlIGN1cnJlbnQgYXBwXG4gICAgICogQHBhcmFtIGFwcElkXG4gICAgICovXG4gICAgaXNTZWxlY3RlZChhcHBJZDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodGhpcy5jdXJyZW50QXBwICE9PSB1bmRlZmluZWQgJiYgYXBwSWQgPT09IHRoaXMuY3VycmVudEFwcC5pZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWx0ZXJBcHBzKGFwcHM6IEFwcERlZmluaXRpb25SZXByZXNlbnRhdGlvbk1vZGVsIFtdKTogQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWxbXSB7XG4gICAgICAgIGxldCBmaWx0ZXJlZEFwcHM6IEFwcERlZmluaXRpb25SZXByZXNlbnRhdGlvbk1vZGVsW10gPSBbXTtcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyc0FwcElkKSB7XG4gICAgICAgICAgICBhcHBzLmZpbHRlcigoYXBwOiBBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyc0FwcElkLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXBwLmRlZmF1bHRBcHBJZCA9PT0gZmlsdGVyLmRlZmF1bHRBcHBJZCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLmRlcGxveW1lbnRJZCA9PT0gZmlsdGVyLmRlcGxveW1lbnRJZCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLm5hbWUgPT09IGZpbHRlci5uYW1lIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAuaWQgPT09IGZpbHRlci5pZCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLm1vZGVsSWQgPT09IGZpbHRlci5tb2RlbElkIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAudGVuYW50SWQgPT09IGZpbHRlci50ZW5hbnRJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRBcHBzLnB1c2goYXBwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlsdGVyZWRBcHBzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBvZiB0aGUgbGF5b3V0VHlwZSBwcm9wZXJ0eSBpcyBhbiBhbGxvd2VkIHZhbHVlXG4gICAgICovXG4gICAgaXNWYWxpZFR5cGUoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLmxheW91dFR5cGUgJiYgKHRoaXMubGF5b3V0VHlwZSA9PT0gQXBwc0xpc3RDb21wb25lbnQuTEFZT1VUX0xJU1QgfHwgdGhpcy5sYXlvdXRUeXBlID09PSBBcHBzTGlzdENvbXBvbmVudC5MQVlPVVRfR1JJRCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NpZ24gdGhlIGRlZmF1bHQgdmFsdWUgdG8gTGF5b3V0VHlwZVxuICAgICAqL1xuICAgIHNldERlZmF1bHRMYXlvdXRUeXBlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmxheW91dFR5cGUgPSBBcHBzTGlzdENvbXBvbmVudC5MQVlPVVRfR1JJRDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgbGF5b3V0IHR5cGUgaXMgTElTVFxuICAgICAqL1xuICAgIGlzTGlzdCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGF5b3V0VHlwZSA9PT0gQXBwc0xpc3RDb21wb25lbnQuTEFZT1VUX0xJU1Q7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGxheW91dCB0eXBlIGlzIEdSSURcbiAgICAgKi9cbiAgICBpc0dyaWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmxheW91dFR5cGUgPT09IEFwcHNMaXN0Q29tcG9uZW50LkxBWU9VVF9HUklEO1xuICAgIH1cblxuICAgIGlzRW1wdHkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcExpc3QubGVuZ3RoID09PSAwO1xuICAgIH1cblxuICAgIGlzTG9hZGluZygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGluZztcbiAgICB9XG5cbiAgICBnZXRUaGVtZShhcHA6IEFwcERlZmluaXRpb25SZXByZXNlbnRhdGlvbk1vZGVsKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGFwcC50aGVtZSA/IGFwcC50aGVtZSA6ICcnO1xuICAgIH1cblxuICAgIGdldEJhY2tncm91bmRJY29uKGFwcDogQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWwpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5pY29uc01ETC5tYXBHbHlwaGljb25Ub01hdGVyaWFsRGVzaWduSWNvbnMoYXBwLmljb24pO1xuICAgIH1cblxufVxuIl19