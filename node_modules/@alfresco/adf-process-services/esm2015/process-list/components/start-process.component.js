/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewChild, ViewEncapsulation } from '@angular/core';
import { ActivitiContentService, AppConfigService, AppConfigValues, StartFormComponent, FormRenderingService } from '@alfresco/adf-core';
import { ProcessDefinitionRepresentation } from './../models/process-definition.model';
import { ProcessService } from './../services/process.service';
import { AttachFileWidgetComponent, AttachFolderWidgetComponent } from '../../content-widget';
import { FormControl, Validators } from '@angular/forms';
import { map } from 'rxjs/operators';
import { MatAutocompleteTrigger } from '@angular/material';
export class StartProcessInstanceComponent {
    /**
     * @param {?} activitiProcess
     * @param {?} formRenderingService
     * @param {?} activitiContentService
     * @param {?} appConfig
     */
    constructor(activitiProcess, formRenderingService, activitiContentService, appConfig) {
        this.activitiProcess = activitiProcess;
        this.formRenderingService = formRenderingService;
        this.activitiContentService = activitiContentService;
        this.appConfig = appConfig;
        this.MAX_LENGTH = 255;
        /**
         * (optional) Name to assign to the current process.
         */
        this.name = '';
        /**
         * Hide or show the process selection dropdown.
         */
        this.showSelectProcessDropdown = true;
        /**
         * (optional) Parameter to enable selection of process when filtering.
         */
        this.processFilterSelector = true;
        /**
         * Emitted when the process starts.
         */
        this.start = new EventEmitter();
        /**
         * Emitted when the process is canceled.
         */
        this.cancel = new EventEmitter();
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        this.processDefinitions = [];
        this.selectedProcessDef = new ProcessDefinitionRepresentation();
        this.errorMessageId = '';
        this.maxProcessNameLength = this.MAX_LENGTH;
        this.formRenderingService.setComponentTypeResolver('upload', () => AttachFileWidgetComponent, true);
        this.formRenderingService.setComponentTypeResolver('select-folder', () => AttachFolderWidgetComponent, true);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.processNameInput = new FormControl(this.name, [Validators.required, Validators.maxLength(this.maxProcessNameLength)]);
        this.processDefinitionInput = new FormControl();
        this.loadStartProcess();
        this.processNameInput.valueChanges.subscribe((name) => this.name = name);
        this.filteredProcesses = this.processDefinitionInput.valueChanges
            .pipe(map((value) => this._filter(value)));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes['values'] && changes['values'].currentValue) {
            this.moveNodeFromCStoPS();
        }
        if (changes['appId'] && changes['appId'].currentValue) {
            this.appId = changes['appId'].currentValue;
        }
        this.loadStartProcess();
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    _filter(value) {
        if (value !== null && value !== undefined) {
            /** @type {?} */
            const filterValue = value.toLowerCase();
            /** @type {?} */
            let filteredProcess = this.processDefinitions.filter((option) => option.name.toLowerCase().includes(filterValue));
            if (this.processFilterSelector) {
                this.selectedProcessDef = this.getSelectedProcess(filterValue);
            }
            return filteredProcess;
        }
    }
    /**
     * @param {?} selectedProcess
     * @return {?}
     */
    getSelectedProcess(selectedProcess) {
        /** @type {?} */
        let processSelected = this.processDefinitions.find((process) => process.name.toLowerCase() === selectedProcess);
        if (!processSelected) {
            processSelected = new ProcessDefinitionRepresentation();
        }
        return processSelected;
    }
    /**
     * @return {?}
     */
    loadStartProcess() {
        this.resetSelectedProcessDefinition();
        this.resetErrorMessage();
        this.activitiProcess.getProcessDefinitions(this.appId).subscribe((processDefinitionRepresentations) => {
            this.processDefinitions = processDefinitionRepresentations;
            if (!this.isProcessDefinitionsEmpty()) {
                if (this.processDefinitions.length === 1) {
                    this.selectedProcessDef = this.processDefinitions[0];
                }
                if (this.processDefinitionName) {
                    /** @type {?} */
                    let selectedProcess = this.processDefinitions.find((currentProcessDefinition) => {
                        return currentProcessDefinition.name === this.processDefinitionName;
                    });
                    if (selectedProcess) {
                        this.selectedProcessDef = selectedProcess;
                    }
                }
                this.processDefinitionInput.setValue(this.selectedProcessDef.name);
            }
        }, () => {
            this.errorMessageId = 'ADF_PROCESS_LIST.START_PROCESS.ERROR.LOAD_PROCESS_DEFS';
        });
    }
    /**
     * @return {?}
     */
    isProcessDefinitionsEmpty() {
        return this.processDefinitions.length === 0;
    }
    /**
     * @return {?}
     */
    getAlfrescoRepositoryName() {
        /** @type {?} */
        let alfrescoRepositoryName = this.appConfig.get(AppConfigValues.ALFRESCO_REPOSITORY_NAME);
        if (!alfrescoRepositoryName) {
            alfrescoRepositoryName = 'alfresco-1';
        }
        return alfrescoRepositoryName + 'Alfresco';
    }
    /**
     * @return {?}
     */
    moveNodeFromCStoPS() {
        /** @type {?} */
        let accountIdentifier = this.getAlfrescoRepositoryName();
        for (let key in this.values) {
            if (this.values.hasOwnProperty(key)) {
                /** @type {?} */
                let currentValue = this.values[key];
                if (currentValue.isFile) {
                    this.activitiContentService.applyAlfrescoNode(currentValue, null, accountIdentifier).subscribe((res) => {
                        this.values[key] = [res];
                    });
                }
            }
        }
    }
    /**
     * @param {?=} outcome
     * @return {?}
     */
    startProcess(outcome) {
        if (this.selectedProcessDef && this.selectedProcessDef.id && this.name) {
            this.resetErrorMessage();
            /** @type {?} */
            let formValues = this.startForm ? this.startForm.form.values : undefined;
            this.activitiProcess.startProcess(this.selectedProcessDef.id, this.name, outcome, formValues, this.variables).subscribe((res) => {
                this.name = '';
                this.start.emit(res);
            }, (err) => {
                this.errorMessageId = 'ADF_PROCESS_LIST.START_PROCESS.ERROR.START';
                this.error.error(err);
            });
        }
    }
    /**
     * @return {?}
     */
    cancelStartProcess() {
        this.cancel.emit();
    }
    /**
     * @return {?}
     */
    hasStartForm() {
        return this.selectedProcessDef && this.selectedProcessDef.hasStartForm;
    }
    /**
     * @return {?}
     */
    isProcessDefinitionEmpty() {
        return this.processDefinitions ? (this.processDefinitions.length > 0 || this.errorMessageId) : this.errorMessageId;
    }
    /**
     * @return {?}
     */
    isStartFormMissingOrValid() {
        if (this.startForm) {
            return this.startForm.form && this.startForm.form.isValid;
        }
        else {
            return true;
        }
    }
    /**
     * @return {?}
     */
    validateForm() {
        return this.selectedProcessDef && this.selectedProcessDef.id && this.processNameInput.valid && this.isStartFormMissingOrValid();
    }
    /**
     * @private
     * @return {?}
     */
    resetSelectedProcessDefinition() {
        this.selectedProcessDef = new ProcessDefinitionRepresentation();
    }
    /**
     * @private
     * @return {?}
     */
    resetErrorMessage() {
        this.errorMessageId = '';
    }
    /**
     * @return {?}
     */
    hasErrorMessage() {
        return this.processDefinitions.length === 0 && !this.errorMessageId;
    }
    /**
     * @param {?} outcome
     * @return {?}
     */
    onOutcomeClick(outcome) {
        this.startProcess(outcome);
    }
    /**
     * @return {?}
     */
    reset() {
        this.resetSelectedProcessDefinition();
        this.name = '';
        if (this.startForm) {
            this.startForm.data = {};
        }
        this.resetErrorMessage();
    }
    /**
     * @return {?}
     */
    hasProcessName() {
        return this.name ? true : false;
    }
    /**
     * @param {?} process
     * @return {?}
     */
    displayFn(process) {
        if (process) {
            /** @type {?} */
            let processName = process;
            if (typeof process !== 'string') {
                processName = process.name;
            }
            return processName;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    displayDropdown(event) {
        event.stopPropagation();
        if (!this.inputAutocomplete.panelOpen) {
            this.processDefinitionInput.setValue('');
            this.inputAutocomplete.openPanel();
        }
        else {
            this.inputAutocomplete.closePanel();
        }
    }
    /**
     * @return {?}
     */
    get nameController() {
        return this.processNameInput;
    }
}
StartProcessInstanceComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-start-process',
                template: "<mat-card class=\"adf-start-process\">\n    <mat-card-title>{{'ADF_PROCESS_LIST.START_PROCESS.FORM.TITLE' | translate}}\n    </mat-card-title>\n    <mat-card-content *ngIf=\"isProcessDefinitionEmpty()\">\n        <mat-card-subtitle id=\"error-message\" *ngIf=\"errorMessageId\">\n            {{errorMessageId|translate}}\n        </mat-card-subtitle>\n        <mat-form-field class=\"adf-process-input-container\">\n            <input\n                matInput\n                placeholder=\"{{'ADF_PROCESS_LIST.START_PROCESS.FORM.LABEL.NAME' | translate}}\"\n                [formControl]=\"processNameInput\"\n                id=\"processName\"\n                required/>\n                <mat-error *ngIf=\"nameController.hasError('maxlength')\">\n                    {{ 'ADF_PROCESS_LIST.START_PROCESS.ERROR.MAXIMUM_LENGTH' | translate : { characters : maxProcessNameLength } }}\n                </mat-error>\n        </mat-form-field>\n        <mat-form-field class=\"adf-process-input-container\">\n            <input\n                type=\"text\"\n                placeholder=\"{{'ADF_PROCESS_LIST.START_PROCESS.FORM.LABEL.TYPE'|translate}}\"\n                matInput\n                [formControl]=\"processDefinitionInput\"\n                [matAutocomplete]=\"auto\"\n                id=\"processDefinitionName\"\n                #inputAutocomplete>\n            <div class=\"adf-process-input-autocomplete\">\n                <mat-autocomplete\n                    #auto=\"matAutocomplete\"\n                    id=\"processDefinitionOptions\"\n                    [displayWith]=\"displayFn\">\n                    <mat-option *ngFor=\"let processDef of filteredProcesses | async\" [value]=\"processDef.name\">\n                        {{ processDef.name }}\n                    </mat-option>\n                </mat-autocomplete>\n                <button\n                    id=\"adf-select-process-dropdown\"\n                    *ngIf=\"showSelectProcessDropdown\"\n                    mat-icon-button\n                    (click)=\"displayDropdown($event)\">\n                    <mat-icon>arrow_drop_down</mat-icon>\n                </button>\n            </div>\n        </mat-form-field>\n\n        <adf-start-form\n            #startForm\n            *ngIf=\"hasStartForm()\"\n            [data]=\"values\"\n            [disableStartProcessButton]=\"!hasProcessName()\"\n            [processDefinitionId]=\"selectedProcessDef.id\"\n            (outcomeClick)=\"onOutcomeClick($event)\"\n            [showRefreshButton]=\"false\">\n            <button\n                adf-form-custom-button\n                mat-button\n                (click)=\"cancelStartProcess()\"\n                id=\"cancel_process\">\n                {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.CANCEL'| translate | uppercase}}\n            </button>\n        </adf-start-form>\n    </mat-card-content>\n    <mat-card-content *ngIf=\"hasErrorMessage()\">\n        <mat-card-subtitle class=\"error-message\" id=\"no-process-message\">\n            {{'ADF_PROCESS_LIST.START_PROCESS.NO_PROCESS_DEFINITIONS' | translate | uppercase}}\n        </mat-card-subtitle>\n    </mat-card-content>\n    <mat-card-actions *ngIf=\"!hasStartForm()\">\n        <button\n            mat-button\n            *ngIf=\"!hasStartForm()\"\n            (click)=\"cancelStartProcess()\"\n            id=\"cancel_process\">\n            {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.CANCEL'| translate | uppercase}}\n        </button>\n        <button\n            color=\"primary\"\n            mat-button\n            *ngIf=\"!hasStartForm()\"\n            [disabled]=\"!validateForm()\"\n            (click)=\"startProcess()\"\n            data-automation-id=\"btn-start\"\n            id=\"button-start\"\n            class=\"btn-start\">\n            {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.START' | translate | uppercase}}\n        </button>\n    </mat-card-actions>\n</mat-card>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-start-process{width:66%;margin-left:auto;margin-right:auto;margin-top:10px}.adf-start-process .mat-select-trigger{font-size:14px!important}.adf-start-process mat-form-field{width:100%}.adf-start-process mat-select{width:100%;padding:16px 0 0}.adf-start-process mat-card-actions{text-align:right}.adf-start-process mat-card-actions .mat-button{text-transform:uppercase!important}.adf-process-input-container mat-form-field{width:100%}.adf-process-input-autocomplete{display:flex}.adf-process-input-autocomplete button{position:absolute;right:-14px;top:0}.adf-start-form-container .mat-card{box-shadow:none!important;padding:0!important}.adf-start-form-actions{text-align:right!important}@media (max-width:600px){.adf-start-process{width:90%;margin-left:auto;margin-right:auto}}"]
            }] }
];
/** @nocollapse */
StartProcessInstanceComponent.ctorParameters = () => [
    { type: ProcessService },
    { type: FormRenderingService },
    { type: ActivitiContentService },
    { type: AppConfigService }
];
StartProcessInstanceComponent.propDecorators = {
    appId: [{ type: Input }],
    processDefinitionName: [{ type: Input }],
    variables: [{ type: Input }],
    values: [{ type: Input }],
    name: [{ type: Input }],
    showSelectProcessDropdown: [{ type: Input }],
    processFilterSelector: [{ type: Input }],
    start: [{ type: Output }],
    cancel: [{ type: Output }],
    error: [{ type: Output }],
    startForm: [{ type: ViewChild, args: ['startForm',] }],
    inputAutocomplete: [{ type: ViewChild, args: [MatAutocompleteTrigger,] }]
};
if (false) {
    /** @type {?} */
    StartProcessInstanceComponent.prototype.MAX_LENGTH;
    /**
     * (optional) Limit the list of processes that can be started to those
     * contained in the specified app.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.appId;
    /**
     * (optional) Definition name of the process to start.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.processDefinitionName;
    /**
     * Variables in the input to the process
     * [RestVariable](https://github.com/Alfresco/alfresco-js-api/tree/master/src/alfresco-activiti-rest-api/docs/RestVariable.md).
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.variables;
    /**
     * Parameter to pass form field values in the start form if one is associated.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.values;
    /**
     * (optional) Name to assign to the current process.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.name;
    /**
     * Hide or show the process selection dropdown.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.showSelectProcessDropdown;
    /**
     * (optional) Parameter to enable selection of process when filtering.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.processFilterSelector;
    /**
     * Emitted when the process starts.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.start;
    /**
     * Emitted when the process is canceled.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.cancel;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.error;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.startForm;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.inputAutocomplete;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.processDefinitions;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.selectedProcessDef;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.errorMessageId;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.processNameInput;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.processDefinitionInput;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.filteredProcesses;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.maxProcessNameLength;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.activitiProcess;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.formRenderingService;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.activitiContentService;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.appConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnQtcHJvY2Vzcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLXByb2Nlc3Mtc2VydmljZXMvIiwic291cmNlcyI6WyJwcm9jZXNzLWxpc3QvY29tcG9uZW50cy9zdGFydC1wcm9jZXNzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQ0gsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQzlCLE1BQU0sRUFBaUIsU0FBUyxFQUFFLGlCQUFpQixFQUN0RCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0gsc0JBQXNCLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxFQUN6RCxrQkFBa0IsRUFBRSxvQkFBb0IsRUFDM0MsTUFBTSxvQkFBb0IsQ0FBQztBQUU1QixPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUV2RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLHlCQUF5QixFQUFFLDJCQUEyQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUYsT0FBTyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQW1CLE1BQU0sZ0JBQWdCLENBQUM7QUFFMUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBUTNELE1BQU0sT0FBTyw2QkFBNkI7Ozs7Ozs7SUE4RHRDLFlBQW9CLGVBQStCLEVBQy9CLG9CQUEwQyxFQUMxQyxzQkFBOEMsRUFDOUMsU0FBMkI7UUFIM0Isb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBQy9CLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7UUFDMUMsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF3QjtRQUM5QyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQS9EL0MsZUFB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SUFqRGpDLG1EQUF5Qjs7Ozs7O0lBS3pCLDhDQUNjOzs7OztJQUdkLDhEQUM4Qjs7Ozs7O0lBSzlCLGtEQUNxQzs7Ozs7SUFHckMsK0NBQ21COzs7OztJQUduQiw2Q0FDa0I7Ozs7O0lBR2xCLGtFQUMwQzs7Ozs7SUFHMUMsOERBQ3NDOzs7OztJQUd0Qyw4Q0FDMkU7Ozs7O0lBRzNFLCtDQUM0RTs7Ozs7SUFHNUUsOENBQzJFOztJQUUzRSxrREFDOEI7O0lBRTlCLDBEQUMwQzs7SUFFMUMsMkRBQTJEOztJQUMzRCwyREFBNEY7O0lBQzVGLHVEQUE0Qjs7SUFDNUIseURBQThCOztJQUM5QiwrREFBb0M7O0lBQ3BDLDBEQUFpRTs7SUFDakUsNkRBQStDOzs7OztJQUVuQyx3REFBdUM7Ozs7O0lBQ3ZDLDZEQUFrRDs7Ozs7SUFDbEQsK0RBQXNEOzs7OztJQUN0RCxrREFBbUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICAgIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsXG4gICAgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIFZpZXdFbmNhcHN1bGF0aW9uXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBBY3Rpdml0aUNvbnRlbnRTZXJ2aWNlLCBBcHBDb25maWdTZXJ2aWNlLCBBcHBDb25maWdWYWx1ZXMsXG4gICAgU3RhcnRGb3JtQ29tcG9uZW50LCBGb3JtUmVuZGVyaW5nU2VydmljZSwgRm9ybVZhbHVlc1xufSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgUHJvY2Vzc0luc3RhbmNlVmFyaWFibGUgfSBmcm9tICcuLi9tb2RlbHMvcHJvY2Vzcy1pbnN0YW5jZS12YXJpYWJsZS5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uIH0gZnJvbSAnLi8uLi9tb2RlbHMvcHJvY2Vzcy1kZWZpbml0aW9uLm1vZGVsJztcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZSB9IGZyb20gJy4vLi4vbW9kZWxzL3Byb2Nlc3MtaW5zdGFuY2UubW9kZWwnO1xuaW1wb3J0IHsgUHJvY2Vzc1NlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL3Byb2Nlc3Muc2VydmljZSc7XG5pbXBvcnQgeyBBdHRhY2hGaWxlV2lkZ2V0Q29tcG9uZW50LCBBdHRhY2hGb2xkZXJXaWRnZXRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9jb250ZW50LXdpZGdldCc7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgVmFsaWRhdG9ycywgQWJzdHJhY3RDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgTWF0QXV0b2NvbXBsZXRlVHJpZ2dlciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtc3RhcnQtcHJvY2VzcycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3N0YXJ0LXByb2Nlc3MuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3N0YXJ0LXByb2Nlc3MuY29tcG9uZW50LnNjc3MnXSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIFN0YXJ0UHJvY2Vzc0luc3RhbmNlQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkluaXQge1xuXG4gICAgTUFYX0xFTkdUSDogbnVtYmVyID0gMjU1O1xuXG4gICAgLyoqIChvcHRpb25hbCkgTGltaXQgdGhlIGxpc3Qgb2YgcHJvY2Vzc2VzIHRoYXQgY2FuIGJlIHN0YXJ0ZWQgdG8gdGhvc2VcbiAgICAgKiBjb250YWluZWQgaW4gdGhlIHNwZWNpZmllZCBhcHAuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBhcHBJZDogbnVtYmVyO1xuXG4gICAgLyoqIChvcHRpb25hbCkgRGVmaW5pdGlvbiBuYW1lIG9mIHRoZSBwcm9jZXNzIHRvIHN0YXJ0LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0RlZmluaXRpb25OYW1lOiBzdHJpbmc7XG5cbiAgICAvKiogVmFyaWFibGVzIGluIHRoZSBpbnB1dCB0byB0aGUgcHJvY2Vzc1xuICAgICAqIFtSZXN0VmFyaWFibGVdKGh0dHBzOi8vZ2l0aHViLmNvbS9BbGZyZXNjby9hbGZyZXNjby1qcy1hcGkvdHJlZS9tYXN0ZXIvc3JjL2FsZnJlc2NvLWFjdGl2aXRpLXJlc3QtYXBpL2RvY3MvUmVzdFZhcmlhYmxlLm1kKS5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHZhcmlhYmxlczogUHJvY2Vzc0luc3RhbmNlVmFyaWFibGVbXTtcblxuICAgIC8qKiBQYXJhbWV0ZXIgdG8gcGFzcyBmb3JtIGZpZWxkIHZhbHVlcyBpbiB0aGUgc3RhcnQgZm9ybSBpZiBvbmUgaXMgYXNzb2NpYXRlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHZhbHVlczogRm9ybVZhbHVlcztcblxuICAgIC8qKiAob3B0aW9uYWwpIE5hbWUgdG8gYXNzaWduIHRvIHRoZSBjdXJyZW50IHByb2Nlc3MuICovXG4gICAgQElucHV0KClcbiAgICBuYW1lOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBIaWRlIG9yIHNob3cgdGhlIHByb2Nlc3Mgc2VsZWN0aW9uIGRyb3Bkb3duLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1NlbGVjdFByb2Nlc3NEcm9wZG93bjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogKG9wdGlvbmFsKSBQYXJhbWV0ZXIgdG8gZW5hYmxlIHNlbGVjdGlvbiBvZiBwcm9jZXNzIHdoZW4gZmlsdGVyaW5nLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0ZpbHRlclNlbGVjdG9yOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHByb2Nlc3Mgc3RhcnRzLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHN0YXJ0OiBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlPiA9IG5ldyBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgcHJvY2VzcyBpcyBjYW5jZWxlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBjYW5jZWw6IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2U+ID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2U+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPFByb2Nlc3NJbnN0YW5jZT4gPSBuZXcgRXZlbnRFbWl0dGVyPFByb2Nlc3NJbnN0YW5jZT4oKTtcblxuICAgIEBWaWV3Q2hpbGQoJ3N0YXJ0Rm9ybScpXG4gICAgc3RhcnRGb3JtOiBTdGFydEZvcm1Db21wb25lbnQ7XG5cbiAgICBAVmlld0NoaWxkKE1hdEF1dG9jb21wbGV0ZVRyaWdnZXIpXG4gICAgaW5wdXRBdXRvY29tcGxldGU6IE1hdEF1dG9jb21wbGV0ZVRyaWdnZXI7XG5cbiAgICBwcm9jZXNzRGVmaW5pdGlvbnM6IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25bXSA9IFtdO1xuICAgIHNlbGVjdGVkUHJvY2Vzc0RlZjogUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbiA9IG5ldyBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uKCk7XG4gICAgZXJyb3JNZXNzYWdlSWQ6IHN0cmluZyA9ICcnO1xuICAgIHByb2Nlc3NOYW1lSW5wdXQ6IEZvcm1Db250cm9sO1xuICAgIHByb2Nlc3NEZWZpbml0aW9uSW5wdXQ6IEZvcm1Db250cm9sO1xuICAgIGZpbHRlcmVkUHJvY2Vzc2VzOiBPYnNlcnZhYmxlPFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25bXT47XG4gICAgbWF4UHJvY2Vzc05hbWVMZW5ndGg6IG51bWJlciA9IHRoaXMuTUFYX0xFTkdUSDtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYWN0aXZpdGlQcm9jZXNzOiBQcm9jZXNzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGZvcm1SZW5kZXJpbmdTZXJ2aWNlOiBGb3JtUmVuZGVyaW5nU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGl2aXRpQ29udGVudFNlcnZpY2U6IEFjdGl2aXRpQ29udGVudFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5mb3JtUmVuZGVyaW5nU2VydmljZS5zZXRDb21wb25lbnRUeXBlUmVzb2x2ZXIoJ3VwbG9hZCcsICgpID0+IEF0dGFjaEZpbGVXaWRnZXRDb21wb25lbnQsIHRydWUpO1xuICAgICAgICB0aGlzLmZvcm1SZW5kZXJpbmdTZXJ2aWNlLnNldENvbXBvbmVudFR5cGVSZXNvbHZlcignc2VsZWN0LWZvbGRlcicsICgpID0+IEF0dGFjaEZvbGRlcldpZGdldENvbXBvbmVudCwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc05hbWVJbnB1dCA9IG5ldyBGb3JtQ29udHJvbCh0aGlzLm5hbWUsIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLm1heExlbmd0aCh0aGlzLm1heFByb2Nlc3NOYW1lTGVuZ3RoKV0pO1xuICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uSW5wdXQgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuICAgICAgICB0aGlzLmxvYWRTdGFydFByb2Nlc3MoKTtcblxuICAgICAgICB0aGlzLnByb2Nlc3NOYW1lSW5wdXQudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSgobmFtZSkgPT4gdGhpcy5uYW1lID0gbmFtZSk7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRQcm9jZXNzZXMgPSB0aGlzLnByb2Nlc3NEZWZpbml0aW9uSW5wdXQudmFsdWVDaGFuZ2VzXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHZhbHVlKSA9PiB0aGlzLl9maWx0ZXIodmFsdWUpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGlmIChjaGFuZ2VzWyd2YWx1ZXMnXSAmJiBjaGFuZ2VzWyd2YWx1ZXMnXS5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMubW92ZU5vZGVGcm9tQ1N0b1BTKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2hhbmdlc1snYXBwSWQnXSAmJiBjaGFuZ2VzWydhcHBJZCddLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5hcHBJZCA9IGNoYW5nZXNbJ2FwcElkJ10uY3VycmVudFZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sb2FkU3RhcnRQcm9jZXNzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZmlsdGVyKHZhbHVlOiBzdHJpbmcpOiBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uW10ge1xuICAgICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyVmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgbGV0IGZpbHRlcmVkUHJvY2VzcyA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmZpbHRlcigob3B0aW9uKSA9PiBvcHRpb24ubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlclZhbHVlKSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnByb2Nlc3NGaWx0ZXJTZWxlY3Rvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmID0gdGhpcy5nZXRTZWxlY3RlZFByb2Nlc3MoZmlsdGVyVmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpbHRlcmVkUHJvY2VzcztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFNlbGVjdGVkUHJvY2VzcyhzZWxlY3RlZFByb2Nlc3MpIHtcbiAgICAgICAgbGV0IHByb2Nlc3NTZWxlY3RlZCA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmZpbmQoKHByb2Nlc3MpID0+IHByb2Nlc3MubmFtZS50b0xvd2VyQ2FzZSgpID09PSBzZWxlY3RlZFByb2Nlc3MpO1xuXG4gICAgICAgIGlmICghcHJvY2Vzc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICBwcm9jZXNzU2VsZWN0ZWQgPSBuZXcgUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm9jZXNzU2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgcHVibGljIGxvYWRTdGFydFByb2Nlc3MoKSB7XG4gICAgICAgIHRoaXMucmVzZXRTZWxlY3RlZFByb2Nlc3NEZWZpbml0aW9uKCk7XG4gICAgICAgIHRoaXMucmVzZXRFcnJvck1lc3NhZ2UoKTtcblxuICAgICAgICB0aGlzLmFjdGl2aXRpUHJvY2Vzcy5nZXRQcm9jZXNzRGVmaW5pdGlvbnModGhpcy5hcHBJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25zOiBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uW10pID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9ucyA9IHByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25zO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzUHJvY2Vzc0RlZmluaXRpb25zRW1wdHkoKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb2Nlc3NEZWZpbml0aW9ucy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmID0gdGhpcy5wcm9jZXNzRGVmaW5pdGlvbnNbMF07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9jZXNzRGVmaW5pdGlvbk5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZFByb2Nlc3MgPSB0aGlzLnByb2Nlc3NEZWZpbml0aW9ucy5maW5kKChjdXJyZW50UHJvY2Vzc0RlZmluaXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFByb2Nlc3NEZWZpbml0aW9uLm5hbWUgPT09IHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYgPSBzZWxlY3RlZFByb2Nlc3M7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uSW5wdXQuc2V0VmFsdWUodGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYubmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZUlkID0gJ0FERl9QUk9DRVNTX0xJU1QuU1RBUlRfUFJPQ0VTUy5FUlJPUi5MT0FEX1BST0NFU1NfREVGUyc7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpc1Byb2Nlc3NEZWZpbml0aW9uc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRGVmaW5pdGlvbnMubGVuZ3RoID09PSAwO1xuICAgIH1cblxuICAgIGdldEFsZnJlc2NvUmVwb3NpdG9yeU5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGFsZnJlc2NvUmVwb3NpdG9yeU5hbWUgPSB0aGlzLmFwcENvbmZpZy5nZXQ8c3RyaW5nPihBcHBDb25maWdWYWx1ZXMuQUxGUkVTQ09fUkVQT1NJVE9SWV9OQU1FKTtcbiAgICAgICAgaWYgKCFhbGZyZXNjb1JlcG9zaXRvcnlOYW1lKSB7XG4gICAgICAgICAgICBhbGZyZXNjb1JlcG9zaXRvcnlOYW1lID0gJ2FsZnJlc2NvLTEnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhbGZyZXNjb1JlcG9zaXRvcnlOYW1lICsgJ0FsZnJlc2NvJztcbiAgICB9XG5cbiAgICBtb3ZlTm9kZUZyb21DU3RvUFMoKSB7XG4gICAgICAgIGxldCBhY2NvdW50SWRlbnRpZmllciA9IHRoaXMuZ2V0QWxmcmVzY29SZXBvc2l0b3J5TmFtZSgpO1xuXG4gICAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLnZhbHVlcykge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudFZhbHVlID0gdGhpcy52YWx1ZXNba2V5XTtcblxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUuaXNGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlDb250ZW50U2VydmljZS5hcHBseUFsZnJlc2NvTm9kZShjdXJyZW50VmFsdWUsIG51bGwsIGFjY291bnRJZGVudGlmaWVyKS5zdWJzY3JpYmUoKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZXNba2V5XSA9IFtyZXNdO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhcnRQcm9jZXNzKG91dGNvbWU/OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmICYmIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmLmlkICYmIHRoaXMubmFtZSkge1xuICAgICAgICAgICAgdGhpcy5yZXNldEVycm9yTWVzc2FnZSgpO1xuICAgICAgICAgICAgbGV0IGZvcm1WYWx1ZXMgPSB0aGlzLnN0YXJ0Rm9ybSA/IHRoaXMuc3RhcnRGb3JtLmZvcm0udmFsdWVzIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5hY3Rpdml0aVByb2Nlc3Muc3RhcnRQcm9jZXNzKHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmLmlkLCB0aGlzLm5hbWUsIG91dGNvbWUsIGZvcm1WYWx1ZXMsIHRoaXMudmFyaWFibGVzKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydC5lbWl0KHJlcyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlSWQgPSAnQURGX1BST0NFU1NfTElTVC5TVEFSVF9QUk9DRVNTLkVSUk9SLlNUQVJUJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuY2VsU3RhcnRQcm9jZXNzKCkge1xuICAgICAgICB0aGlzLmNhbmNlbC5lbWl0KCk7XG4gICAgfVxuXG4gICAgaGFzU3RhcnRGb3JtKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYgJiYgdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYuaGFzU3RhcnRGb3JtO1xuICAgIH1cblxuICAgIGlzUHJvY2Vzc0RlZmluaXRpb25FbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0RlZmluaXRpb25zID8gKHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmxlbmd0aCA+IDAgfHwgdGhpcy5lcnJvck1lc3NhZ2VJZCkgOiB0aGlzLmVycm9yTWVzc2FnZUlkO1xuICAgIH1cblxuICAgIGlzU3RhcnRGb3JtTWlzc2luZ09yVmFsaWQoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLnN0YXJ0Rm9ybSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRGb3JtLmZvcm0gJiYgdGhpcy5zdGFydEZvcm0uZm9ybS5pc1ZhbGlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YWxpZGF0ZUZvcm0oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZiAmJiB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZi5pZCAmJiB0aGlzLnByb2Nlc3NOYW1lSW5wdXQudmFsaWQgJiYgdGhpcy5pc1N0YXJ0Rm9ybU1pc3NpbmdPclZhbGlkKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZXNldFNlbGVjdGVkUHJvY2Vzc0RlZmluaXRpb24oKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmID0gbmV3IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24oKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0RXJyb3JNZXNzYWdlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVycm9yTWVzc2FnZUlkID0gJyc7XG4gICAgfVxuXG4gICAgaGFzRXJyb3JNZXNzYWdlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRGVmaW5pdGlvbnMubGVuZ3RoID09PSAwICYmICF0aGlzLmVycm9yTWVzc2FnZUlkO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbk91dGNvbWVDbGljayhvdXRjb21lOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5zdGFydFByb2Nlc3Mob3V0Y29tZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlc2V0KCkge1xuICAgICAgICB0aGlzLnJlc2V0U2VsZWN0ZWRQcm9jZXNzRGVmaW5pdGlvbigpO1xuICAgICAgICB0aGlzLm5hbWUgPSAnJztcbiAgICAgICAgaWYgKHRoaXMuc3RhcnRGb3JtKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0Rm9ybS5kYXRhID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZXNldEVycm9yTWVzc2FnZSgpO1xuICAgIH1cblxuICAgIGhhc1Byb2Nlc3NOYW1lKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5uYW1lID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cblxuICAgIGRpc3BsYXlGbihwcm9jZXNzOiBhbnkpIHtcbiAgICAgICAgaWYgKHByb2Nlc3MpIHtcbiAgICAgICAgICAgIGxldCBwcm9jZXNzTmFtZSA9IHByb2Nlc3M7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHByb2Nlc3MgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcHJvY2Vzc05hbWUgPSBwcm9jZXNzLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcHJvY2Vzc05hbWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkaXNwbGF5RHJvcGRvd24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmICghdGhpcy5pbnB1dEF1dG9jb21wbGV0ZS5wYW5lbE9wZW4pIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb25JbnB1dC5zZXRWYWx1ZSgnJyk7XG4gICAgICAgICAgICB0aGlzLmlucHV0QXV0b2NvbXBsZXRlLm9wZW5QYW5lbCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEF1dG9jb21wbGV0ZS5jbG9zZVBhbmVsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgbmFtZUNvbnRyb2xsZXIoKTogQWJzdHJhY3RDb250cm9sIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc05hbWVJbnB1dDtcbiAgICB9XG59XG4iXX0=