/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { MatDialog } from '@angular/material';
import { TaskDetailsModel } from '../models/task-details.model';
import { TaskListService } from './../services/tasklist.service';
export class ChecklistComponent {
    /**
     * Constructor
     * @param {?} activitiTaskList
     * @param {?} dialog
     */
    constructor(activitiTaskList, dialog) {
        this.activitiTaskList = activitiTaskList;
        this.dialog = dialog;
        /**
         * Toggle readonly state of the form. All form widgets
         * will render as readonly if enabled.
         */
        this.readOnly = false;
        /**
         * Emitted when a new checklist task is created.
         */
        this.checklistTaskCreated = new EventEmitter();
        /**
         * Emitted when a checklist task is deleted.
         */
        this.checklistTaskDeleted = new EventEmitter();
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        this.checklist = [];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        let taskId = changes['taskId'];
        if (taskId && taskId.currentValue) {
            this.getTaskChecklist(taskId.currentValue);
            return;
        }
    }
    /**
     * @param {?} taskId
     * @return {?}
     */
    getTaskChecklist(taskId) {
        this.checklist = [];
        if (this.taskId) {
            this.activitiTaskList.getTaskChecklist(this.taskId).subscribe((taskDetailsModel) => {
                taskDetailsModel.forEach((task) => {
                    this.checklist.push(task);
                });
            }, (error) => {
                this.error.emit(error);
            });
        }
        else {
            this.checklist = [];
        }
    }
    /**
     * @return {?}
     */
    showDialog() {
        this.dialog.open(this.addNewDialog, { width: '350px' });
    }
    /**
     * @return {?}
     */
    add() {
        /** @type {?} */
        let newTask = new TaskDetailsModel({
            name: this.taskName,
            parentTaskId: this.taskId,
            assignee: { id: this.assignee }
        });
        this.activitiTaskList.addTask(newTask).subscribe((taskDetailsModel) => {
            this.checklist.push(taskDetailsModel);
            this.checklistTaskCreated.emit(taskDetailsModel);
            this.taskName = '';
        }, (error) => {
            this.error.emit(error);
        });
        this.cancel();
    }
    /**
     * @param {?} taskId
     * @return {?}
     */
    delete(taskId) {
        this.activitiTaskList.deleteTask(taskId).subscribe(() => {
            this.checklist = this.checklist.filter((check) => check.id !== taskId);
            this.checklistTaskDeleted.emit(taskId);
        }, (error) => {
            this.error.emit(error);
        });
    }
    /**
     * @return {?}
     */
    cancel() {
        this.dialog.closeAll();
        this.taskName = '';
    }
}
ChecklistComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-checklist',
                template: "<div class=\"adf-checklist-control\">\n    <mat-chip-list data-automation-id=\"checklist-label\">\n        <span class=\"adf-activiti-label\">{{ 'ADF_TASK_LIST.DETAILS.LABELS.CHECKLIST' | translate }}</span>\n        <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{checklist?.length}}</mat-chip>\n    </mat-chip-list>\n\n\n    <button mat-icon-button *ngIf=\"!readOnly\" matTooltip=\"Add a checklist\" [matTooltipPosition]=\"'before'\"\n            id=\"add-checklist\" class=\"adf-add-to-checklist-button\" (click)=\"showDialog()\">\n        <mat-icon>add</mat-icon>\n    </button>\n</div>\n\n<div class=\"adf-checklist-menu-container\" *ngIf=\"checklist?.length > 0\">\n    <mat-chip-list class=\"mat-chip-list-stacked\">\n        <mat-chip id=\"check-{{check.id}}\" class=\"adf-checklist-chip\" *ngFor=\"let check of checklist\"\n                  (removed)=\"delete(check.id)\">\n            <span>{{check.name}}</span>\n            <mat-icon *ngIf=\"!readOnly && !check.endDate\" id=\"remove-{{check.id}}\" matChipRemove>cancel\n            </mat-icon>\n        </mat-chip>\n    </mat-chip-list>\n\n</div>\n<div *ngIf=\"checklist?.length === 0\" id=\"checklist-none-message\" class=\"adf-checklist-none-message\">\n    {{ 'ADF_TASK_LIST.DETAILS.CHECKLIST.NONE' | translate }}\n</div>\n\n<ng-template #dialog>\n    <div class=\"adf-checklist-dialog\" id=\"checklist-dialog\">\n        <h4 matDialogTitle id=\"add-checklist-title\">{{ 'ADF_TASK_LIST.DETAILS.CHECKLIST.DIALOG.TITLE' | translate }}</h4>\n        <mat-dialog-content>\n            <mat-form-field>\n                <input matInput placeholder=\"{{ 'ADF_TASK_LIST.DETAILS.CHECKLIST.DIALOG.PLACEHOLDER' | translate }}\" [(ngModel)]=\"taskName\" id=\"checklist-name\"\n                       data-automation-id=\"checklist-name\">\n            </mat-form-field>\n        </mat-dialog-content>\n        <mat-dialog-actions class=\"adf-checklist-dialog-actions\">\n            <button mat-button type=\"button\" id=\"close-check-dialog\" (click)=\"cancel()\">{{ 'ADF_TASK_LIST.DETAILS.CHECKLIST.DIALOG.CANCEL-BUTTON' | translate | uppercase }}</button>\n            <button mat-button type=\"button\" id=\"add-check\" (click)=\"add()\">{{ 'ADF_TASK_LIST.DETAILS.CHECKLIST.DIALOG.ADD-BUTTON' | translate | uppercase  }}</button>\n        </mat-dialog-actions>\n    </div>\n</ng-template>\n",
                styles: [":host{width:100%}.adf-activiti-label{font-weight:bolder}.mat-form-field{width:100%}.adf-checklist-cancel-button{margin-top:-13px;margin-right:-13px;float:right}.adf-checklist-chip{outline:0}.adf-checklist-menu-container,.adf-checklist-none-message{margin-top:10px}.adf-checklist-control{display:flex;justify-content:space-between}.adf-checklist-control .adfactiviti-label{margin-top:6px;margin-right:10px}.adf-checklist-control .adf-add-to-checklist-button{float:right}.adf-checklist-dialog-actions{display:flex;justify-content:flex-end}"]
            }] }
];
/** @nocollapse */
ChecklistComponent.ctorParameters = () => [
    { type: TaskListService },
    { type: MatDialog }
];
ChecklistComponent.propDecorators = {
    taskId: [{ type: Input }],
    readOnly: [{ type: Input }],
    assignee: [{ type: Input }],
    checklistTaskCreated: [{ type: Output }],
    checklistTaskDeleted: [{ type: Output }],
    error: [{ type: Output }],
    addNewDialog: [{ type: ViewChild, args: ['dialog',] }]
};
if (false) {
    /**
     * (required) The id of the parent task to which subtasks are
     * attached.
     * @type {?}
     */
    ChecklistComponent.prototype.taskId;
    /**
     * Toggle readonly state of the form. All form widgets
     * will render as readonly if enabled.
     * @type {?}
     */
    ChecklistComponent.prototype.readOnly;
    /**
     * (required) The assignee id that the subtasks are assigned to.
     * @type {?}
     */
    ChecklistComponent.prototype.assignee;
    /**
     * Emitted when a new checklist task is created.
     * @type {?}
     */
    ChecklistComponent.prototype.checklistTaskCreated;
    /**
     * Emitted when a checklist task is deleted.
     * @type {?}
     */
    ChecklistComponent.prototype.checklistTaskDeleted;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    ChecklistComponent.prototype.error;
    /** @type {?} */
    ChecklistComponent.prototype.addNewDialog;
    /** @type {?} */
    ChecklistComponent.prototype.taskName;
    /** @type {?} */
    ChecklistComponent.prototype.checklist;
    /**
     * @type {?}
     * @private
     */
    ChecklistComponent.prototype.activitiTaskList;
    /**
     * @type {?}
     * @private
     */
    ChecklistComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tsaXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInRhc2stbGlzdC9jb21wb25lbnRzL2NoZWNrbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFhLE1BQU0sRUFBaUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVHLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFPakUsTUFBTSxPQUFPLGtCQUFrQjs7Ozs7O0lBMEMzQixZQUFvQixnQkFBaUMsRUFDakMsTUFBaUI7UUFEakIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFpQjtRQUNqQyxXQUFNLEdBQU4sTUFBTSxDQUFXOzs7OztRQS9CckMsYUFBUSxHQUFZLEtBQUssQ0FBQzs7OztRQVExQix5QkFBb0IsR0FBbUMsSUFBSSxZQUFZLEVBQW9CLENBQUM7Ozs7UUFJNUYseUJBQW9CLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7Ozs7UUFJeEUsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBT25ELGNBQVMsR0FBd0IsRUFBRSxDQUFDO0lBU3BDLENBQUM7Ozs7O0lBRUQsV0FBVyxDQUFDLE9BQXNCOztZQUMxQixNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQztRQUM5QixJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsWUFBWSxFQUFFO1lBQy9CLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDM0MsT0FBTztTQUNWO0lBQ0ws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QVE7Ozs7Ozs7O0lBekJuQixvQ0FDZTs7Ozs7O0lBS2Ysc0NBQzBCOzs7OztJQUcxQixzQ0FDaUI7Ozs7O0lBR2pCLGtEQUM0Rjs7Ozs7SUFHNUYsa0RBQ3dFOzs7OztJQUd4RSxtQ0FDbUQ7O0lBRW5ELDBDQUNrQjs7SUFFbEIsc0NBQWlCOztJQUVqQix1Q0FBb0M7Ozs7O0lBT3hCLDhDQUF5Qzs7Ozs7SUFDekMsb0NBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNYXREaWFsb2cgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQgeyBUYXNrRGV0YWlsc01vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL3Rhc2stZGV0YWlscy5tb2RlbCc7XG5pbXBvcnQgeyBUYXNrTGlzdFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL3Rhc2tsaXN0LnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1jaGVja2xpc3QnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9jaGVja2xpc3QuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2NoZWNrbGlzdC5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIENoZWNrbGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG5cbiAgICAvKiogKHJlcXVpcmVkKSBUaGUgaWQgb2YgdGhlIHBhcmVudCB0YXNrIHRvIHdoaWNoIHN1YnRhc2tzIGFyZVxuICAgICAqIGF0dGFjaGVkLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgdGFza0lkOiBzdHJpbmc7XG5cbiAgICAvKiogVG9nZ2xlIHJlYWRvbmx5IHN0YXRlIG9mIHRoZSBmb3JtLiBBbGwgZm9ybSB3aWRnZXRzXG4gICAgICogd2lsbCByZW5kZXIgYXMgcmVhZG9ubHkgaWYgZW5hYmxlZC5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHJlYWRPbmx5OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogKHJlcXVpcmVkKSBUaGUgYXNzaWduZWUgaWQgdGhhdCB0aGUgc3VidGFza3MgYXJlIGFzc2lnbmVkIHRvLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgYXNzaWduZWU6IHN0cmluZztcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gYSBuZXcgY2hlY2tsaXN0IHRhc2sgaXMgY3JlYXRlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBjaGVja2xpc3RUYXNrQ3JlYXRlZDogRXZlbnRFbWl0dGVyPFRhc2tEZXRhaWxzTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc01vZGVsPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIGNoZWNrbGlzdCB0YXNrIGlzIGRlbGV0ZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgY2hlY2tsaXN0VGFza0RlbGV0ZWQ6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBWaWV3Q2hpbGQoJ2RpYWxvZycpXG4gICAgYWRkTmV3RGlhbG9nOiBhbnk7XG5cbiAgICB0YXNrTmFtZTogc3RyaW5nO1xuXG4gICAgY2hlY2tsaXN0OiBUYXNrRGV0YWlsc01vZGVsIFtdID0gW107XG5cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBhdXRoXG4gICAgICogQHBhcmFtIHRyYW5zbGF0ZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYWN0aXZpdGlUYXNrTGlzdDogVGFza0xpc3RTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZGlhbG9nOiBNYXREaWFsb2cpIHtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGxldCB0YXNrSWQgPSBjaGFuZ2VzWyd0YXNrSWQnXTtcbiAgICAgICAgaWYgKHRhc2tJZCAmJiB0YXNrSWQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmdldFRhc2tDaGVja2xpc3QodGFza0lkLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VGFza0NoZWNrbGlzdCh0YXNrSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmNoZWNrbGlzdCA9IFtdO1xuICAgICAgICBpZiAodGhpcy50YXNrSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlUYXNrTGlzdC5nZXRUYXNrQ2hlY2tsaXN0KHRoaXMudGFza0lkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHRhc2tEZXRhaWxzTW9kZWw6IFRhc2tEZXRhaWxzTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0YXNrRGV0YWlsc01vZGVsLmZvckVhY2goKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tsaXN0LnB1c2godGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tsaXN0ID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzaG93RGlhbG9nKCkge1xuICAgICAgICB0aGlzLmRpYWxvZy5vcGVuKHRoaXMuYWRkTmV3RGlhbG9nLCB7IHdpZHRoOiAnMzUwcHgnIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGQoKSB7XG4gICAgICAgIGxldCBuZXdUYXNrID0gbmV3IFRhc2tEZXRhaWxzTW9kZWwoe1xuICAgICAgICAgICAgbmFtZTogdGhpcy50YXNrTmFtZSxcbiAgICAgICAgICAgIHBhcmVudFRhc2tJZDogdGhpcy50YXNrSWQsXG4gICAgICAgICAgICBhc3NpZ25lZTogeyBpZDogdGhpcy5hc3NpZ25lZSB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFjdGl2aXRpVGFza0xpc3QuYWRkVGFzayhuZXdUYXNrKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAodGFza0RldGFpbHNNb2RlbDogVGFza0RldGFpbHNNb2RlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tsaXN0LnB1c2godGFza0RldGFpbHNNb2RlbCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja2xpc3RUYXNrQ3JlYXRlZC5lbWl0KHRhc2tEZXRhaWxzTW9kZWwpO1xuICAgICAgICAgICAgICAgIHRoaXMudGFza05hbWUgPSAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmNhbmNlbCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBkZWxldGUodGFza0lkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hY3Rpdml0aVRhc2tMaXN0LmRlbGV0ZVRhc2sodGFza0lkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja2xpc3QgPSB0aGlzLmNoZWNrbGlzdC5maWx0ZXIoKGNoZWNrKSA9PiBjaGVjay5pZCAhPT0gdGFza0lkKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrbGlzdFRhc2tEZWxldGVkLmVtaXQodGFza0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNhbmNlbCgpIHtcbiAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICAgICAgdGhpcy50YXNrTmFtZSA9ICcnO1xuICAgIH1cbn1cbiJdfQ==