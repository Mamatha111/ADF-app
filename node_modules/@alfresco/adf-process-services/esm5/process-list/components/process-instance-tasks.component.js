/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { LogService } from '@alfresco/adf-core';
import { DatePipe } from '@angular/common';
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { MatDialog } from '@angular/material';
import { Observable } from 'rxjs';
import { TaskDetailsEvent } from '../../task-list';
import { ProcessInstance } from '../models/process-instance.model';
import { ProcessService } from './../services/process.service';
import { share } from 'rxjs/operators';
var ProcessInstanceTasksComponent = /** @class */ (function () {
    function ProcessInstanceTasksComponent(activitiProcess, logService, dialog) {
        var _this = this;
        this.activitiProcess = activitiProcess;
        this.logService = logService;
        this.dialog = dialog;
        /**
         * Toggles whether to show a refresh button next to the list of tasks to allow
         * it to be updated from the server.
         */
        this.showRefreshButton = true;
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        this.activeTasks = [];
        this.completedTasks = [];
        /**
         * Emitted when a task is clicked.
         */
        this.taskClick = new EventEmitter();
        this.task$ = new Observable(function (observer) { return _this.taskObserver = observer; })
            .pipe(share());
        this.completedTask$ = new Observable(function (observer) { return _this.completedTaskObserver = observer; })
            .pipe(share());
    }
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.task$.subscribe(function (task) {
            _this.activeTasks.push(task);
        });
        this.completedTask$.subscribe(function (task) {
            _this.completedTasks.push(task);
        });
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var processInstanceDetails = changes['processInstanceDetails'];
        if (processInstanceDetails && processInstanceDetails.currentValue) {
            this.load(processInstanceDetails.currentValue.id);
        }
    };
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.load = /**
     * @param {?} processInstanceId
     * @return {?}
     */
    function (processInstanceId) {
        this.loadActive(processInstanceId);
        this.loadCompleted(processInstanceId);
    };
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.loadActive = /**
     * @param {?} processInstanceId
     * @return {?}
     */
    function (processInstanceId) {
        var _this = this;
        this.activeTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, null).subscribe(function (res) {
                res.forEach(function (task) {
                    _this.taskObserver.next(task);
                });
            }, function (err) {
                _this.error.emit(err);
            });
        }
        else {
            this.activeTasks = [];
        }
    };
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.loadCompleted = /**
     * @param {?} processInstanceId
     * @return {?}
     */
    function (processInstanceId) {
        var _this = this;
        this.completedTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, 'completed').subscribe(function (res) {
                res.forEach(function (task) {
                    _this.completedTaskObserver.next(task);
                });
            }, function (err) {
                _this.error.emit(err);
            });
        }
        else {
            this.completedTasks = [];
        }
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.hasStartFormDefined = /**
     * @return {?}
     */
    function () {
        return this.processInstanceDetails && this.processInstanceDetails.startFormDefined === true;
    };
    /**
     * @param {?} user
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.getUserFullName = /**
     * @param {?} user
     * @return {?}
     */
    function (user) {
        if (user) {
            return (user.firstName && user.firstName !== 'null'
                ? user.firstName + ' ' : '') +
                user.lastName;
        }
        return 'Nobody';
    };
    /**
     * @param {?} value
     * @param {?} format
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.getFormatDate = /**
     * @param {?} value
     * @param {?} format
     * @return {?}
     */
    function (value, format) {
        /** @type {?} */
        var datePipe = new DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            this.logService.error("ProcessListInstanceTask: error parsing date " + value + " to format " + format);
        }
    };
    /**
     * @param {?} $event
     * @param {?} task
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.clickTask = /**
     * @param {?} $event
     * @param {?} task
     * @return {?}
     */
    function ($event, task) {
        /** @type {?} */
        var args = new TaskDetailsEvent(task);
        this.taskClick.emit(args);
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.clickStartTask = /**
     * @return {?}
     */
    function () {
        this.processId = this.processInstanceDetails.id;
        this.showStartDialog();
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.showStartDialog = /**
     * @return {?}
     */
    function () {
        this.dialog.open(this.startDialog, { height: '500px', width: '700px' });
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.closeStartDialog = /**
     * @return {?}
     */
    function () {
        this.dialog.closeAll();
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.onRefreshClicked = /**
     * @return {?}
     */
    function () {
        this.load(this.processInstanceDetails.id);
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.onFormContentClick = /**
     * @return {?}
     */
    function () {
        this.closeStartDialog();
    };
    ProcessInstanceTasksComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-process-instance-tasks',
                    template: "<div  *ngIf=\"showRefreshButton\" class=\"process-tasks-refresh\" >\n    <button mat-icon-button (click)=\"onRefreshClicked()\">\n        <mat-icon class=\"md-24\" aria-label=\"Refresh\">refresh</mat-icon>\n    </button>\n</div>\n\n<!-- ACTIVE FORM -->\n\n<mat-chip-list>\n    <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_ACTIVE'|translate }}</span>\n    <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{activeTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"activeTasks?.length > 0\" data-automation-id=\"active-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of activeTasks\" (click)=\"clickTask($event, task)\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user: getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n                </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<!-- START FORM -->\n\n<div *ngIf=\"activeTasks?.length === 0\" data-automation-id=\"active-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_ACTIVE' | translate }}\n</div>\n\n<div *ngIf=\"hasStartFormDefined()\">\n    <span class=\"adf-activiti-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</span>\n\n    <!--IF START TASK COMPLETED -->\n    <div class=\"menu-container\">\n        <mat-list>\n            <mat-list-item class=\"process-tasks__task-item\" (click)=\"clickStartTask()\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(processInstanceDetails.startedBy), created: getFormatDate(processInstanceDetails.started, 'mediumDate') } }}\n                </span>\n            </mat-list-item>\n        </mat-list>\n    </div>\n\n</div>\n\n<!-- COMPLETED FORM -->\n<mat-chip-list>\n        <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_COMPLETED'|translate }}</span>\n        <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{completedTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"completedTasks?.length > 0\" data-automation-id=\"completed-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of completedTasks\" (click)=\"clickTask($event, task)\">\n            <mat-icon mat-list-icon>assignment</mat-icon>\n            <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n            <span matLine>\n                {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n            </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<div *ngIf=\"completedTasks?.length === 0\" data-automation-id=\"completed-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_COMPLETED' | translate }}\n</div>\n\n<ng-template *ngIf=\"hasStartFormDefined()\" #startDialog>\n    <div id=\"adf-start-process-dialog\" class=\"adf-start-process-dialog\">\n        <h4 matDialogTitle>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h4>\n        <div mat-dialog-content class=\"adf-start-process-dialog-content\">\n            <adf-start-form [processId]=\"processId\"\n                                 [showRefreshButton]=\"false\" [readOnlyForm]=\"true\"\n                                 (formContentClicked)='onFormContentClick()'>\n            </adf-start-form>\n        </div>\n        <div mat-dialog-actions class=\"adf-start-process-dialog-actions\">\n            <button mat-button type=\"button\" (click)=\"closeStartDialog()\">{{ 'ADF_PROCESS_LIST.DETAILS.TASKS.TASK_CLOSE' | translate }}</button>\n        </div>\n    </div>\n</ng-template>\n",
                    styles: [":host{width:100%}.activiti-label{font-weight:bolder;vertical-align:top}.adf-process-badge{pointer-events:none;outline:0}.adf-chip-label{position:relative;top:5px;margin-right:8px;font-weight:700}.menu-container{margin-bottom:32px}.activiti-label+.icon{position:relative;top:-2px}.task-details-dialog{position:fixed;top:50%;-webkit-transform:translate(0,-50%);transform:translate(0,-50%);width:40%}.process-tasks-refresh{float:right}.adf-start-process-dialog{width:100%;height:100%;display:flex;flex-direction:column}.adf-start-process-dialog-content{flex-grow:1}.adf-start-process-dialog-actions{display:flex;justify-content:flex-end}.no-results{margin-left:9px;font-size:14px;font-weight:400;letter-spacing:0;line-height:18px;color:rgba(0,0,0,.54);display:block;padding:12px}.process-tasks__task-item{cursor:pointer}"]
                }] }
    ];
    /** @nocollapse */
    ProcessInstanceTasksComponent.ctorParameters = function () { return [
        { type: ProcessService },
        { type: LogService },
        { type: MatDialog }
    ]; };
    ProcessInstanceTasksComponent.propDecorators = {
        processInstanceDetails: [{ type: Input }],
        showRefreshButton: [{ type: Input }],
        error: [{ type: Output }],
        startDialog: [{ type: ViewChild, args: ['startDialog',] }],
        taskDetails: [{ type: ViewChild, args: ['taskDetails',] }],
        taskClick: [{ type: Output }]
    };
    return ProcessInstanceTasksComponent;
}());
export { ProcessInstanceTasksComponent };
if (false) {
    /**
     * (**required**) The ID of the process instance to display tasks for.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.processInstanceDetails;
    /**
     * Toggles whether to show a refresh button next to the list of tasks to allow
     * it to be updated from the server.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.showRefreshButton;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.error;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.activeTasks;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.completedTasks;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.taskObserver;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.completedTaskObserver;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.task$;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.completedTask$;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.message;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.processId;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.startDialog;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.taskDetails;
    /**
     * Emitted when a task is clicked.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.taskClick;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.activitiProcess;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLXByb2Nlc3Mtc2VydmljZXMvIiwic291cmNlcyI6WyJwcm9jZXNzLWxpc3QvY29tcG9uZW50cy9wcm9jZXNzLWluc3RhbmNlLXRhc2tzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEgsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxVQUFVLEVBQVksTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFvQixNQUFNLGlCQUFpQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXZDO0lBMkNJLHVDQUFvQixlQUErQixFQUMvQixVQUFzQixFQUN0QixNQUFpQjtRQUZyQyxpQkFPQztRQVBtQixvQkFBZSxHQUFmLGVBQWUsQ0FBZ0I7UUFDL0IsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixXQUFNLEdBQU4sTUFBTSxDQUFXOzs7OztRQTlCckMsc0JBQWlCLEdBQVksSUFBSSxDQUFDOzs7O1FBSWxDLFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVuRCxnQkFBVyxHQUF1QixFQUFFLENBQUM7UUFD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a0RBQ2lGOzs7OztJQUVyRSx3REFBdUM7Ozs7O0lBQ3ZDLG1EQUE4Qjs7Ozs7SUFDOUIsK0NBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgTG9nU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBEYXRlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgT2JzZXJ2ZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFRhc2tEZXRhaWxzRXZlbnQsIFRhc2tEZXRhaWxzTW9kZWwgfSBmcm9tICcuLi8uLi90YXNrLWxpc3QnO1xuaW1wb3J0IHsgUHJvY2Vzc0luc3RhbmNlIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2Nlc3MtaW5zdGFuY2UubW9kZWwnO1xuaW1wb3J0IHsgUHJvY2Vzc1NlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL3Byb2Nlc3Muc2VydmljZSc7XG5pbXBvcnQgeyBzaGFyZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtcHJvY2Vzcy1pbnN0YW5jZS10YXNrcycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3Byb2Nlc3MtaW5zdGFuY2UtdGFza3MuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3Byb2Nlc3MtaW5zdGFuY2UtdGFza3MuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFByb2Nlc3NJbnN0YW5jZVRhc2tzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuXG4gICAgLyoqICgqKnJlcXVpcmVkKiopIFRoZSBJRCBvZiB0aGUgcHJvY2VzcyBpbnN0YW5jZSB0byBkaXNwbGF5IHRhc2tzIGZvci4gKi9cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NJbnN0YW5jZURldGFpbHM6IFByb2Nlc3NJbnN0YW5jZTtcblxuICAgIC8qKiBUb2dnbGVzIHdoZXRoZXIgdG8gc2hvdyBhIHJlZnJlc2ggYnV0dG9uIG5leHQgdG8gdGhlIGxpc3Qgb2YgdGFza3MgdG8gYWxsb3dcbiAgICAgKiBpdCB0byBiZSB1cGRhdGVkIGZyb20gdGhlIHNlcnZlci5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dSZWZyZXNoQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgYWN0aXZlVGFza3M6IFRhc2tEZXRhaWxzTW9kZWxbXSA9IFtdO1xuICAgIGNvbXBsZXRlZFRhc2tzOiBUYXNrRGV0YWlsc01vZGVsW10gPSBbXTtcblxuICAgIHByaXZhdGUgdGFza09ic2VydmVyOiBPYnNlcnZlcjxUYXNrRGV0YWlsc01vZGVsPjtcbiAgICBwcml2YXRlIGNvbXBsZXRlZFRhc2tPYnNlcnZlcjogT2JzZXJ2ZXI8VGFza0RldGFpbHNNb2RlbD47XG5cbiAgICB0YXNrJDogT2JzZXJ2YWJsZTxUYXNrRGV0YWlsc01vZGVsPjtcbiAgICBjb21wbGV0ZWRUYXNrJDogT2JzZXJ2YWJsZTxUYXNrRGV0YWlsc01vZGVsPjtcblxuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICBwcm9jZXNzSWQ6IHN0cmluZztcblxuICAgIEBWaWV3Q2hpbGQoJ3N0YXJ0RGlhbG9nJylcbiAgICBzdGFydERpYWxvZzogYW55O1xuXG4gICAgQFZpZXdDaGlsZCgndGFza0RldGFpbHMnKVxuICAgIHRhc2tEZXRhaWxzOiBhbnk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGEgdGFzayBpcyBjbGlja2VkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHRhc2tDbGljazogRXZlbnRFbWl0dGVyPFRhc2tEZXRhaWxzRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc0V2ZW50PigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhY3Rpdml0aVByb2Nlc3M6IFByb2Nlc3NTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGRpYWxvZzogTWF0RGlhbG9nKSB7XG4gICAgICAgIHRoaXMudGFzayQgPSBuZXcgT2JzZXJ2YWJsZTxUYXNrRGV0YWlsc01vZGVsPigob2JzZXJ2ZXIpID0+IHRoaXMudGFza09ic2VydmVyID0gb2JzZXJ2ZXIpXG4gICAgICAgICAgICAucGlwZShzaGFyZSgpKTtcbiAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrJCA9IG5ldyBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+KChvYnNlcnZlcikgPT4gdGhpcy5jb21wbGV0ZWRUYXNrT2JzZXJ2ZXIgPSBvYnNlcnZlcilcbiAgICAgICAgICAgIC5waXBlKHNoYXJlKCkpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnRhc2skLnN1YnNjcmliZSgodGFzazogVGFza0RldGFpbHNNb2RlbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVUYXNrcy5wdXNoKHRhc2spO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrJC5zdWJzY3JpYmUoKHRhc2s6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVkVGFza3MucHVzaCh0YXNrKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBsZXQgcHJvY2Vzc0luc3RhbmNlRGV0YWlscyA9IGNoYW5nZXNbJ3Byb2Nlc3NJbnN0YW5jZURldGFpbHMnXTtcbiAgICAgICAgaWYgKHByb2Nlc3NJbnN0YW5jZURldGFpbHMgJiYgcHJvY2Vzc0luc3RhbmNlRGV0YWlscy5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZChwcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmN1cnJlbnRWYWx1ZS5pZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5sb2FkQWN0aXZlKHByb2Nlc3NJbnN0YW5jZUlkKTtcbiAgICAgICAgdGhpcy5sb2FkQ29tcGxldGVkKHByb2Nlc3NJbnN0YW5jZUlkKTtcbiAgICB9XG5cbiAgICBsb2FkQWN0aXZlKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVUYXNrcyA9IFtdO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSW5zdGFuY2VJZCwgbnVsbCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXM6IFRhc2tEZXRhaWxzTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgodGFzaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrT2JzZXJ2ZXIubmV4dCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVRhc2tzID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkQ29tcGxldGVkKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcyA9IFtdO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSW5zdGFuY2VJZCwgJ2NvbXBsZXRlZCcpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzOiBUYXNrRGV0YWlsc01vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVkVGFza09ic2VydmVyLm5leHQodGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFzU3RhcnRGb3JtRGVmaW5lZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscyAmJiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuc3RhcnRGb3JtRGVmaW5lZCA9PT0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXRVc2VyRnVsbE5hbWUodXNlcjogYW55KSB7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gKHVzZXIuZmlyc3ROYW1lICYmIHVzZXIuZmlyc3ROYW1lICE9PSAnbnVsbCdcbiAgICAgICAgICAgICAgICAgICAgPyB1c2VyLmZpcnN0TmFtZSArICcgJyA6ICcnKSArXG4gICAgICAgICAgICAgICAgdXNlci5sYXN0TmFtZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ05vYm9keSc7XG4gICAgfVxuXG4gICAgZ2V0Rm9ybWF0RGF0ZSh2YWx1ZSwgZm9ybWF0OiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGRhdGVQaXBlID0gbmV3IERhdGVQaXBlKCdlbi1VUycpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGVQaXBlLnRyYW5zZm9ybSh2YWx1ZSwgZm9ybWF0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoYFByb2Nlc3NMaXN0SW5zdGFuY2VUYXNrOiBlcnJvciBwYXJzaW5nIGRhdGUgJHt2YWx1ZX0gdG8gZm9ybWF0ICR7Zm9ybWF0fWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xpY2tUYXNrKCRldmVudDogYW55LCB0YXNrOiBUYXNrRGV0YWlsc01vZGVsKSB7XG4gICAgICAgIGxldCBhcmdzID0gbmV3IFRhc2tEZXRhaWxzRXZlbnQodGFzayk7XG4gICAgICAgIHRoaXMudGFza0NsaWNrLmVtaXQoYXJncyk7XG4gICAgfVxuXG4gICAgY2xpY2tTdGFydFRhc2soKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc0lkID0gdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmlkO1xuICAgICAgICB0aGlzLnNob3dTdGFydERpYWxvZygpO1xuICAgIH1cblxuICAgIHNob3dTdGFydERpYWxvZygpIHtcbiAgICAgICAgdGhpcy5kaWFsb2cub3Blbih0aGlzLnN0YXJ0RGlhbG9nLCB7IGhlaWdodDogJzUwMHB4Jywgd2lkdGg6ICc3MDBweCcgfSk7XG4gICAgfVxuXG4gICAgY2xvc2VTdGFydERpYWxvZygpIHtcbiAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICB9XG5cbiAgICBvblJlZnJlc2hDbGlja2VkKCkge1xuICAgICAgICB0aGlzLmxvYWQodGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmlkKTtcbiAgICB9XG5cbiAgICBvbkZvcm1Db250ZW50Q2xpY2soKSB7XG4gICAgICAgIHRoaXMuY2xvc2VTdGFydERpYWxvZygpO1xuICAgIH1cbn1cbiJdfQ==