/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { DataTableSchema, CustomEmptyContentTemplateDirective, CustomLoadingContentTemplateDirective } from '@alfresco/adf-core';
import { AppConfigService, PaginationComponent, UserPreferencesService } from '@alfresco/adf-core';
import { DatePipe } from '@angular/common';
import { Component, ContentChild, EventEmitter, Input, Output } from '@angular/core';
import { ProcessFilterParamRepresentationModel } from '../models/filter-process.model';
import { processPresetsDefaultModel } from '../models/process-preset.model';
import { ProcessService } from '../services/process.service';
import { BehaviorSubject } from 'rxjs';
import moment from 'moment-es6';
var ProcessInstanceListComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ProcessInstanceListComponent, _super);
    function ProcessInstanceListComponent(processService, userPreferences, appConfig) {
        var _this = _super.call(this, appConfig, ProcessInstanceListComponent.PRESET_KEY, processPresetsDefaultModel) || this;
        _this.processService = processService;
        _this.userPreferences = userPreferences;
        _this.FORMAT_DATE = 'll';
        /**
         * The page number of the processes to fetch.
         */
        _this.page = 0;
        /**
         * The number of processes to fetch in each page.
         */
        _this.size = PaginationComponent.DEFAULT_PAGINATION.maxItems;
        /**
         * Toggles multiple row selection, which renders checkboxes at the beginning of each row
         */
        _this.multiselect = false;
        /**
         * Row selection mode. Can be none, `single` or `multiple`. For `multiple` mode,
         * you can use Cmd (macOS) or Ctrl (Win) modifier key to toggle selection for
         * multiple rows.
         */
        _this.selectionMode = 'single'; // none|single|multiple
        // none|single|multiple
        /**
         * Toggles default selection of the first row
         */
        _this.selectFirstRow = true;
        /**
         * Emitted when a row in the process list is clicked.
         */
        _this.rowClick = new EventEmitter();
        /**
         * Emitted when the list of process instances has been loaded successfully from the server.
         */
        _this.success = new EventEmitter();
        /**
         * Emitted when an error occurs while loading the list of process instances from the server.
         */
        _this.error = new EventEmitter();
        _this.isLoading = true;
        _this.rows = [];
        _this.sorting = ['created', 'desc'];
        _this.size = _this.userPreferences.paginationSize;
        _this.pagination = new BehaviorSubject((/** @type {?} */ ({
            maxItems: _this.size,
            skipCount: 0,
            totalItems: 0
        })));
        return _this;
    }
    /**
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        this.createDatatableSchema();
        if (this.data && this.data.getColumns().length === 0) {
            this.data.setColumns(this.columns);
        }
        if (this.appId != null) {
            this.reload();
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (this.isPropertyChanged(changes)) {
            if (this.isSortChanged(changes)) {
                this.sorting = this.sort ? this.sort.split('-') : this.sorting;
            }
            this.reload();
        }
    };
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.isSortChanged = /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var actualSort = changes['sort'];
        return actualSort && actualSort.currentValue && actualSort.currentValue !== actualSort.previousValue;
    };
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.isPropertyChanged = /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var changed = false;
        /** @type {?} */
        var appId = changes['appId'];
        /** @type {?} */
        var processDefinitionId = changes['processDefinitionId'];
        /** @type {?} */
        var processInstanceId = changes['processInstanceId'];
        /** @type {?} */
        var state = changes['state'];
        /** @type {?} */
        var sort = changes['sort'];
        /** @type {?} */
        var page = changes['page'];
        /** @type {?} */
        var size = changes['size'];
        if (appId && appId.currentValue) {
            changed = true;
        }
        else if (processDefinitionId) {
            changed = true;
        }
        else if (processInstanceId) {
            changed = true;
        }
        else if (state && state.currentValue) {
            changed = true;
        }
        else if (sort && sort.currentValue) {
            changed = true;
        }
        else if (page && page.currentValue !== page.previousValue) {
            changed = true;
        }
        else if (size && size.currentValue !== size.previousValue) {
            changed = true;
        }
        return changed;
    };
    /**
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.reload = /**
     * @return {?}
     */
    function () {
        this.requestNode = this.createRequestNode();
        this.load(this.requestNode);
    };
    /**
     * @private
     * @param {?} requestNode
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.load = /**
     * @private
     * @param {?} requestNode
     * @return {?}
     */
    function (requestNode) {
        var _this = this;
        this.isLoading = true;
        this.processService.getProcesses(requestNode)
            .subscribe(function (response) {
            _this.rows = _this.optimizeProcessDetails(response.data);
            _this.selectFirst();
            _this.success.emit(response);
            _this.isLoading = false;
            _this.pagination.next({
                count: response.data.length,
                maxItems: _this.size,
                skipCount: _this.page * _this.size,
                totalItems: response.total
            });
        }, function (error) {
            _this.error.emit(error);
            _this.isLoading = false;
        });
    };
    /**
     * Select the first instance of a list if present
     */
    /**
     * Select the first instance of a list if present
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.selectFirst = /**
     * Select the first instance of a list if present
     * @return {?}
     */
    function () {
        if (this.selectFirstRow) {
            if (!this.isListEmpty()) {
                /** @type {?} */
                var dataRow = this.rows[0];
                dataRow.isSelected = true;
                this.currentInstanceId = dataRow['id'];
            }
            else {
                this.currentInstanceId = null;
            }
        }
    };
    /**
     * Return the current id
     */
    /**
     * Return the current id
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.getCurrentId = /**
     * Return the current id
     * @return {?}
     */
    function () {
        return this.currentInstanceId;
    };
    /**
     * Check if the list is empty
     */
    /**
     * Check if the list is empty
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.isListEmpty = /**
     * Check if the list is empty
     * @return {?}
     */
    function () {
        return !this.rows || this.rows.length === 0;
    };
    /**
     * Emit the event rowClick passing the current task id when the row is clicked
     * @param event
     */
    /**
     * Emit the event rowClick passing the current task id when the row is clicked
     * @param {?} event
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.onRowClick = /**
     * Emit the event rowClick passing the current task id when the row is clicked
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var item = event;
        this.currentInstanceId = item.value.getValue('id');
        this.rowClick.emit(this.currentInstanceId);
    };
    /**
     * Emit the event rowClick passing the current task id when pressed the Enter key on the selected row
     * @param event
     */
    /**
     * Emit the event rowClick passing the current task id when pressed the Enter key on the selected row
     * @param {?} event
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.onRowKeyUp = /**
     * Emit the event rowClick passing the current task id when pressed the Enter key on the selected row
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.detail.keyboardEvent.key === 'Enter') {
            event.preventDefault();
            this.currentInstanceId = event.detail.row.getValue('id');
            this.rowClick.emit(this.currentInstanceId);
        }
    };
    /**
     * Optimize name field
     * @param instances
     */
    /**
     * Optimize name field
     * @private
     * @param {?} instances
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.optimizeProcessDetails = /**
     * Optimize name field
     * @private
     * @param {?} instances
     * @return {?}
     */
    function (instances) {
        var _this = this;
        instances = instances.map(function (instance) {
            instance.name = _this.getProcessNameOrDescription(instance, 'medium');
            if (instance.started) {
                instance.started = moment(instance.started).format(_this.FORMAT_DATE);
            }
            return instance;
        });
        return instances;
    };
    /**
     * @param {?} processInstance
     * @param {?} dateFormat
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.getProcessNameOrDescription = /**
     * @param {?} processInstance
     * @param {?} dateFormat
     * @return {?}
     */
    function (processInstance, dateFormat) {
        /** @type {?} */
        var name = '';
        if (processInstance) {
            name = processInstance.name ||
                processInstance.processDefinitionName + ' - ' + this.getFormatDate(processInstance.started, dateFormat);
        }
        return name;
    };
    /**
     * @param {?} value
     * @param {?} format
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.getFormatDate = /**
     * @param {?} value
     * @param {?} format
     * @return {?}
     */
    function (value, format) {
        /** @type {?} */
        var datePipe = new DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            return '';
        }
    };
    /**
     * @private
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.createRequestNode = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var requestNode = {
            appDefinitionId: this.appId,
            processDefinitionId: this.processDefinitionId,
            processInstanceId: this.processInstanceId,
            state: this.state,
            sort: this.sort,
            page: this.page,
            size: this.size,
            start: 0
        };
        return new ProcessFilterParamRepresentationModel(requestNode);
    };
    /**
     * @param {?} params
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.updatePagination = /**
     * @param {?} params
     * @return {?}
     */
    function (params) {
        /** @type {?} */
        var needsReload = params.maxItems || params.skipCount;
        this.size = params.maxItems;
        this.page = this.currentPage(params.skipCount, params.maxItems);
        if (needsReload) {
            this.reload();
        }
    };
    /**
     * @param {?} skipCount
     * @param {?} maxItems
     * @return {?}
     */
    ProcessInstanceListComponent.prototype.currentPage = /**
     * @param {?} skipCount
     * @param {?} maxItems
     * @return {?}
     */
    function (skipCount, maxItems) {
        return (skipCount && maxItems) ? Math.floor(skipCount / maxItems) : 0;
    };
    ProcessInstanceListComponent.PRESET_KEY = 'adf-process-list.presets';
    ProcessInstanceListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-process-instance-list',
                    template: "<adf-datatable #dataTable\n    [data]=\"data\"\n    [rows]=\"rows\"\n    [columns]=\"columns\"\n    [sorting]=\"sorting\"\n    [loading]=\"isLoading\"\n    [selectionMode]=\"selectionMode\"\n    [multiselect]=\"multiselect\"\n    (rowClick)=\"onRowClick($event)\"\n    (row-keyup)=\"onRowKeyUp($event)\">\n    <adf-loading-content-template>\n        <ng-template>\n            <!--Add your custom loading template here-->\n            <mat-progress-spinner\n                *ngIf=\"!customLoadingContent\"\n                class=\"adf-process-list-loading-margin\"\n                [color]=\"'primary'\"\n                [mode]=\"'indeterminate'\">\n            </mat-progress-spinner>\n            <ng-content select=\"adf-custom-loading-content-template\"></ng-content>\n        </ng-template>\n    </adf-loading-content-template>\n    <adf-no-content-template>\n        <ng-template>\n                <adf-empty-content *ngIf=\"!customEmptyContent\"\n                    icon=\"assessment\"\n                    [title]=\"(requestNode ? 'ADF_PROCESS_LIST.LIST.TITLE' : 'ADF_PROCESS_LIST.FILTERS.MESSAGES.NONE') | translate \"\n                    [subtitle]=\"'ADF_PROCESS_LIST.LIST.SUBTITLE'| translate\">\n                </adf-empty-content>\n            <ng-content select=\"adf-custom-empty-content-template\"></ng-content>\n        </ng-template>\n    </adf-no-content-template>\n</adf-datatable>\n",
                    styles: [".adf-process-list-loading-margin{margin-left:calc((100% - 100px)/ 2);margin-right:calc((100% - 100px)/ 2)}.no-content-message{font-size:16px;font-weight:700;text-align:center;opacity:.54;color:#000}"]
                }] }
    ];
    /** @nocollapse */
    ProcessInstanceListComponent.ctorParameters = function () { return [
        { type: ProcessService },
        { type: UserPreferencesService },
        { type: AppConfigService }
    ]; };
    ProcessInstanceListComponent.propDecorators = {
        customEmptyContent: [{ type: ContentChild, args: [CustomEmptyContentTemplateDirective,] }],
        customLoadingContent: [{ type: ContentChild, args: [CustomLoadingContentTemplateDirective,] }],
        appId: [{ type: Input }],
        processDefinitionId: [{ type: Input }],
        processInstanceId: [{ type: Input }],
        state: [{ type: Input }],
        sort: [{ type: Input }],
        page: [{ type: Input }],
        size: [{ type: Input }],
        data: [{ type: Input }],
        multiselect: [{ type: Input }],
        selectionMode: [{ type: Input }],
        selectFirstRow: [{ type: Input }],
        rowClick: [{ type: Output }],
        success: [{ type: Output }],
        error: [{ type: Output }]
    };
    return ProcessInstanceListComponent;
}(DataTableSchema));
export { ProcessInstanceListComponent };
if (false) {
    /** @type {?} */
    ProcessInstanceListComponent.PRESET_KEY;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.FORMAT_DATE;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.customEmptyContent;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.customLoadingContent;
    /**
     * The id of the app.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.appId;
    /**
     * The Definition Id of the process.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.processDefinitionId;
    /**
     * The id of the process instance.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.processInstanceId;
    /**
     * Defines the state of the processes. Possible values are `running`, `completed` and `all`
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.state;
    /**
     * Defines the sort ordering of the list. Possible values are `created-desc`, `created-asc`,
     * `ended-desc`, `ended-asc`.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.sort;
    /**
     * The page number of the processes to fetch.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.page;
    /**
     * The number of processes to fetch in each page.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.size;
    /**
     * Data source to define the datatable.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.data;
    /**
     * Toggles multiple row selection, which renders checkboxes at the beginning of each row
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.multiselect;
    /**
     * Row selection mode. Can be none, `single` or `multiple`. For `multiple` mode,
     * you can use Cmd (macOS) or Ctrl (Win) modifier key to toggle selection for
     * multiple rows.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.selectionMode;
    /**
     * Toggles default selection of the first row
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.selectFirstRow;
    /**
     * Emitted when a row in the process list is clicked.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.rowClick;
    /**
     * Emitted when the list of process instances has been loaded successfully from the server.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.success;
    /**
     * Emitted when an error occurs while loading the list of process instances from the server.
     * @type {?}
     */
    ProcessInstanceListComponent.prototype.error;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.requestNode;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.currentInstanceId;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.isLoading;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.rows;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.sorting;
    /** @type {?} */
    ProcessInstanceListComponent.prototype.pagination;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceListComponent.prototype.processService;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceListComponent.prototype.userPreferences;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInByb2Nlc3MtbGlzdC9jb21wb25lbnRzL3Byb2Nlc3MtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFDSCxlQUFlLEVBR2YsbUNBQW1DLEVBQ25DLHFDQUFxQyxFQUN4QyxNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFDSCxnQkFBZ0IsRUFFaEIsbUJBQW1CLEVBRW5CLHNCQUFzQixFQUN6QixNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBRUgsU0FBUyxFQUNULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUVMLE1BQU0sRUFFVCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUscUNBQXFDLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN2RixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV2QyxPQUFPLE1BQU0sTUFBTSxZQUFZLENBQUM7QUFFaEM7SUFLa0Qsd0RBQWU7SUFnRjdELHNDQUFvQixjQUE4QixFQUM5QixlQUF1QyxFQUMvQyxTQUEyQjtRQUZ2QyxZQUdJLGtCQUFNLFNBQVMsRUFBRSw0QkFBNEIsQ0FBQyxVQUFVLEVBQUUsMEJBQTBCLENBQUMsU0FReEY7UUFYbUIsb0JBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLHFCQUFlLEdBQWYsZUFBZSxDQUF3QjtRQTlFcEQsaUJBQVcsR0FBVyxJQUFJLENBQUM7Ozs7UUFnQ2xD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QUtkLDRDQUNhOzs7OztJQUdiLDRDQUNpQjs7Ozs7SUFHakIsNENBQytEOzs7OztJQUcvRCw0Q0FDdUI7Ozs7O0lBR3ZCLG1EQUM2Qjs7Ozs7OztJQU03QixxREFDaUM7Ozs7O0lBR2pDLHNEQUMrQjs7Ozs7SUFHL0IsZ0RBQzREOzs7OztJQUc1RCwrQ0FDK0U7Ozs7O0lBRy9FLDZDQUNtRDs7SUFFbkQsbURBQW1EOztJQUNuRCx5REFBMEI7O0lBQzFCLGlEQUEwQjs7SUFDMUIsNENBQWlCOztJQUNqQiwrQ0FBcUM7O0lBRXJDLGtEQUE2Qzs7Ozs7SUFFakMsc0RBQXNDOzs7OztJQUN0Qyx1REFBK0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICAgIERhdGFUYWJsZVNjaGVtYSxcbiAgICBEYXRhUm93RXZlbnQsXG4gICAgRGF0YVRhYmxlQWRhcHRlcixcbiAgICBDdXN0b21FbXB0eUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSxcbiAgICBDdXN0b21Mb2FkaW5nQ29udGVudFRlbXBsYXRlRGlyZWN0aXZlXG59IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQge1xuICAgIEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgUGFnaW5hdGVkQ29tcG9uZW50LFxuICAgIFBhZ2luYXRpb25Db21wb25lbnQsXG4gICAgUGFnaW5hdGlvbk1vZGVsLFxuICAgIFVzZXJQcmVmZXJlbmNlc1NlcnZpY2Vcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBDb21wb25lbnQsXG4gICAgQ29udGVudENoaWxkLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPbkNoYW5nZXMsXG4gICAgT3V0cHV0LFxuICAgIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQcm9jZXNzRmlsdGVyUGFyYW1SZXByZXNlbnRhdGlvbk1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2ZpbHRlci1wcm9jZXNzLm1vZGVsJztcbmltcG9ydCB7IHByb2Nlc3NQcmVzZXRzRGVmYXVsdE1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2Nlc3MtcHJlc2V0Lm1vZGVsJztcbmltcG9ydCB7IFByb2Nlc3NTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcHJvY2Vzcy5zZXJ2aWNlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUHJvY2Vzc0xpc3RNb2RlbCB9IGZyb20gJy4uL21vZGVscy9wcm9jZXNzLWxpc3QubW9kZWwnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQtZXM2JztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtcHJvY2Vzcy1pbnN0YW5jZS1saXN0JyxcbiAgICBzdHlsZVVybHM6IFsnLi9wcm9jZXNzLWxpc3QuY29tcG9uZW50LmNzcyddLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9wcm9jZXNzLWxpc3QuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFByb2Nlc3NJbnN0YW5jZUxpc3RDb21wb25lbnQgZXh0ZW5kcyBEYXRhVGFibGVTY2hlbWEgIGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlckNvbnRlbnRJbml0LCBQYWdpbmF0ZWRDb21wb25lbnQge1xuXG4gICAgc3RhdGljIFBSRVNFVF9LRVkgPSAnYWRmLXByb2Nlc3MtbGlzdC5wcmVzZXRzJztcbiAgICBwdWJsaWMgRk9STUFUX0RBVEU6IHN0cmluZyA9ICdsbCc7XG5cbiAgICBAQ29udGVudENoaWxkKEN1c3RvbUVtcHR5Q29udGVudFRlbXBsYXRlRGlyZWN0aXZlKVxuICAgIGN1c3RvbUVtcHR5Q29udGVudDogQ3VzdG9tRW1wdHlDb250ZW50VGVtcGxhdGVEaXJlY3RpdmU7XG5cbiAgICBAQ29udGVudENoaWxkKEN1c3RvbUxvYWRpbmdDb250ZW50VGVtcGxhdGVEaXJlY3RpdmUpXG4gICAgY3VzdG9tTG9hZGluZ0NvbnRlbnQ6IEN1c3RvbUxvYWRpbmdDb250ZW50VGVtcGxhdGVEaXJlY3RpdmU7XG5cbiAgICAvKiogVGhlIGlkIG9mIHRoZSBhcHAuICovXG4gICAgQElucHV0KClcbiAgICBhcHBJZDogbnVtYmVyO1xuXG4gICAgLyoqIFRoZSBEZWZpbml0aW9uIElkIG9mIHRoZSBwcm9jZXNzLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0RlZmluaXRpb25JZDogc3RyaW5nO1xuXG4gICAgLyoqIFRoZSBpZCBvZiB0aGUgcHJvY2VzcyBpbnN0YW5jZS4gKi9cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NJbnN0YW5jZUlkOiBudW1iZXJ8c3RyaW5nO1xuXG4gICAgLyoqIERlZmluZXMgdGhlIHN0YXRlIG9mIHRoZSBwcm9jZXNzZXMuIFBvc3NpYmxlIHZhbHVlcyBhcmUgYHJ1bm5pbmdgLCBgY29tcGxldGVkYCBhbmQgYGFsbGAgKi9cbiAgICBASW5wdXQoKVxuICAgIHN0YXRlOiBzdHJpbmc7XG5cbiAgICAvKiogRGVmaW5lcyB0aGUgc29ydCBvcmRlcmluZyBvZiB0aGUgbGlzdC4gUG9zc2libGUgdmFsdWVzIGFyZSBgY3JlYXRlZC1kZXNjYCwgYGNyZWF0ZWQtYXNjYCxcbiAgICAgKiBgZW5kZWQtZGVzY2AsIGBlbmRlZC1hc2NgLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgc29ydDogc3RyaW5nO1xuXG4gICAgLyoqIFRoZSBwYWdlIG51bWJlciBvZiB0aGUgcHJvY2Vzc2VzIHRvIGZldGNoLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcGFnZTogbnVtYmVyID0gMDtcblxuICAgIC8qKiBUaGUgbnVtYmVyIG9mIHByb2Nlc3NlcyB0byBmZXRjaCBpbiBlYWNoIHBhZ2UuICovXG4gICAgQElucHV0KClcbiAgICBzaXplOiBudW1iZXIgPSBQYWdpbmF0aW9uQ29tcG9uZW50LkRFRkFVTFRfUEFHSU5BVElPTi5tYXhJdGVtcztcblxuICAgIC8qKiBEYXRhIHNvdXJjZSB0byBkZWZpbmUgdGhlIGRhdGF0YWJsZS4gKi9cbiAgICBASW5wdXQoKVxuICAgIGRhdGE6IERhdGFUYWJsZUFkYXB0ZXI7XG5cbiAgICAvKiogVG9nZ2xlcyBtdWx0aXBsZSByb3cgc2VsZWN0aW9uLCB3aGljaCByZW5kZXJzIGNoZWNrYm94ZXMgYXQgdGhlIGJlZ2lubmluZyBvZiBlYWNoIHJvdyAqL1xuICAgIEBJbnB1dCgpXG4gICAgbXVsdGlzZWxlY3Q6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKiBSb3cgc2VsZWN0aW9uIG1vZGUuIENhbiBiZSBub25lLCBgc2luZ2xlYCBvciBgbXVsdGlwbGVgLiBGb3IgYG11bHRpcGxlYCBtb2RlLFxuICAgICAqIHlvdSBjYW4gdXNlIENtZCAobWFjT1MpIG9yIEN0cmwgKFdpbikgbW9kaWZpZXIga2V5IHRvIHRvZ2dsZSBzZWxlY3Rpb24gZm9yXG4gICAgICogbXVsdGlwbGUgcm93cy5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNlbGVjdGlvbk1vZGU6IHN0cmluZyA9ICdzaW5nbGUnOyAvLyBub25lfHNpbmdsZXxtdWx0aXBsZVxuXG4gICAgLyoqIFRvZ2dsZXMgZGVmYXVsdCBzZWxlY3Rpb24gb2YgdGhlIGZpcnN0IHJvdyAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2VsZWN0Rmlyc3RSb3c6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIHJvdyBpbiB0aGUgcHJvY2VzcyBsaXN0IGlzIGNsaWNrZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgcm93Q2xpY2s6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBsaXN0IG9mIHByb2Nlc3MgaW5zdGFuY2VzIGhhcyBiZWVuIGxvYWRlZCBzdWNjZXNzZnVsbHkgZnJvbSB0aGUgc2VydmVyLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHN1Y2Nlc3M6IEV2ZW50RW1pdHRlcjxQcm9jZXNzTGlzdE1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8UHJvY2Vzc0xpc3RNb2RlbD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzIHdoaWxlIGxvYWRpbmcgdGhlIGxpc3Qgb2YgcHJvY2VzcyBpbnN0YW5jZXMgZnJvbSB0aGUgc2VydmVyLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgcmVxdWVzdE5vZGU6IFByb2Nlc3NGaWx0ZXJQYXJhbVJlcHJlc2VudGF0aW9uTW9kZWw7XG4gICAgY3VycmVudEluc3RhbmNlSWQ6IHN0cmluZztcbiAgICBpc0xvYWRpbmc6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHJvd3M6IGFueVtdID0gW107XG4gICAgc29ydGluZzogYW55W10gPSBbJ2NyZWF0ZWQnLCAnZGVzYyddO1xuXG4gICAgcGFnaW5hdGlvbjogQmVoYXZpb3JTdWJqZWN0PFBhZ2luYXRpb25Nb2RlbD47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHByb2Nlc3NTZXJ2aWNlOiBQcm9jZXNzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHVzZXJQcmVmZXJlbmNlczogVXNlclByZWZlcmVuY2VzU2VydmljZSxcbiAgICAgICAgICAgICAgICBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIoYXBwQ29uZmlnLCBQcm9jZXNzSW5zdGFuY2VMaXN0Q29tcG9uZW50LlBSRVNFVF9LRVksIHByb2Nlc3NQcmVzZXRzRGVmYXVsdE1vZGVsKTtcbiAgICAgICAgdGhpcy5zaXplID0gdGhpcy51c2VyUHJlZmVyZW5jZXMucGFnaW5hdGlvblNpemU7XG5cbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uID0gbmV3IEJlaGF2aW9yU3ViamVjdDxQYWdpbmF0aW9uTW9kZWw+KDxQYWdpbmF0aW9uTW9kZWw+IHtcbiAgICAgICAgICAgIG1heEl0ZW1zOiB0aGlzLnNpemUsXG4gICAgICAgICAgICBza2lwQ291bnQ6IDAsXG4gICAgICAgICAgICB0b3RhbEl0ZW1zOiAwXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVEYXRhdGFibGVTY2hlbWEoKTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEuZ2V0Q29sdW1ucygpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5kYXRhLnNldENvbHVtbnModGhpcy5jb2x1bW5zKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmFwcElkICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMucmVsb2FkKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUHJvcGVydHlDaGFuZ2VkKGNoYW5nZXMpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1NvcnRDaGFuZ2VkKGNoYW5nZXMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0aW5nID0gdGhpcy5zb3J0ID8gdGhpcy5zb3J0LnNwbGl0KCctJykgOiB0aGlzLnNvcnRpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1NvcnRDaGFuZ2VkKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgYWN0dWFsU29ydCA9IGNoYW5nZXNbJ3NvcnQnXTtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFNvcnQgJiYgYWN0dWFsU29ydC5jdXJyZW50VmFsdWUgJiYgYWN0dWFsU29ydC5jdXJyZW50VmFsdWUgIT09IGFjdHVhbFNvcnQucHJldmlvdXNWYWx1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzUHJvcGVydHlDaGFuZ2VkKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiBib29sZWFuIHtcbiAgICAgICAgbGV0IGNoYW5nZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgICAgICBsZXQgYXBwSWQgPSBjaGFuZ2VzWydhcHBJZCddO1xuICAgICAgICBsZXQgcHJvY2Vzc0RlZmluaXRpb25JZCA9IGNoYW5nZXNbJ3Byb2Nlc3NEZWZpbml0aW9uSWQnXTtcbiAgICAgICAgbGV0IHByb2Nlc3NJbnN0YW5jZUlkID0gY2hhbmdlc1sncHJvY2Vzc0luc3RhbmNlSWQnXTtcbiAgICAgICAgbGV0IHN0YXRlID0gY2hhbmdlc1snc3RhdGUnXTtcbiAgICAgICAgbGV0IHNvcnQgPSBjaGFuZ2VzWydzb3J0J107XG4gICAgICAgIGxldCBwYWdlID0gY2hhbmdlc1sncGFnZSddO1xuICAgICAgICBsZXQgc2l6ZSA9IGNoYW5nZXNbJ3NpemUnXTtcblxuICAgICAgICBpZiAoYXBwSWQgJiYgYXBwSWQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzRGVmaW5pdGlvbklkKSB7XG4gICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzSW5zdGFuY2VJZCkge1xuICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgJiYgc3RhdGUuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzb3J0ICYmIHNvcnQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChwYWdlICYmIHBhZ2UuY3VycmVudFZhbHVlICE9PSBwYWdlLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHNpemUgJiYgc2l6ZS5jdXJyZW50VmFsdWUgIT09IHNpemUucHJldmlvdXNWYWx1ZSkge1xuICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoYW5nZWQ7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbG9hZCgpIHtcbiAgICAgICAgdGhpcy5yZXF1ZXN0Tm9kZSA9IHRoaXMuY3JlYXRlUmVxdWVzdE5vZGUoKTtcbiAgICAgICAgdGhpcy5sb2FkKHRoaXMucmVxdWVzdE5vZGUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbG9hZChyZXF1ZXN0Tm9kZTogUHJvY2Vzc0ZpbHRlclBhcmFtUmVwcmVzZW50YXRpb25Nb2RlbCkge1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMucHJvY2Vzc1NlcnZpY2UuZ2V0UHJvY2Vzc2VzKHJlcXVlc3ROb2RlKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dzID0gdGhpcy5vcHRpbWl6ZVByb2Nlc3NEZXRhaWxzKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdEZpcnN0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzcy5lbWl0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uLm5leHQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHJlc3BvbnNlLmRhdGEubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SXRlbXM6IHRoaXMuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNraXBDb3VudDogdGhpcy5wYWdlICogdGhpcy5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxJdGVtczogcmVzcG9uc2UudG90YWxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3QgdGhlIGZpcnN0IGluc3RhbmNlIG9mIGEgbGlzdCBpZiBwcmVzZW50XG4gICAgICovXG4gICAgc2VsZWN0Rmlyc3QoKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdEZpcnN0Um93KSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNMaXN0RW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGxldCBkYXRhUm93ID0gdGhpcy5yb3dzWzBdO1xuICAgICAgICAgICAgICAgIGRhdGFSb3cuaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2VJZCA9IGRhdGFSb3dbJ2lkJ107XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEluc3RhbmNlSWQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBjdXJyZW50IGlkXG4gICAgICovXG4gICAgZ2V0Q3VycmVudElkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbnN0YW5jZUlkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSBsaXN0IGlzIGVtcHR5XG4gICAgICovXG4gICAgaXNMaXN0RW1wdHkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5yb3dzIHx8IHRoaXMucm93cy5sZW5ndGggPT09IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW1pdCB0aGUgZXZlbnQgcm93Q2xpY2sgcGFzc2luZyB0aGUgY3VycmVudCB0YXNrIGlkIHdoZW4gdGhlIHJvdyBpcyBjbGlja2VkXG4gICAgICogQHBhcmFtIGV2ZW50XG4gICAgICovXG4gICAgb25Sb3dDbGljayhldmVudDogRGF0YVJvd0V2ZW50KSB7XG4gICAgICAgIGxldCBpdGVtID0gZXZlbnQ7XG4gICAgICAgIHRoaXMuY3VycmVudEluc3RhbmNlSWQgPSBpdGVtLnZhbHVlLmdldFZhbHVlKCdpZCcpO1xuICAgICAgICB0aGlzLnJvd0NsaWNrLmVtaXQodGhpcy5jdXJyZW50SW5zdGFuY2VJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW1pdCB0aGUgZXZlbnQgcm93Q2xpY2sgcGFzc2luZyB0aGUgY3VycmVudCB0YXNrIGlkIHdoZW4gcHJlc3NlZCB0aGUgRW50ZXIga2V5IG9uIHRoZSBzZWxlY3RlZCByb3dcbiAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgKi9cbiAgICBvblJvd0tleVVwKGV2ZW50OiBDdXN0b21FdmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuZGV0YWlsLmtleWJvYXJkRXZlbnQua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2VJZCA9IGV2ZW50LmRldGFpbC5yb3cuZ2V0VmFsdWUoJ2lkJyk7XG4gICAgICAgICAgICB0aGlzLnJvd0NsaWNrLmVtaXQodGhpcy5jdXJyZW50SW5zdGFuY2VJZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcHRpbWl6ZSBuYW1lIGZpZWxkXG4gICAgICogQHBhcmFtIGluc3RhbmNlc1xuICAgICAqL1xuICAgIHByaXZhdGUgb3B0aW1pemVQcm9jZXNzRGV0YWlscyhpbnN0YW5jZXM6IGFueVtdKTogYW55W10ge1xuICAgICAgICBpbnN0YW5jZXMgPSBpbnN0YW5jZXMubWFwKChpbnN0YW5jZSkgPT4ge1xuICAgICAgICAgICAgaW5zdGFuY2UubmFtZSA9IHRoaXMuZ2V0UHJvY2Vzc05hbWVPckRlc2NyaXB0aW9uKGluc3RhbmNlLCAnbWVkaXVtJyk7XG4gICAgICAgICAgICBpZiAoaW5zdGFuY2Uuc3RhcnRlZCkge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLnN0YXJ0ZWQgPSBtb21lbnQoaW5zdGFuY2Uuc3RhcnRlZCkuZm9ybWF0KHRoaXMuRk9STUFUX0RBVEUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlcztcbiAgICB9XG5cbiAgICBnZXRQcm9jZXNzTmFtZU9yRGVzY3JpcHRpb24ocHJvY2Vzc0luc3RhbmNlLCBkYXRlRm9ybWF0KTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG5hbWUgPSAnJztcbiAgICAgICAgaWYgKHByb2Nlc3NJbnN0YW5jZSkge1xuICAgICAgICAgICAgbmFtZSA9IHByb2Nlc3NJbnN0YW5jZS5uYW1lIHx8XG4gICAgICAgICAgICAgICAgcHJvY2Vzc0luc3RhbmNlLnByb2Nlc3NEZWZpbml0aW9uTmFtZSArICcgLSAnICsgdGhpcy5nZXRGb3JtYXREYXRlKHByb2Nlc3NJbnN0YW5jZS5zdGFydGVkLCBkYXRlRm9ybWF0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICB9XG5cbiAgICBnZXRGb3JtYXREYXRlKHZhbHVlLCBmb3JtYXQ6IHN0cmluZykge1xuICAgICAgICBsZXQgZGF0ZVBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0ZVBpcGUudHJhbnNmb3JtKHZhbHVlLCBmb3JtYXQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlUmVxdWVzdE5vZGUoKSB7XG4gICAgICAgIGxldCByZXF1ZXN0Tm9kZSA9IHtcbiAgICAgICAgICAgIGFwcERlZmluaXRpb25JZDogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgIHByb2Nlc3NEZWZpbml0aW9uSWQ6IHRoaXMucHJvY2Vzc0RlZmluaXRpb25JZCxcbiAgICAgICAgICAgIHByb2Nlc3NJbnN0YW5jZUlkOiB0aGlzLnByb2Nlc3NJbnN0YW5jZUlkLFxuICAgICAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICAgICAgICBzb3J0OiB0aGlzLnNvcnQsXG4gICAgICAgICAgICBwYWdlOiB0aGlzLnBhZ2UsXG4gICAgICAgICAgICBzaXplOiB0aGlzLnNpemUsXG4gICAgICAgICAgICBzdGFydDogMFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gbmV3IFByb2Nlc3NGaWx0ZXJQYXJhbVJlcHJlc2VudGF0aW9uTW9kZWwocmVxdWVzdE5vZGUpO1xuICAgIH1cblxuICAgIHVwZGF0ZVBhZ2luYXRpb24ocGFyYW1zOiBQYWdpbmF0aW9uTW9kZWwpIHtcbiAgICAgICAgY29uc3QgbmVlZHNSZWxvYWQgPSBwYXJhbXMubWF4SXRlbXMgfHwgcGFyYW1zLnNraXBDb3VudDtcbiAgICAgICAgdGhpcy5zaXplID0gcGFyYW1zLm1heEl0ZW1zO1xuICAgICAgICB0aGlzLnBhZ2UgPSB0aGlzLmN1cnJlbnRQYWdlKHBhcmFtcy5za2lwQ291bnQsIHBhcmFtcy5tYXhJdGVtcyk7XG4gICAgICAgIGlmIChuZWVkc1JlbG9hZCkge1xuICAgICAgICAgICAgdGhpcy5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGN1cnJlbnRQYWdlKHNraXBDb3VudDogbnVtYmVyLCBtYXhJdGVtczogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIChza2lwQ291bnQgJiYgbWF4SXRlbXMpID8gTWF0aC5mbG9vcihza2lwQ291bnQgLyBtYXhJdGVtcykgOiAwO1xuICAgIH1cbn1cbiJdfQ==