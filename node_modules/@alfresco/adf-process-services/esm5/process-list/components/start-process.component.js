/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewChild, ViewEncapsulation } from '@angular/core';
import { ActivitiContentService, AppConfigService, AppConfigValues, StartFormComponent, FormRenderingService } from '@alfresco/adf-core';
import { ProcessDefinitionRepresentation } from './../models/process-definition.model';
import { ProcessService } from './../services/process.service';
import { AttachFileWidgetComponent, AttachFolderWidgetComponent } from '../../content-widget';
import { FormControl, Validators } from '@angular/forms';
import { map } from 'rxjs/operators';
import { MatAutocompleteTrigger } from '@angular/material';
var StartProcessInstanceComponent = /** @class */ (function () {
    function StartProcessInstanceComponent(activitiProcess, formRenderingService, activitiContentService, appConfig) {
        this.activitiProcess = activitiProcess;
        this.formRenderingService = formRenderingService;
        this.activitiContentService = activitiContentService;
        this.appConfig = appConfig;
        this.MAX_LENGTH = 255;
        /**
         * (optional) Name to assign to the current process.
         */
        this.name = '';
        /**
         * Hide or show the process selection dropdown.
         */
        this.showSelectProcessDropdown = true;
        /**
         * (optional) Parameter to enable selection of process when filtering.
         */
        this.processFilterSelector = true;
        /**
         * Emitted when the process starts.
         */
        this.start = new EventEmitter();
        /**
         * Emitted when the process is canceled.
         */
        this.cancel = new EventEmitter();
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        this.processDefinitions = [];
        this.selectedProcessDef = new ProcessDefinitionRepresentation();
        this.errorMessageId = '';
        this.maxProcessNameLength = this.MAX_LENGTH;
        this.formRenderingService.setComponentTypeResolver('upload', function () { return AttachFileWidgetComponent; }, true);
        this.formRenderingService.setComponentTypeResolver('select-folder', function () { return AttachFolderWidgetComponent; }, true);
    }
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.processNameInput = new FormControl(this.name, [Validators.required, Validators.maxLength(this.maxProcessNameLength)]);
        this.processDefinitionInput = new FormControl();
        this.loadStartProcess();
        this.processNameInput.valueChanges.subscribe(function (name) { return _this.name = name; });
        this.filteredProcesses = this.processDefinitionInput.valueChanges
            .pipe(map(function (value) { return _this._filter(value); }));
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes['values'] && changes['values'].currentValue) {
            this.moveNodeFromCStoPS();
        }
        if (changes['appId'] && changes['appId'].currentValue) {
            this.appId = changes['appId'].currentValue;
        }
        this.loadStartProcess();
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    StartProcessInstanceComponent.prototype._filter = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value !== null && value !== undefined) {
            /** @type {?} */
            var filterValue_1 = value.toLowerCase();
            /** @type {?} */
            var filteredProcess = this.processDefinitions.filter(function (option) { return option.name.toLowerCase().includes(filterValue_1); });
            if (this.processFilterSelector) {
                this.selectedProcessDef = this.getSelectedProcess(filterValue_1);
            }
            return filteredProcess;
        }
    };
    /**
     * @param {?} selectedProcess
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.getSelectedProcess = /**
     * @param {?} selectedProcess
     * @return {?}
     */
    function (selectedProcess) {
        /** @type {?} */
        var processSelected = this.processDefinitions.find(function (process) { return process.name.toLowerCase() === selectedProcess; });
        if (!processSelected) {
            processSelected = new ProcessDefinitionRepresentation();
        }
        return processSelected;
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.loadStartProcess = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.resetSelectedProcessDefinition();
        this.resetErrorMessage();
        this.activitiProcess.getProcessDefinitions(this.appId).subscribe(function (processDefinitionRepresentations) {
            _this.processDefinitions = processDefinitionRepresentations;
            if (!_this.isProcessDefinitionsEmpty()) {
                if (_this.processDefinitions.length === 1) {
                    _this.selectedProcessDef = _this.processDefinitions[0];
                }
                if (_this.processDefinitionName) {
                    /** @type {?} */
                    var selectedProcess = _this.processDefinitions.find(function (currentProcessDefinition) {
                        return currentProcessDefinition.name === _this.processDefinitionName;
                    });
                    if (selectedProcess) {
                        _this.selectedProcessDef = selectedProcess;
                    }
                }
                _this.processDefinitionInput.setValue(_this.selectedProcessDef.name);
            }
        }, function () {
            _this.errorMessageId = 'ADF_PROCESS_LIST.START_PROCESS.ERROR.LOAD_PROCESS_DEFS';
        });
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.isProcessDefinitionsEmpty = /**
     * @return {?}
     */
    function () {
        return this.processDefinitions.length === 0;
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.getAlfrescoRepositoryName = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var alfrescoRepositoryName = this.appConfig.get(AppConfigValues.ALFRESCO_REPOSITORY_NAME);
        if (!alfrescoRepositoryName) {
            alfrescoRepositoryName = 'alfresco-1';
        }
        return alfrescoRepositoryName + 'Alfresco';
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.moveNodeFromCStoPS = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var accountIdentifier = this.getAlfrescoRepositoryName();
        var _loop_1 = function (key) {
            if (this_1.values.hasOwnProperty(key)) {
                /** @type {?} */
                var currentValue = this_1.values[key];
                if (currentValue.isFile) {
                    this_1.activitiContentService.applyAlfrescoNode(currentValue, null, accountIdentifier).subscribe(function (res) {
                        _this.values[key] = [res];
                    });
                }
            }
        };
        var this_1 = this;
        for (var key in this.values) {
            _loop_1(key);
        }
    };
    /**
     * @param {?=} outcome
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.startProcess = /**
     * @param {?=} outcome
     * @return {?}
     */
    function (outcome) {
        var _this = this;
        if (this.selectedProcessDef && this.selectedProcessDef.id && this.name) {
            this.resetErrorMessage();
            /** @type {?} */
            var formValues = this.startForm ? this.startForm.form.values : undefined;
            this.activitiProcess.startProcess(this.selectedProcessDef.id, this.name, outcome, formValues, this.variables).subscribe(function (res) {
                _this.name = '';
                _this.start.emit(res);
            }, function (err) {
                _this.errorMessageId = 'ADF_PROCESS_LIST.START_PROCESS.ERROR.START';
                _this.error.error(err);
            });
        }
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.cancelStartProcess = /**
     * @return {?}
     */
    function () {
        this.cancel.emit();
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.hasStartForm = /**
     * @return {?}
     */
    function () {
        return this.selectedProcessDef && this.selectedProcessDef.hasStartForm;
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.isProcessDefinitionEmpty = /**
     * @return {?}
     */
    function () {
        return this.processDefinitions ? (this.processDefinitions.length > 0 || this.errorMessageId) : this.errorMessageId;
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.isStartFormMissingOrValid = /**
     * @return {?}
     */
    function () {
        if (this.startForm) {
            return this.startForm.form && this.startForm.form.isValid;
        }
        else {
            return true;
        }
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.validateForm = /**
     * @return {?}
     */
    function () {
        return this.selectedProcessDef && this.selectedProcessDef.id && this.processNameInput.valid && this.isStartFormMissingOrValid();
    };
    /**
     * @private
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.resetSelectedProcessDefinition = /**
     * @private
     * @return {?}
     */
    function () {
        this.selectedProcessDef = new ProcessDefinitionRepresentation();
    };
    /**
     * @private
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.resetErrorMessage = /**
     * @private
     * @return {?}
     */
    function () {
        this.errorMessageId = '';
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.hasErrorMessage = /**
     * @return {?}
     */
    function () {
        return this.processDefinitions.length === 0 && !this.errorMessageId;
    };
    /**
     * @param {?} outcome
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.onOutcomeClick = /**
     * @param {?} outcome
     * @return {?}
     */
    function (outcome) {
        this.startProcess(outcome);
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.reset = /**
     * @return {?}
     */
    function () {
        this.resetSelectedProcessDefinition();
        this.name = '';
        if (this.startForm) {
            this.startForm.data = {};
        }
        this.resetErrorMessage();
    };
    /**
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.hasProcessName = /**
     * @return {?}
     */
    function () {
        return this.name ? true : false;
    };
    /**
     * @param {?} process
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.displayFn = /**
     * @param {?} process
     * @return {?}
     */
    function (process) {
        if (process) {
            /** @type {?} */
            var processName = process;
            if (typeof process !== 'string') {
                processName = process.name;
            }
            return processName;
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    StartProcessInstanceComponent.prototype.displayDropdown = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.stopPropagation();
        if (!this.inputAutocomplete.panelOpen) {
            this.processDefinitionInput.setValue('');
            this.inputAutocomplete.openPanel();
        }
        else {
            this.inputAutocomplete.closePanel();
        }
    };
    Object.defineProperty(StartProcessInstanceComponent.prototype, "nameController", {
        get: /**
         * @return {?}
         */
        function () {
            return this.processNameInput;
        },
        enumerable: true,
        configurable: true
    });
    StartProcessInstanceComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-start-process',
                    template: "<mat-card class=\"adf-start-process\">\n    <mat-card-title>{{'ADF_PROCESS_LIST.START_PROCESS.FORM.TITLE' | translate}}\n    </mat-card-title>\n    <mat-card-content *ngIf=\"isProcessDefinitionEmpty()\">\n        <mat-card-subtitle id=\"error-message\" *ngIf=\"errorMessageId\">\n            {{errorMessageId|translate}}\n        </mat-card-subtitle>\n        <mat-form-field class=\"adf-process-input-container\">\n            <input\n                matInput\n                placeholder=\"{{'ADF_PROCESS_LIST.START_PROCESS.FORM.LABEL.NAME' | translate}}\"\n                [formControl]=\"processNameInput\"\n                id=\"processName\"\n                required/>\n                <mat-error *ngIf=\"nameController.hasError('maxlength')\">\n                    {{ 'ADF_PROCESS_LIST.START_PROCESS.ERROR.MAXIMUM_LENGTH' | translate : { characters : maxProcessNameLength } }}\n                </mat-error>\n        </mat-form-field>\n        <mat-form-field class=\"adf-process-input-container\">\n            <input\n                type=\"text\"\n                placeholder=\"{{'ADF_PROCESS_LIST.START_PROCESS.FORM.LABEL.TYPE'|translate}}\"\n                matInput\n                [formControl]=\"processDefinitionInput\"\n                [matAutocomplete]=\"auto\"\n                id=\"processDefinitionName\"\n                #inputAutocomplete>\n            <div class=\"adf-process-input-autocomplete\">\n                <mat-autocomplete\n                    #auto=\"matAutocomplete\"\n                    id=\"processDefinitionOptions\"\n                    [displayWith]=\"displayFn\">\n                    <mat-option *ngFor=\"let processDef of filteredProcesses | async\" [value]=\"processDef.name\">\n                        {{ processDef.name }}\n                    </mat-option>\n                </mat-autocomplete>\n                <button\n                    id=\"adf-select-process-dropdown\"\n                    *ngIf=\"showSelectProcessDropdown\"\n                    mat-icon-button\n                    (click)=\"displayDropdown($event)\">\n                    <mat-icon>arrow_drop_down</mat-icon>\n                </button>\n            </div>\n        </mat-form-field>\n\n        <adf-start-form\n            #startForm\n            *ngIf=\"hasStartForm()\"\n            [data]=\"values\"\n            [disableStartProcessButton]=\"!hasProcessName()\"\n            [processDefinitionId]=\"selectedProcessDef.id\"\n            (outcomeClick)=\"onOutcomeClick($event)\"\n            [showRefreshButton]=\"false\">\n            <button\n                adf-form-custom-button\n                mat-button\n                (click)=\"cancelStartProcess()\"\n                id=\"cancel_process\">\n                {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.CANCEL'| translate | uppercase}}\n            </button>\n        </adf-start-form>\n    </mat-card-content>\n    <mat-card-content *ngIf=\"hasErrorMessage()\">\n        <mat-card-subtitle class=\"error-message\" id=\"no-process-message\">\n            {{'ADF_PROCESS_LIST.START_PROCESS.NO_PROCESS_DEFINITIONS' | translate | uppercase}}\n        </mat-card-subtitle>\n    </mat-card-content>\n    <mat-card-actions *ngIf=\"!hasStartForm()\">\n        <button\n            mat-button\n            *ngIf=\"!hasStartForm()\"\n            (click)=\"cancelStartProcess()\"\n            id=\"cancel_process\">\n            {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.CANCEL'| translate | uppercase}}\n        </button>\n        <button\n            color=\"primary\"\n            mat-button\n            *ngIf=\"!hasStartForm()\"\n            [disabled]=\"!validateForm()\"\n            (click)=\"startProcess()\"\n            data-automation-id=\"btn-start\"\n            id=\"button-start\"\n            class=\"btn-start\">\n            {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.START' | translate | uppercase}}\n        </button>\n    </mat-card-actions>\n</mat-card>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".adf-start-process{width:66%;margin-left:auto;margin-right:auto;margin-top:10px}.adf-start-process .mat-select-trigger{font-size:14px!important}.adf-start-process mat-form-field{width:100%}.adf-start-process mat-select{width:100%;padding:16px 0 0}.adf-start-process mat-card-actions{text-align:right}.adf-start-process mat-card-actions .mat-button{text-transform:uppercase!important}.adf-process-input-container mat-form-field{width:100%}.adf-process-input-autocomplete{display:flex}.adf-process-input-autocomplete button{position:absolute;right:-14px;top:0}.adf-start-form-container .mat-card{box-shadow:none!important;padding:0!important}.adf-start-form-actions{text-align:right!important}@media (max-width:600px){.adf-start-process{width:90%;margin-left:auto;margin-right:auto}}"]
                }] }
    ];
    /** @nocollapse */
    StartProcessInstanceComponent.ctorParameters = function () { return [
        { type: ProcessService },
        { type: FormRenderingService },
        { type: ActivitiContentService },
        { type: AppConfigService }
    ]; };
    StartProcessInstanceComponent.propDecorators = {
        appId: [{ type: Input }],
        processDefinitionName: [{ type: Input }],
        variables: [{ type: Input }],
        values: [{ type: Input }],
        name: [{ type: Input }],
        showSelectProcessDropdown: [{ type: Input }],
        processFilterSelector: [{ type: Input }],
        start: [{ type: Output }],
        cancel: [{ type: Output }],
        error: [{ type: Output }],
        startForm: [{ type: ViewChild, args: ['startForm',] }],
        inputAutocomplete: [{ type: ViewChild, args: [MatAutocompleteTrigger,] }]
    };
    return StartProcessInstanceComponent;
}());
export { StartProcessInstanceComponent };
if (false) {
    /** @type {?} */
    StartProcessInstanceComponent.prototype.MAX_LENGTH;
    /**
     * (optional) Limit the list of processes that can be started to those
     * contained in the specified app.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.appId;
    /**
     * (optional) Definition name of the process to start.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.processDefinitionName;
    /**
     * Variables in the input to the process
     * [RestVariable](https://github.com/Alfresco/alfresco-js-api/tree/master/src/alfresco-activiti-rest-api/docs/RestVariable.md).
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.variables;
    /**
     * Parameter to pass form field values in the start form if one is associated.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.values;
    /**
     * (optional) Name to assign to the current process.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.name;
    /**
     * Hide or show the process selection dropdown.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.showSelectProcessDropdown;
    /**
     * (optional) Parameter to enable selection of process when filtering.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.processFilterSelector;
    /**
     * Emitted when the process starts.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.start;
    /**
     * Emitted when the process is canceled.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.cancel;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    StartProcessInstanceComponent.prototype.error;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.startForm;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.inputAutocomplete;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.processDefinitions;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.selectedProcessDef;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.errorMessageId;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.processNameInput;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.processDefinitionInput;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.filteredProcesses;
    /** @type {?} */
    StartProcessInstanceComponent.prototype.maxProcessNameLength;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.activitiProcess;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.formRenderingService;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.activitiContentService;
    /**
     * @type {?}
     * @private
     */
    StartProcessInstanceComponent.prototype.appConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnQtcHJvY2Vzcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLXByb2Nlc3Mtc2VydmljZXMvIiwic291cmNlcyI6WyJwcm9jZXNzLWxpc3QvY29tcG9uZW50cy9zdGFydC1wcm9jZXNzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQ0gsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQzlCLE1BQU0sRUFBaUIsU0FBUyxFQUFFLGlCQUFpQixFQUN0RCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0gsc0JBQXNCLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxFQUN6RCxrQkFBa0IsRUFBRSxvQkFBb0IsRUFDM0MsTUFBTSxvQkFBb0IsQ0FBQztBQUU1QixPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUV2RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLHlCQUF5QixFQUFFLDJCQUEyQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUYsT0FBTyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQW1CLE1BQU0sZ0JBQWdCLENBQUM7QUFFMUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRTNEO0lBb0VJLHVDQUFvQixlQUErQixFQUMvQixvQkFBMEMsRUFDMUMsc0JBQThDLEVBQzlDLFNBQTJCO1FBSDNCLG9CQUFlLEdBQWYsZUFBZSxDQUFnQjtRQUMvQix5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBQzFDLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7UUFDOUMsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUEvRC9DLGVBQVUsR0FBVyxHQUFHLENBQUM7Ozs7UUF3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aUJBQ3hDOzs7O2dCQVpRLGNBQWM7Z0JBTEMsb0JBQW9CO2dCQUR4QyxzQkFBc0I7Z0JBQUUsZ0JBQWdCOzs7d0JBMEJ2QyxLQUFLO3dDQUlMLEtBQUs7NEJBTUwsS0FBSzt5QkFJTCxLQUFLO3VCQUlMLEtBQUs7NENBSUwsS0FBSzt3Q0FJTCxLQUFLO3dCQUlMLE1BQU07eUJBSU4sTUFBTTt3QkFJTixNQUFNOzRCQUdOLFNBQVMsU0FBQyxXQUFXO29DQUdyQixTQUFTLFNBQUMsc0JBQXNCOztJQXlOckMsb0NBQUM7Q0FBQSxBQWxSRCxJQWtSQztTQTVRWSw2QkFBNkI7OztJQUV0QyxtREFBeUI7Ozs7OztJQUt6Qiw4Q0FDYzs7Ozs7SUFHZCw4REFDOEI7Ozs7OztJQUs5QixrREFDcUM7Ozs7O0lBR3JDLCtDQUNtQjs7Ozs7SUFHbkIsNkNBQ2tCOzs7OztJQUdsQixrRUFDMEM7Ozs7O0lBRzFDLDhEQUNzQzs7Ozs7SUFHdEMsOENBQzJFOzs7OztJQUczRSwrQ0FDNEU7Ozs7O0lBRzVFLDhDQUMyRTs7SUFFM0Usa0RBQzhCOztJQUU5QiwwREFDMEM7O0lBRTFDLDJEQUEyRDs7SUFDM0QsMkRBQTRGOztJQUM1Rix1REFBNEI7O0lBQzVCLHlEQUE4Qjs7SUFDOUIsK0RBQW9DOztJQUNwQywwREFBaUU7O0lBQ2pFLDZEQUErQzs7Ozs7SUFFbkMsd0RBQXVDOzs7OztJQUN2Qyw2REFBa0Q7Ozs7O0lBQ2xELCtEQUFzRDs7Ozs7SUFDdEQsa0RBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LFxuICAgIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvblxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gICAgQWN0aXZpdGlDb250ZW50U2VydmljZSwgQXBwQ29uZmlnU2VydmljZSwgQXBwQ29uZmlnVmFsdWVzLFxuICAgIFN0YXJ0Rm9ybUNvbXBvbmVudCwgRm9ybVJlbmRlcmluZ1NlcnZpY2UsIEZvcm1WYWx1ZXNcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZVZhcmlhYmxlIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2Nlc3MtaW5zdGFuY2UtdmFyaWFibGUubW9kZWwnO1xuaW1wb3J0IHsgUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbiB9IGZyb20gJy4vLi4vbW9kZWxzL3Byb2Nlc3MtZGVmaW5pdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzSW5zdGFuY2UgfSBmcm9tICcuLy4uL21vZGVscy9wcm9jZXNzLWluc3RhbmNlLm1vZGVsJztcbmltcG9ydCB7IFByb2Nlc3NTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zZXJ2aWNlcy9wcm9jZXNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXR0YWNoRmlsZVdpZGdldENvbXBvbmVudCwgQXR0YWNoRm9sZGVyV2lkZ2V0Q29tcG9uZW50IH0gZnJvbSAnLi4vLi4vY29udGVudC13aWRnZXQnO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wsIFZhbGlkYXRvcnMsIEFic3RyYWN0Q29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1hdEF1dG9jb21wbGV0ZVRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXN0YXJ0LXByb2Nlc3MnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zdGFydC1wcm9jZXNzLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9zdGFydC1wcm9jZXNzLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBTdGFydFByb2Nlc3NJbnN0YW5jZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0IHtcblxuICAgIE1BWF9MRU5HVEg6IG51bWJlciA9IDI1NTtcblxuICAgIC8qKiAob3B0aW9uYWwpIExpbWl0IHRoZSBsaXN0IG9mIHByb2Nlc3NlcyB0aGF0IGNhbiBiZSBzdGFydGVkIHRvIHRob3NlXG4gICAgICogY29udGFpbmVkIGluIHRoZSBzcGVjaWZpZWQgYXBwLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgYXBwSWQ6IG51bWJlcjtcblxuICAgIC8qKiAob3B0aW9uYWwpIERlZmluaXRpb24gbmFtZSBvZiB0aGUgcHJvY2VzcyB0byBzdGFydC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NEZWZpbml0aW9uTmFtZTogc3RyaW5nO1xuXG4gICAgLyoqIFZhcmlhYmxlcyBpbiB0aGUgaW5wdXQgdG8gdGhlIHByb2Nlc3NcbiAgICAgKiBbUmVzdFZhcmlhYmxlXShodHRwczovL2dpdGh1Yi5jb20vQWxmcmVzY28vYWxmcmVzY28tanMtYXBpL3RyZWUvbWFzdGVyL3NyYy9hbGZyZXNjby1hY3Rpdml0aS1yZXN0LWFwaS9kb2NzL1Jlc3RWYXJpYWJsZS5tZCkuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICB2YXJpYWJsZXM6IFByb2Nlc3NJbnN0YW5jZVZhcmlhYmxlW107XG5cbiAgICAvKiogUGFyYW1ldGVyIHRvIHBhc3MgZm9ybSBmaWVsZCB2YWx1ZXMgaW4gdGhlIHN0YXJ0IGZvcm0gaWYgb25lIGlzIGFzc29jaWF0ZWQuICovXG4gICAgQElucHV0KClcbiAgICB2YWx1ZXM6IEZvcm1WYWx1ZXM7XG5cbiAgICAvKiogKG9wdGlvbmFsKSBOYW1lIHRvIGFzc2lnbiB0byB0aGUgY3VycmVudCBwcm9jZXNzLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbmFtZTogc3RyaW5nID0gJyc7XG5cbiAgICAvKiogSGlkZSBvciBzaG93IHRoZSBwcm9jZXNzIHNlbGVjdGlvbiBkcm9wZG93bi4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dTZWxlY3RQcm9jZXNzRHJvcGRvd246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIChvcHRpb25hbCkgUGFyYW1ldGVyIHRvIGVuYWJsZSBzZWxlY3Rpb24gb2YgcHJvY2VzcyB3aGVuIGZpbHRlcmluZy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NGaWx0ZXJTZWxlY3RvcjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBwcm9jZXNzIHN0YXJ0cy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBzdGFydDogRXZlbnRFbWl0dGVyPFByb2Nlc3NJbnN0YW5jZT4gPSBuZXcgRXZlbnRFbWl0dGVyPFByb2Nlc3NJbnN0YW5jZT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHByb2Nlc3MgaXMgY2FuY2VsZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgY2FuY2VsOiBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlPiA9IG5ldyBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3I6IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2U+ID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2U+KCk7XG5cbiAgICBAVmlld0NoaWxkKCdzdGFydEZvcm0nKVxuICAgIHN0YXJ0Rm9ybTogU3RhcnRGb3JtQ29tcG9uZW50O1xuXG4gICAgQFZpZXdDaGlsZChNYXRBdXRvY29tcGxldGVUcmlnZ2VyKVxuICAgIGlucHV0QXV0b2NvbXBsZXRlOiBNYXRBdXRvY29tcGxldGVUcmlnZ2VyO1xuXG4gICAgcHJvY2Vzc0RlZmluaXRpb25zOiBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uW10gPSBbXTtcbiAgICBzZWxlY3RlZFByb2Nlc3NEZWY6IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24gPSBuZXcgUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbigpO1xuICAgIGVycm9yTWVzc2FnZUlkOiBzdHJpbmcgPSAnJztcbiAgICBwcm9jZXNzTmFtZUlucHV0OiBGb3JtQ29udHJvbDtcbiAgICBwcm9jZXNzRGVmaW5pdGlvbklucHV0OiBGb3JtQ29udHJvbDtcbiAgICBmaWx0ZXJlZFByb2Nlc3NlczogT2JzZXJ2YWJsZTxQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uW10+O1xuICAgIG1heFByb2Nlc3NOYW1lTGVuZ3RoOiBudW1iZXIgPSB0aGlzLk1BWF9MRU5HVEg7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogUHJvY2Vzc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBmb3JtUmVuZGVyaW5nU2VydmljZTogRm9ybVJlbmRlcmluZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpdml0aUNvbnRlbnRTZXJ2aWNlOiBBY3Rpdml0aUNvbnRlbnRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwQ29uZmlnOiBBcHBDb25maWdTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZm9ybVJlbmRlcmluZ1NlcnZpY2Uuc2V0Q29tcG9uZW50VHlwZVJlc29sdmVyKCd1cGxvYWQnLCAoKSA9PiBBdHRhY2hGaWxlV2lkZ2V0Q29tcG9uZW50LCB0cnVlKTtcbiAgICAgICAgdGhpcy5mb3JtUmVuZGVyaW5nU2VydmljZS5zZXRDb21wb25lbnRUeXBlUmVzb2x2ZXIoJ3NlbGVjdC1mb2xkZXInLCAoKSA9PiBBdHRhY2hGb2xkZXJXaWRnZXRDb21wb25lbnQsIHRydWUpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NOYW1lSW5wdXQgPSBuZXcgRm9ybUNvbnRyb2wodGhpcy5uYW1lLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgVmFsaWRhdG9ycy5tYXhMZW5ndGgodGhpcy5tYXhQcm9jZXNzTmFtZUxlbmd0aCldKTtcbiAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbklucHV0ID0gbmV3IEZvcm1Db250cm9sKCk7XG5cbiAgICAgICAgdGhpcy5sb2FkU3RhcnRQcm9jZXNzKCk7XG5cbiAgICAgICAgdGhpcy5wcm9jZXNzTmFtZUlucHV0LnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUoKG5hbWUpID0+IHRoaXMubmFtZSA9IG5hbWUpO1xuICAgICAgICB0aGlzLmZpbHRlcmVkUHJvY2Vzc2VzID0gdGhpcy5wcm9jZXNzRGVmaW5pdGlvbklucHV0LnZhbHVlQ2hhbmdlc1xuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKCh2YWx1ZSkgPT4gdGhpcy5fZmlsdGVyKHZhbHVlKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlc1sndmFsdWVzJ10gJiYgY2hhbmdlc1sndmFsdWVzJ10uY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLm1vdmVOb2RlRnJvbUNTdG9QUygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoYW5nZXNbJ2FwcElkJ10gJiYgY2hhbmdlc1snYXBwSWQnXS5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuYXBwSWQgPSBjaGFuZ2VzWydhcHBJZCddLmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubG9hZFN0YXJ0UHJvY2VzcygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2ZpbHRlcih2YWx1ZTogc3RyaW5nKTogUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbltdIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlclZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGxldCBmaWx0ZXJlZFByb2Nlc3MgPSB0aGlzLnByb2Nlc3NEZWZpbml0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4gb3B0aW9uLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXJWYWx1ZSkpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9jZXNzRmlsdGVyU2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZiA9IHRoaXMuZ2V0U2VsZWN0ZWRQcm9jZXNzKGZpbHRlclZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZFByb2Nlc3M7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRTZWxlY3RlZFByb2Nlc3Moc2VsZWN0ZWRQcm9jZXNzKSB7XG4gICAgICAgIGxldCBwcm9jZXNzU2VsZWN0ZWQgPSB0aGlzLnByb2Nlc3NEZWZpbml0aW9ucy5maW5kKChwcm9jZXNzKSA9PiBwcm9jZXNzLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gc2VsZWN0ZWRQcm9jZXNzKTtcblxuICAgICAgICBpZiAoIXByb2Nlc3NTZWxlY3RlZCkge1xuICAgICAgICAgICAgcHJvY2Vzc1NlbGVjdGVkID0gbmV3IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcHJvY2Vzc1NlbGVjdGVkO1xuICAgIH1cblxuICAgIHB1YmxpYyBsb2FkU3RhcnRQcm9jZXNzKCkge1xuICAgICAgICB0aGlzLnJlc2V0U2VsZWN0ZWRQcm9jZXNzRGVmaW5pdGlvbigpO1xuICAgICAgICB0aGlzLnJlc2V0RXJyb3JNZXNzYWdlKCk7XG5cbiAgICAgICAgdGhpcy5hY3Rpdml0aVByb2Nlc3MuZ2V0UHJvY2Vzc0RlZmluaXRpb25zKHRoaXMuYXBwSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChwcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uczogUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbltdKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbnMgPSBwcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9ucztcblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1Byb2Nlc3NEZWZpbml0aW9uc0VtcHR5KCkpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9jZXNzRGVmaW5pdGlvbnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZiA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25zWzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRQcm9jZXNzID0gdGhpcy5wcm9jZXNzRGVmaW5pdGlvbnMuZmluZCgoY3VycmVudFByb2Nlc3NEZWZpbml0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRQcm9jZXNzRGVmaW5pdGlvbi5uYW1lID09PSB0aGlzLnByb2Nlc3NEZWZpbml0aW9uTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkUHJvY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmID0gc2VsZWN0ZWRQcm9jZXNzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbklucHV0LnNldFZhbHVlKHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmLm5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2VJZCA9ICdBREZfUFJPQ0VTU19MSVNULlNUQVJUX1BST0NFU1MuRVJST1IuTE9BRF9QUk9DRVNTX0RFRlMnO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaXNQcm9jZXNzRGVmaW5pdGlvbnNFbXB0eSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmxlbmd0aCA9PT0gMDtcbiAgICB9XG5cbiAgICBnZXRBbGZyZXNjb1JlcG9zaXRvcnlOYW1lKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBhbGZyZXNjb1JlcG9zaXRvcnlOYW1lID0gdGhpcy5hcHBDb25maWcuZ2V0PHN0cmluZz4oQXBwQ29uZmlnVmFsdWVzLkFMRlJFU0NPX1JFUE9TSVRPUllfTkFNRSk7XG4gICAgICAgIGlmICghYWxmcmVzY29SZXBvc2l0b3J5TmFtZSkge1xuICAgICAgICAgICAgYWxmcmVzY29SZXBvc2l0b3J5TmFtZSA9ICdhbGZyZXNjby0xJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWxmcmVzY29SZXBvc2l0b3J5TmFtZSArICdBbGZyZXNjbyc7XG4gICAgfVxuXG4gICAgbW92ZU5vZGVGcm9tQ1N0b1BTKCkge1xuICAgICAgICBsZXQgYWNjb3VudElkZW50aWZpZXIgPSB0aGlzLmdldEFsZnJlc2NvUmVwb3NpdG9yeU5hbWUoKTtcblxuICAgICAgICBmb3IgKGxldCBrZXkgaW4gdGhpcy52YWx1ZXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRWYWx1ZSA9IHRoaXMudmFsdWVzW2tleV07XG5cbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlLmlzRmlsZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2aXRpQ29udGVudFNlcnZpY2UuYXBwbHlBbGZyZXNjb05vZGUoY3VycmVudFZhbHVlLCBudWxsLCBhY2NvdW50SWRlbnRpZmllcikuc3Vic2NyaWJlKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVzW2tleV0gPSBbcmVzXTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXJ0UHJvY2VzcyhvdXRjb21lPzogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZiAmJiB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZi5pZCAmJiB0aGlzLm5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMucmVzZXRFcnJvck1lc3NhZ2UoKTtcbiAgICAgICAgICAgIGxldCBmb3JtVmFsdWVzID0gdGhpcy5zdGFydEZvcm0gPyB0aGlzLnN0YXJ0Rm9ybS5mb3JtLnZhbHVlcyA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLnN0YXJ0UHJvY2Vzcyh0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZi5pZCwgdGhpcy5uYW1lLCBvdXRjb21lLCBmb3JtVmFsdWVzLCB0aGlzLnZhcmlhYmxlcykuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQuZW1pdChyZXMpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZUlkID0gJ0FERl9QUk9DRVNTX0xJU1QuU1RBUlRfUFJPQ0VTUy5FUlJPUi5TVEFSVCc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNhbmNlbFN0YXJ0UHJvY2VzcygpIHtcbiAgICAgICAgdGhpcy5jYW5jZWwuZW1pdCgpO1xuICAgIH1cblxuICAgIGhhc1N0YXJ0Rm9ybSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmICYmIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmLmhhc1N0YXJ0Rm9ybTtcbiAgICB9XG5cbiAgICBpc1Byb2Nlc3NEZWZpbml0aW9uRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NEZWZpbml0aW9ucyA/ICh0aGlzLnByb2Nlc3NEZWZpbml0aW9ucy5sZW5ndGggPiAwIHx8IHRoaXMuZXJyb3JNZXNzYWdlSWQpIDogdGhpcy5lcnJvck1lc3NhZ2VJZDtcbiAgICB9XG5cbiAgICBpc1N0YXJ0Rm9ybU1pc3NpbmdPclZhbGlkKCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5zdGFydEZvcm0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0Rm9ybS5mb3JtICYmIHRoaXMuc3RhcnRGb3JtLmZvcm0uaXNWYWxpZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFsaWRhdGVGb3JtKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYgJiYgdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYuaWQgJiYgdGhpcy5wcm9jZXNzTmFtZUlucHV0LnZhbGlkICYmIHRoaXMuaXNTdGFydEZvcm1NaXNzaW5nT3JWYWxpZCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVzZXRTZWxlY3RlZFByb2Nlc3NEZWZpbml0aW9uKCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZiA9IG5ldyBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZXNldEVycm9yTWVzc2FnZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2VJZCA9ICcnO1xuICAgIH1cblxuICAgIGhhc0Vycm9yTWVzc2FnZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmxlbmd0aCA9PT0gMCAmJiAhdGhpcy5lcnJvck1lc3NhZ2VJZDtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25PdXRjb21lQ2xpY2sob3V0Y29tZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc3RhcnRQcm9jZXNzKG91dGNvbWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZXNldCgpIHtcbiAgICAgICAgdGhpcy5yZXNldFNlbGVjdGVkUHJvY2Vzc0RlZmluaXRpb24oKTtcbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG4gICAgICAgIGlmICh0aGlzLnN0YXJ0Rm9ybSkge1xuICAgICAgICAgICAgdGhpcy5zdGFydEZvcm0uZGF0YSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVzZXRFcnJvck1lc3NhZ2UoKTtcbiAgICB9XG5cbiAgICBoYXNQcm9jZXNzTmFtZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICBkaXNwbGF5Rm4ocHJvY2VzczogYW55KSB7XG4gICAgICAgIGlmIChwcm9jZXNzKSB7XG4gICAgICAgICAgICBsZXQgcHJvY2Vzc05hbWUgPSBwcm9jZXNzO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHByb2Nlc3NOYW1lID0gcHJvY2Vzcy5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NOYW1lO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGlzcGxheURyb3Bkb3duKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAoIXRoaXMuaW5wdXRBdXRvY29tcGxldGUucGFuZWxPcGVuKSB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uSW5wdXQuc2V0VmFsdWUoJycpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dEF1dG9jb21wbGV0ZS5vcGVuUGFuZWwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRBdXRvY29tcGxldGUuY2xvc2VQYW5lbCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IG5hbWVDb250cm9sbGVyKCk6IEFic3RyYWN0Q29udHJvbCB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NOYW1lSW5wdXQ7XG4gICAgfVxufVxuIl19