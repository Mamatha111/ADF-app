/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { LogService } from '@alfresco/adf-core';
import { PeopleProcessService } from '@alfresco/adf-core';
import { Component, Input, ViewChild } from '@angular/core';
import { Observable } from 'rxjs';
import { PeopleSearchComponent } from '../people-search/people-search.component';
import { share } from 'rxjs/operators';
var PeopleComponent = /** @class */ (function () {
    function PeopleComponent(logService, peopleProcessService) {
        var _this = this;
        this.logService = logService;
        this.peopleProcessService = peopleProcessService;
        /**
         * The array of User objects to display.
         */
        this.people = [];
        /**
         * The numeric ID of the task.
         */
        this.taskId = '';
        /**
         * Should the data be read-only?
         */
        this.readOnly = false;
        this.showAssignment = false;
        this.peopleSearch$ = new Observable(function (observer) { return _this.peopleSearchObserver = observer; })
            .pipe(share());
    }
    /**
     * @return {?}
     */
    PeopleComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.involveUserAndCloseSearch = /**
     * @return {?}
     */
    function () {
        if (this.peopleSearch) {
            this.peopleSearch.involveUserAndClose();
        }
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.involveUserWithoutCloseSearch = /**
     * @return {?}
     */
    function () {
        if (this.peopleSearch) {
            this.peopleSearch.involveUser();
        }
    };
    /**
     * @param {?} searchedWord
     * @return {?}
     */
    PeopleComponent.prototype.searchUser = /**
     * @param {?} searchedWord
     * @return {?}
     */
    function (searchedWord) {
        var _this = this;
        this.peopleProcessService.getWorkflowUsers(this.taskId, searchedWord)
            .subscribe(function (users) {
            _this.peopleSearchObserver.next(users);
        }, function (error) { return _this.logService.error(error); });
    };
    /**
     * @param {?} user
     * @return {?}
     */
    PeopleComponent.prototype.involveUser = /**
     * @param {?} user
     * @return {?}
     */
    function (user) {
        var _this = this;
        this.peopleProcessService.involveUserWithTask(this.taskId, user.id.toString())
            .subscribe(function () {
            _this.people = tslib_1.__spread(_this.people, [user]);
        }, function (error) { return _this.logService.error('Impossible to involve user with task'); });
    };
    /**
     * @param {?} user
     * @return {?}
     */
    PeopleComponent.prototype.removeInvolvedUser = /**
     * @param {?} user
     * @return {?}
     */
    function (user) {
        var _this = this;
        this.peopleProcessService.removeInvolvedUser(this.taskId, user.id.toString())
            .subscribe(function () {
            _this.people = _this.people.filter(function (involvedUser) {
                return involvedUser.id !== user.id;
            });
        }, function (error) { return _this.logService.error('Impossible to remove involved user from task'); });
    };
    /**
     * @param {?} firstName
     * @param {?} lastName
     * @param {?=} delimiter
     * @return {?}
     */
    PeopleComponent.prototype.getDisplayUser = /**
     * @param {?} firstName
     * @param {?} lastName
     * @param {?=} delimiter
     * @return {?}
     */
    function (firstName, lastName, delimiter) {
        if (delimiter === void 0) { delimiter = '-'; }
        firstName = (firstName !== null ? firstName : '');
        lastName = (lastName !== null ? lastName : '');
        return firstName + delimiter + lastName;
    };
    /**
     * @param {?} firstName
     * @param {?} lastName
     * @return {?}
     */
    PeopleComponent.prototype.getInitialUserName = /**
     * @param {?} firstName
     * @param {?} lastName
     * @return {?}
     */
    function (firstName, lastName) {
        firstName = (firstName !== null && firstName !== '' ? firstName[0] : '');
        lastName = (lastName !== null && lastName !== '' ? lastName[0] : '');
        return this.getDisplayUser(firstName, lastName, '');
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.onAddAssignment = /**
     * @return {?}
     */
    function () {
        this.showAssignment = true;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PeopleComponent.prototype.onClickAction = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.type === 'remove') {
            this.removeInvolvedUser(event.value);
        }
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.hasPeople = /**
     * @return {?}
     */
    function () {
        return this.people && this.people.length > 0;
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.isEditMode = /**
     * @return {?}
     */
    function () {
        return !this.readOnly;
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.onCloseSearch = /**
     * @return {?}
     */
    function () {
        this.showAssignment = false;
    };
    PeopleComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-people',
                    template: "<mat-card class=\"adf-assignment-top-container\">\n    <div mat-card-content class=\"adf-assignment-top-container-content\">\n        <div class=\"assignment-header\">\n                <div *ngIf=\"hasPeople()\" class=\"adf-assignment-count\" id=\"people-title\">\n                    {{ 'ADF_TASK_LIST.DETAILS.LABELS.PEOPLE' | translate }} {{ ' (' + people.length + ')' }}\n                </div>\n                <div *ngIf=\"!hasPeople()\" class=\"adf-assignment-count\" id=\"no-people-label\">\n                    {{ 'ADF_TASK_LIST.DETAILS.PEOPLE.NONE' | translate }}\n                </div>\n                <div *ngIf=\"isEditMode()\" class=\"adf-add-people\" (click)=\"onAddAssignment()\">\n                    <mat-icon class=\"adf-add-person-icon\">person_add</mat-icon>\n                </div>\n            </div>\n            <div class=\"adf-assignment-container\" *ngIf=\"showAssignment\">\n                <adf-people-search\n                    #peopleSearch\n                    (searchPeople)=\"searchUser($event)\"\n                    (success)=\"involveUser($event)\"\n                    (closeSearch)=\"onCloseSearch()\"\n                    [results]=\"peopleSearch$\">\n                    <ng-container adf-people-search-title>{{ 'ADF_TASK_LIST.DETAILS.LABELS.ADD_PEOPLE' | translate }}</ng-container>\n                    <ng-container adf-people-search-action-label>{{ 'ADF_TASK_LIST.PEOPLE.ADD_USER' | translate }}</ng-container>\n                </adf-people-search>\n            </div>\n            <div class=\"adf-assignment-list-container\" id=\"assignment-people-list\" *ngIf=\"hasPeople()\">\n                <adf-people-list\n                [users]=\"people\"\n                [actions]=\"isEditMode()\"\n                (clickAction)=\"onClickAction($event)\">\n                    <data-columns>\n                        <data-column key=\"firstName\">\n                            <ng-template let-entry=\"$implicit\">\n                                <div *ngIf=\"!entry.row.obj.pictureId\" class=\"adf-people-search-people-pic\">\n                                    {{getInitialUserName(entry.row.obj.firstName, entry.row.obj.lastName)}}</div>\n                                <div>\n                                    <img *ngIf=\"entry.row.obj.pictureId\" class=\"adf-people-img\"\n                                        [src]=\"peopleProcessService.getUserImage(entry.row.obj)\"/>\n                                </div>\n                            </ng-template>\n                        </data-column>\n                        <data-column key=\"email\" class=\"adf-full-width\">\n                            <ng-template let-entry=\"$implicit\">\n                                <div class=\"adf-people-full-name\">{{ getDisplayUser(entry.row.obj.firstName, entry.row.obj.lastName, ' ') }}</div>\n                                <div class=\"adf-people-email\">{{ entry.row.obj.email }}</div>\n                                <div class=\"adf-people-edit-label\">can edit</div>\n                            </ng-template>\n                        </data-column>\n                    </data-columns>\n                </adf-people-list>\n            </div>\n    </div>\n</mat-card>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    PeopleComponent.ctorParameters = function () { return [
        { type: LogService },
        { type: PeopleProcessService }
    ]; };
    PeopleComponent.propDecorators = {
        people: [{ type: Input }],
        taskId: [{ type: Input }],
        readOnly: [{ type: Input }],
        peopleSearch: [{ type: ViewChild, args: ['peopleSearch',] }]
    };
    return PeopleComponent;
}());
export { PeopleComponent };
if (false) {
    /**
     * The array of User objects to display.
     * @type {?}
     */
    PeopleComponent.prototype.people;
    /**
     * The numeric ID of the task.
     * @type {?}
     */
    PeopleComponent.prototype.taskId;
    /**
     * Should the data be read-only?
     * @type {?}
     */
    PeopleComponent.prototype.readOnly;
    /** @type {?} */
    PeopleComponent.prototype.peopleSearch;
    /** @type {?} */
    PeopleComponent.prototype.showAssignment;
    /**
     * @type {?}
     * @private
     */
    PeopleComponent.prototype.peopleSearchObserver;
    /** @type {?} */
    PeopleComponent.prototype.peopleSearch$;
    /**
     * @type {?}
     * @private
     */
    PeopleComponent.prototype.logService;
    /** @type {?} */
    PeopleComponent.prototype.peopleProcessService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVvcGxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInBlb3BsZS9jb21wb25lbnRzL3Blb3BsZS9wZW9wbGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFvQixNQUFNLG9CQUFvQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFELE9BQU8sRUFBaUIsU0FBUyxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLE1BQU0sQ0FBQztBQUU1QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNqRixPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFdkM7SUEyQkkseUJBQW9CLFVBQXNCLEVBQVMsb0JBQTBDO1FBQTdGLGlCQUtDO1FBTG1CLGVBQVUsR0FBVixVQUFVLENBQVk7UUFBUyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCOzs7O1FBbEI3RixXQUFNLEdBQXVCLEVBQUUsQ0FBQzs7OztRQUloQyxXQUFNLEdBQVcsRUFBRSxDQUFDOzs7O1FBSXBCLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFLMUIsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFNNUIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLFVBQVUsQ0FBcUIsVUFBQyxRQUFRLElBQUssT0FBQSxLQUFJLENBQUMsb0JBQW9CLEdBQUcsUUFBUSxFQUFwQyxDQUFvQyxDQUFDO2FBQ3RHLElBQUksQ0FDRCxLQUFLLEVBQUUsQ0FDVixDQUFDO0lBQ1YsQ0FBQzs7OztJQUVELGtDQUFROzs7SUFBUjtJQUNBLENBQUM7Ozs7SUFFRCx5Q0FBZTs7O0lB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RWxDLHFDQUE4Qjs7SUFBRSwrQ0FBaUQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBMb2dTZXJ2aWNlLCBVc2VyUHJvY2Vzc01vZGVsIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFBlb3BsZVByb2Nlc3NTZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBPYnNlcnZlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgVXNlckV2ZW50TW9kZWwgfSBmcm9tICcuLi8uLi8uLi90YXNrLWxpc3QvbW9kZWxzL3VzZXItZXZlbnQubW9kZWwnO1xuaW1wb3J0IHsgUGVvcGxlU2VhcmNoQ29tcG9uZW50IH0gZnJvbSAnLi4vcGVvcGxlLXNlYXJjaC9wZW9wbGUtc2VhcmNoLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBzaGFyZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtcGVvcGxlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcGVvcGxlLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9wZW9wbGUuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQZW9wbGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xuXG4gICAgLyoqIFRoZSBhcnJheSBvZiBVc2VyIG9iamVjdHMgdG8gZGlzcGxheS4gKi9cbiAgICBASW5wdXQoKVxuICAgIHBlb3BsZTogVXNlclByb2Nlc3NNb2RlbFtdID0gW107XG5cbiAgICAvKiogVGhlIG51bWVyaWMgSUQgb2YgdGhlIHRhc2suICovXG4gICAgQElucHV0KClcbiAgICB0YXNrSWQ6IHN0cmluZyA9ICcnO1xuXG4gICAgLyoqIFNob3VsZCB0aGUgZGF0YSBiZSByZWFkLW9ubHk/ICovXG4gICAgQElucHV0KClcbiAgICByZWFkT25seTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQFZpZXdDaGlsZCgncGVvcGxlU2VhcmNoJylcbiAgICBwZW9wbGVTZWFyY2g6IFBlb3BsZVNlYXJjaENvbXBvbmVudDtcblxuICAgIHNob3dBc3NpZ25tZW50OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIHBlb3BsZVNlYXJjaE9ic2VydmVyOiBPYnNlcnZlcjxVc2VyUHJvY2Vzc01vZGVsW10+O1xuICAgIHBlb3BsZVNlYXJjaCQ6IE9ic2VydmFibGU8VXNlclByb2Nlc3NNb2RlbFtdPjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSwgcHVibGljIHBlb3BsZVByb2Nlc3NTZXJ2aWNlOiBQZW9wbGVQcm9jZXNzU2VydmljZSkge1xuICAgICAgICB0aGlzLnBlb3BsZVNlYXJjaCQgPSBuZXcgT2JzZXJ2YWJsZTxVc2VyUHJvY2Vzc01vZGVsW10+KChvYnNlcnZlcikgPT4gdGhpcy5wZW9wbGVTZWFyY2hPYnNlcnZlciA9IG9ic2VydmVyKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgc2hhcmUoKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgfVxuXG4gICAgaW52b2x2ZVVzZXJBbmRDbG9zZVNlYXJjaCgpIHtcbiAgICAgICAgaWYgKHRoaXMucGVvcGxlU2VhcmNoKSB7XG4gICAgICAgICAgICB0aGlzLnBlb3BsZVNlYXJjaC5pbnZvbHZlVXNlckFuZENsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbnZvbHZlVXNlcldpdGhvdXRDbG9zZVNlYXJjaCgpIHtcbiAgICAgICAgaWYgKHRoaXMucGVvcGxlU2VhcmNoKSB7XG4gICAgICAgICAgICB0aGlzLnBlb3BsZVNlYXJjaC5pbnZvbHZlVXNlcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VhcmNoVXNlcihzZWFyY2hlZFdvcmQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnBlb3BsZVByb2Nlc3NTZXJ2aWNlLmdldFdvcmtmbG93VXNlcnModGhpcy50YXNrSWQsIHNlYXJjaGVkV29yZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHVzZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wZW9wbGVTZWFyY2hPYnNlcnZlci5uZXh0KHVzZXJzKTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycm9yKSk7XG4gICAgfVxuXG4gICAgaW52b2x2ZVVzZXIodXNlcjogVXNlclByb2Nlc3NNb2RlbCkge1xuICAgICAgICB0aGlzLnBlb3BsZVByb2Nlc3NTZXJ2aWNlLmludm9sdmVVc2VyV2l0aFRhc2sodGhpcy50YXNrSWQsIHVzZXIuaWQudG9TdHJpbmcoKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGVvcGxlID0gWy4uLnRoaXMucGVvcGxlLCB1c2VyXTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdJbXBvc3NpYmxlIHRvIGludm9sdmUgdXNlciB3aXRoIHRhc2snKSk7XG4gICAgfVxuXG4gICAgcmVtb3ZlSW52b2x2ZWRVc2VyKHVzZXI6IFVzZXJQcm9jZXNzTW9kZWwpIHtcbiAgICAgICAgdGhpcy5wZW9wbGVQcm9jZXNzU2VydmljZS5yZW1vdmVJbnZvbHZlZFVzZXIodGhpcy50YXNrSWQsIHVzZXIuaWQudG9TdHJpbmcoKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGVvcGxlID0gdGhpcy5wZW9wbGUuZmlsdGVyKChpbnZvbHZlZFVzZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludm9sdmVkVXNlci5pZCAhPT0gdXNlci5pZDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdJbXBvc3NpYmxlIHRvIHJlbW92ZSBpbnZvbHZlZCB1c2VyIGZyb20gdGFzaycpKTtcbiAgICB9XG5cbiAgICBnZXREaXNwbGF5VXNlcihmaXJzdE5hbWU6IHN0cmluZywgbGFzdE5hbWU6IHN0cmluZywgZGVsaW1pdGVyOiBzdHJpbmcgPSAnLScpOiBzdHJpbmcge1xuICAgICAgICBmaXJzdE5hbWUgPSAoZmlyc3ROYW1lICE9PSBudWxsID8gZmlyc3ROYW1lIDogJycpO1xuICAgICAgICBsYXN0TmFtZSA9IChsYXN0TmFtZSAhPT0gbnVsbCA/IGxhc3ROYW1lIDogJycpO1xuICAgICAgICByZXR1cm4gZmlyc3ROYW1lICsgZGVsaW1pdGVyICsgbGFzdE5hbWU7XG4gICAgfVxuXG4gICAgZ2V0SW5pdGlhbFVzZXJOYW1lKGZpcnN0TmFtZTogc3RyaW5nLCBsYXN0TmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGZpcnN0TmFtZSA9IChmaXJzdE5hbWUgIT09IG51bGwgJiYgZmlyc3ROYW1lICE9PSAnJyA/IGZpcnN0TmFtZVswXSA6ICcnKTtcbiAgICAgICAgbGFzdE5hbWUgPSAobGFzdE5hbWUgIT09IG51bGwgJiYgbGFzdE5hbWUgIT09ICcnID8gbGFzdE5hbWVbMF0gOiAnJyk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldERpc3BsYXlVc2VyKGZpcnN0TmFtZSwgbGFzdE5hbWUsICcnKTtcbiAgICB9XG5cbiAgICBvbkFkZEFzc2lnbm1lbnQoKSB7XG4gICAgICAgIHRoaXMuc2hvd0Fzc2lnbm1lbnQgPSB0cnVlO1xuICAgIH1cblxuICAgIG9uQ2xpY2tBY3Rpb24oZXZlbnQ6IFVzZXJFdmVudE1vZGVsKSB7XG4gICAgICAgIGlmIChldmVudC50eXBlID09PSAncmVtb3ZlJykge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVJbnZvbHZlZFVzZXIoZXZlbnQudmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFzUGVvcGxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wZW9wbGUgJiYgdGhpcy5wZW9wbGUubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBpc0VkaXRNb2RlKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMucmVhZE9ubHk7XG4gICAgfVxuXG4gICAgb25DbG9zZVNlYXJjaCgpIHtcbiAgICAgICAgdGhpcy5zaG93QXNzaWdubWVudCA9IGZhbHNlO1xuICAgIH1cbn1cbiJdfQ==