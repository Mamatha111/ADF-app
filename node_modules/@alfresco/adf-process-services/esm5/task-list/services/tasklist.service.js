/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { AlfrescoApiService, LogService } from '@alfresco/adf-core';
import { Injectable } from '@angular/core';
import { from, forkJoin, throwError, of } from 'rxjs';
import { map, catchError, switchMap, flatMap, filter } from 'rxjs/operators';
import { TaskQueryRequestRepresentationModel } from '../models/filter.model';
import { Form } from '../models/form.model';
import { TaskDetailsModel } from '../models/task-details.model';
import { TaskListModel } from '../models/task-list.model';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
var TaskListService = /** @class */ (function () {
    function TaskListService(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
    }
    /**
     * Gets all the filters in the list that belong to a task.
     * @param taskId ID of the target task
     * @param filterList List of filters to search through
     * @returns Filters belonging to the task
     */
    /**
     * Gets all the filters in the list that belong to a task.
     * @param {?} taskId ID of the target task
     * @param {?} filterList List of filters to search through
     * @return {?} Filters belonging to the task
     */
    TaskListService.prototype.getFilterForTaskById = /**
     * Gets all the filters in the list that belong to a task.
     * @param {?} taskId ID of the target task
     * @param {?} filterList List of filters to search through
     * @return {?} Filters belonging to the task
     */
    function (taskId, filterList) {
        var _this = this;
        return from(filterList)
            .pipe(flatMap(function (data) { return _this.isTaskRelatedToFilter(taskId, data); }), filter(function (data) { return data != null; }));
    };
    /**
     * Gets the search query for a task based on the supplied filter.
     * @param filter The filter to use
     * @returns The search query
     */
    /**
     * Gets the search query for a task based on the supplied filter.
     * @private
     * @param {?} filterModel
     * @return {?} The search query
     */
    TaskListService.prototype.generateTaskRequestNodeFromFilter = /**
     * Gets the search query for a task based on the supplied filter.
     * @private
     * @param {?} filterModel
     * @return {?} The search query
     */
    function (filterModel) {
        /** @type {?} */
        var requestNode = {
            appDefinitionId: filterModel.appId,
            assignment: filterModel.filter.assignment,
            state: filterModel.filter.state,
            sort: filterModel.filter.sort
        };
        return new TaskQueryRequestRepresentationModel(requestNode);
    };
    /**
     * Checks if a taskId is filtered with the given filter.
     * @param taskId ID of the target task
     * @param filterModel The filter you want to check
     * @returns The filter if it is related or null otherwise
     */
    /**
     * Checks if a taskId is filtered with the given filter.
     * @param {?} taskId ID of the target task
     * @param {?} filterModel The filter you want to check
     * @return {?} The filter if it is related or null otherwise
     */
    TaskListService.prototype.isTaskRelatedToFilter = /**
     * Checks if a taskId is filtered with the given filter.
     * @param {?} taskId ID of the target task
     * @param {?} filterModel The filter you want to check
     * @return {?} The filter if it is related or null otherwise
     */
    function (taskId, filterModel) {
        var _this = this;
        /** @type {?} */
        var requestNodeForFilter = this.generateTaskRequestNodeFromFilter(filterModel);
        return from(this.callApiTasksFiltered(requestNodeForFilter))
            .pipe(map(function (res) {
            return res.data.find(function (element) { return element.id === taskId; }) ? filterModel : null;
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Gets all the tasks matching the supplied query.
     * @param requestNode Query to search for tasks
     * @returns List of tasks
     */
    /**
     * Gets all the tasks matching the supplied query.
     * @param {?} requestNode Query to search for tasks
     * @return {?} List of tasks
     */
    TaskListService.prototype.getTasks = /**
     * Gets all the tasks matching the supplied query.
     * @param {?} requestNode Query to search for tasks
     * @return {?} List of tasks
     */
    function (requestNode) {
        var _this = this;
        return from(this.callApiTasksFiltered(requestNode))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Gets tasks matching a query and state value.
     * @param requestNode Query to search for tasks
     * @param state Task state. Can be "open" or "completed".
     * @returns List of tasks
     */
    /**
     * Gets tasks matching a query and state value.
     * @param {?} requestNode Query to search for tasks
     * @param {?=} state Task state. Can be "open" or "completed".
     * @return {?} List of tasks
     */
    TaskListService.prototype.findTasksByState = /**
     * Gets tasks matching a query and state value.
     * @param {?} requestNode Query to search for tasks
     * @param {?=} state Task state. Can be "open" or "completed".
     * @return {?} List of tasks
     */
    function (requestNode, state) {
        if (state) {
            requestNode.state = state;
        }
        return this.getTasks(requestNode)
            .pipe(catchError(function () { return of(new TaskListModel()); }));
    };
    /**
     * Gets all tasks matching a query and state value.
     * @param requestNode Query to search for tasks.
     * @param state Task state. Can be "open" or "completed".
     * @returns List of tasks
     */
    /**
     * Gets all tasks matching a query and state value.
     * @param {?} requestNode Query to search for tasks.
     * @param {?=} state Task state. Can be "open" or "completed".
     * @return {?} List of tasks
     */
    TaskListService.prototype.findAllTaskByState = /**
     * Gets all tasks matching a query and state value.
     * @param {?} requestNode Query to search for tasks.
     * @param {?=} state Task state. Can be "open" or "completed".
     * @return {?} List of tasks
     */
    function (requestNode, state) {
        var _this = this;
        if (state) {
            requestNode.state = state;
        }
        return this.getTotalTasks(requestNode)
            .pipe(switchMap(function (res) {
            requestNode.size = res.total;
            return _this.getTasks(requestNode);
        }));
    };
    /**
     * Gets all tasks matching the supplied query but ignoring the task state.
     * @param requestNode Query to search for tasks
     * @returns List of tasks
     */
    /**
     * Gets all tasks matching the supplied query but ignoring the task state.
     * @param {?} requestNode Query to search for tasks
     * @return {?} List of tasks
     */
    TaskListService.prototype.findAllTasksWithoutState = /**
     * Gets all tasks matching the supplied query but ignoring the task state.
     * @param {?} requestNode Query to search for tasks
     * @return {?} List of tasks
     */
    function (requestNode) {
        return forkJoin(this.findTasksByState(requestNode, 'open'), this.findAllTaskByState(requestNode, 'completed'), function (activeTasks, completedTasks) {
            /** @type {?} */
            var tasks = Object.assign({}, activeTasks);
            tasks.total += completedTasks.total;
            tasks.data = tasks.data.concat(completedTasks.data);
            return tasks;
        });
    };
    /**
     * Gets details for a task.
     * @param taskId ID of the target task.
     * @returns Task details
     */
    /**
     * Gets details for a task.
     * @param {?} taskId ID of the target task.
     * @return {?} Task details
     */
    TaskListService.prototype.getTaskDetails = /**
     * Gets details for a task.
     * @param {?} taskId ID of the target task.
     * @return {?} Task details
     */
    function (taskId) {
        var _this = this;
        return from(this.callApiTaskDetails(taskId))
            .pipe(map(function (details) {
            return new TaskDetailsModel(details);
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Gets the checklist for a task.
     * @param id ID of the target task
     * @returns Array of checklist task details
     */
    /**
     * Gets the checklist for a task.
     * @param {?} id ID of the target task
     * @return {?} Array of checklist task details
     */
    TaskListService.prototype.getTaskChecklist = /**
     * Gets the checklist for a task.
     * @param {?} id ID of the target task
     * @return {?} Array of checklist task details
     */
    function (id) {
        var _this = this;
        return from(this.callApiTaskChecklist(id))
            .pipe(map(function (response) {
            /** @type {?} */
            var checklists = [];
            response.data.forEach(function (checklist) {
                checklists.push(new TaskDetailsModel(checklist));
            });
            return checklists;
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Gets all available reusable forms.
     * @returns Array of form details
     */
    /**
     * Gets all available reusable forms.
     * @return {?} Array of form details
     */
    TaskListService.prototype.getFormList = /**
     * Gets all available reusable forms.
     * @return {?} Array of form details
     */
    function () {
        var _this = this;
        /** @type {?} */
        var opts = {
            'filter': 'myReusableForms',
            // String | filter
            'sort': 'modifiedDesc',
            // String | sort
            'modelType': 2 // Integer | modelType
        };
        return from(this.apiService.getInstance().activiti.modelsApi.getModels(opts))
            .pipe(map(function (response) {
            /** @type {?} */
            var forms = [];
            response.data.forEach(function (form) {
                forms.push(new Form(form.id, form.name));
            });
            return forms;
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Attaches a form to a task.
     * @param taskId ID of the target task
     * @param formId ID of the form to add
     * @returns Null response notifying when the operation is complete
     */
    /**
     * Attaches a form to a task.
     * @param {?} taskId ID of the target task
     * @param {?} formId ID of the form to add
     * @return {?} Null response notifying when the operation is complete
     */
    TaskListService.prototype.attachFormToATask = /**
     * Attaches a form to a task.
     * @param {?} taskId ID of the target task
     * @param {?} formId ID of the form to add
     * @return {?} Null response notifying when the operation is complete
     */
    function (taskId, formId) {
        var _this = this;
        return from(this.apiService.taskApi.attachForm(taskId, { 'formId': formId }))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Adds a subtask (ie, a checklist task) to a parent task.
     * @param task The task to add
     * @returns The subtask that was added
     */
    /**
     * Adds a subtask (ie, a checklist task) to a parent task.
     * @param {?} task The task to add
     * @return {?} The subtask that was added
     */
    TaskListService.prototype.addTask = /**
     * Adds a subtask (ie, a checklist task) to a parent task.
     * @param {?} task The task to add
     * @return {?} The subtask that was added
     */
    function (task) {
        var _this = this;
        return from(this.callApiAddTask(task))
            .pipe(map(function (response) {
            return new TaskDetailsModel(response);
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Deletes a subtask (ie, a checklist task) from a parent task.
     * @param taskId The task to delete
     * @returns Null response notifying when the operation is complete
     */
    /**
     * Deletes a subtask (ie, a checklist task) from a parent task.
     * @param {?} taskId The task to delete
     * @return {?} Null response notifying when the operation is complete
     */
    TaskListService.prototype.deleteTask = /**
     * Deletes a subtask (ie, a checklist task) from a parent task.
     * @param {?} taskId The task to delete
     * @return {?} Null response notifying when the operation is complete
     */
    function (taskId) {
        var _this = this;
        return from(this.callApiDeleteTask(taskId))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Deletes a form from a task.
     * @param taskId Task id related to form
     * @returns Null response notifying when the operation is complete
     */
    /**
     * Deletes a form from a task.
     * @param {?} taskId Task id related to form
     * @return {?} Null response notifying when the operation is complete
     */
    TaskListService.prototype.deleteForm = /**
     * Deletes a form from a task.
     * @param {?} taskId Task id related to form
     * @return {?} Null response notifying when the operation is complete
     */
    function (taskId) {
        var _this = this;
        return from(this.callApiDeleteForm(taskId))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Gives completed status to a task.
     * @param taskId ID of the target task
     * @returns Null response notifying when the operation is complete
     */
    /**
     * Gives completed status to a task.
     * @param {?} taskId ID of the target task
     * @return {?} Null response notifying when the operation is complete
     */
    TaskListService.prototype.completeTask = /**
     * Gives completed status to a task.
     * @param {?} taskId ID of the target task
     * @return {?} Null response notifying when the operation is complete
     */
    function (taskId) {
        var _this = this;
        return from(this.apiService.taskApi.completeTask(taskId))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Gets the total number of the tasks found by a query.
     * @param requestNode Query to search for tasks
     * @returns Number of tasks
     */
    /**
     * Gets the total number of the tasks found by a query.
     * @param {?} requestNode Query to search for tasks
     * @return {?} Number of tasks
     */
    TaskListService.prototype.getTotalTasks = /**
     * Gets the total number of the tasks found by a query.
     * @param {?} requestNode Query to search for tasks
     * @return {?} Number of tasks
     */
    function (requestNode) {
        var _this = this;
        requestNode.size = 0;
        return from(this.callApiTasksFiltered(requestNode))
            .pipe(map(function (res) {
            return res;
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Creates a new standalone task.
     * @param task Details of the new task
     * @returns Details of the newly created task
     */
    /**
     * Creates a new standalone task.
     * @param {?} task Details of the new task
     * @return {?} Details of the newly created task
     */
    TaskListService.prototype.createNewTask = /**
     * Creates a new standalone task.
     * @param {?} task Details of the new task
     * @return {?} Details of the newly created task
     */
    function (task) {
        var _this = this;
        return from(this.callApiCreateTask(task))
            .pipe(map(function (response) {
            return new TaskDetailsModel(response);
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Assigns a task to a user or group.
     * @param taskId The task to assign
     * @param requestNode User or group to assign the task to
     * @returns Details of the assigned task
     */
    /**
     * Assigns a task to a user or group.
     * @param {?} taskId The task to assign
     * @param {?} requestNode User or group to assign the task to
     * @return {?} Details of the assigned task
     */
    TaskListService.prototype.assignTask = /**
     * Assigns a task to a user or group.
     * @param {?} taskId The task to assign
     * @param {?} requestNode User or group to assign the task to
     * @return {?} Details of the assigned task
     */
    function (taskId, requestNode) {
        var _this = this;
        /** @type {?} */
        var assignee = { assignee: requestNode.id };
        return from(this.callApiAssignTask(taskId, assignee))
            .pipe(map(function (response) {
            return new TaskDetailsModel(response);
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Assigns a task to a user.
     * @param taskId ID of the task to assign
     * @param userId ID of the user to assign the task to
     * @returns Details of the assigned task
     */
    /**
     * Assigns a task to a user.
     * @param {?} taskId ID of the task to assign
     * @param {?} userId ID of the user to assign the task to
     * @return {?} Details of the assigned task
     */
    TaskListService.prototype.assignTaskByUserId = /**
     * Assigns a task to a user.
     * @param {?} taskId ID of the task to assign
     * @param {?} userId ID of the user to assign the task to
     * @return {?} Details of the assigned task
     */
    function (taskId, userId) {
        var _this = this;
        /** @type {?} */
        var assignee = (/** @type {?} */ ({ assignee: userId }));
        return from(this.callApiAssignTask(taskId, assignee))
            .pipe(map(function (response) {
            return new TaskDetailsModel(response);
        }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Claims a task for the current user.
     * @param taskId ID of the task to claim
     * @returns Details of the claimed task
     */
    /**
     * Claims a task for the current user.
     * @param {?} taskId ID of the task to claim
     * @return {?} Details of the claimed task
     */
    TaskListService.prototype.claimTask = /**
     * Claims a task for the current user.
     * @param {?} taskId ID of the task to claim
     * @return {?} Details of the claimed task
     */
    function (taskId) {
        var _this = this;
        return from(this.apiService.taskApi.claimTask(taskId))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Un-claims a task for the current user.
     * @param taskId ID of the task to unclaim
     * @returns Null response notifying when the operation is complete
     */
    /**
     * Un-claims a task for the current user.
     * @param {?} taskId ID of the task to unclaim
     * @return {?} Null response notifying when the operation is complete
     */
    TaskListService.prototype.unclaimTask = /**
     * Un-claims a task for the current user.
     * @param {?} taskId ID of the task to unclaim
     * @return {?} Null response notifying when the operation is complete
     */
    function (taskId) {
        var _this = this;
        return from(this.apiService.taskApi.unclaimTask(taskId))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Updates the details (name, description, due date) for a task.
     * @param taskId ID of the task to update
     * @param updated Data to update the task (as a `TaskUpdateRepresentation` instance).
     * @returns Updated task details
     */
    /**
     * Updates the details (name, description, due date) for a task.
     * @param {?} taskId ID of the task to update
     * @param {?} updated Data to update the task (as a `TaskUpdateRepresentation` instance).
     * @return {?} Updated task details
     */
    TaskListService.prototype.updateTask = /**
     * Updates the details (name, description, due date) for a task.
     * @param {?} taskId ID of the task to update
     * @param {?} updated Data to update the task (as a `TaskUpdateRepresentation` instance).
     * @return {?} Updated task details
     */
    function (taskId, updated) {
        var _this = this;
        return from(this.apiService.taskApi.updateTask(taskId, updated))
            .pipe(map(function (result) { return (/** @type {?} */ (result)); }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Fetches the Task Audit information in PDF format.
     * @param taskId ID of the target task
     * @returns Binary PDF data
     */
    /**
     * Fetches the Task Audit information in PDF format.
     * @param {?} taskId ID of the target task
     * @return {?} Binary PDF data
     */
    TaskListService.prototype.fetchTaskAuditPdfById = /**
     * Fetches the Task Audit information in PDF format.
     * @param {?} taskId ID of the target task
     * @return {?} Binary PDF data
     */
    function (taskId) {
        var _this = this;
        return from(this.apiService.taskApi.getTaskAuditPdf(taskId))
            .pipe(map(function (data) { return (/** @type {?} */ (data)); }), catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * Fetch the Task Audit information in JSON format
     * @param taskId ID of the target task
     * @returns JSON data
     */
    /**
     * Fetch the Task Audit information in JSON format
     * @param {?} taskId ID of the target task
     * @return {?} JSON data
     */
    TaskListService.prototype.fetchTaskAuditJsonById = /**
     * Fetch the Task Audit information in JSON format
     * @param {?} taskId ID of the target task
     * @return {?} JSON data
     */
    function (taskId) {
        var _this = this;
        return from(this.apiService.taskApi.getTaskAuditJson(taskId))
            .pipe(catchError(function (err) { return _this.handleError(err); }));
    };
    /**
     * @private
     * @param {?} requestNode
     * @return {?}
     */
    TaskListService.prototype.callApiTasksFiltered = /**
     * @private
     * @param {?} requestNode
     * @return {?}
     */
    function (requestNode) {
        return this.apiService.taskApi.listTasks(requestNode);
    };
    /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    TaskListService.prototype.callApiTaskDetails = /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    function (taskId) {
        return this.apiService.taskApi.getTask(taskId);
    };
    /**
     * @private
     * @param {?} task
     * @return {?}
     */
    TaskListService.prototype.callApiAddTask = /**
     * @private
     * @param {?} task
     * @return {?}
     */
    function (task) {
        return this.apiService.taskApi.addSubtask(task.parentTaskId, task);
    };
    /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    TaskListService.prototype.callApiDeleteTask = /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    function (taskId) {
        return this.apiService.taskApi.deleteTask(taskId);
    };
    /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    TaskListService.prototype.callApiDeleteForm = /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    function (taskId) {
        return this.apiService.taskApi.removeForm(taskId);
    };
    /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    TaskListService.prototype.callApiTaskChecklist = /**
     * @private
     * @param {?} taskId
     * @return {?}
     */
    function (taskId) {
        return this.apiService.taskApi.getChecklist(taskId);
    };
    /**
     * @private
     * @param {?} task
     * @return {?}
     */
    TaskListService.prototype.callApiCreateTask = /**
     * @private
     * @param {?} task
     * @return {?}
     */
    function (task) {
        return this.apiService.taskApi.createNewTask(task);
    };
    /**
     * @private
     * @param {?} taskId
     * @param {?} requestNode
     * @return {?}
     */
    TaskListService.prototype.callApiAssignTask = /**
     * @private
     * @param {?} taskId
     * @param {?} requestNode
     * @return {?}
     */
    function (taskId, requestNode) {
        return this.apiService.taskApi.assignTask(taskId, requestNode);
    };
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    TaskListService.prototype.handleError = /**
     * @private
     * @param {?} error
     * @return {?}
     */
    function (error) {
        this.logService.error(error);
        return throwError(error || 'Server error');
    };
    TaskListService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    TaskListService.ctorParameters = function () { return [
        { type: AlfrescoApiService },
        { type: LogService }
    ]; };
    /** @nocollapse */ TaskListService.ngInjectableDef = i0.defineInjectable({ factory: function TaskListService_Factory() { return new TaskListService(i0.inject(i1.AlfrescoApiService), i0.inject(i1.LogService)); }, token: TaskListService, providedIn: "root" });
    return TaskListService;
}());
export { TaskListService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TaskListService.prototype.apiService;
    /**
     * @type {?}
     * @private
     */
    TaskListService.prototype.logService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFza2xpc3Quc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInRhc2stbGlzdC9zZXJ2aWNlcy90YXNrbGlzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxJQUFJLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDbEUsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3RSxPQUFPLEVBQTZCLG1DQUFtQyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDeEcsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQzs7O0FBTTFEO0lBS0kseUJBQW9CLFVBQThCLEVBQzlCLFVBQXNCO1FBRHRCLGVBQVUsR0FBVixVQUFVLENBQW9CO1FBQzlCLGVBQVUsR0FBVixVQUFVLENBQVk7SUFDMUMsQ0FBQztJQUVEOzs7OztPQUtHOzs7Ozs7O0lBQ0gsOENBQW9COzs7Ozs7SUFBcEIsVUFBcUIsTUFBYyxFQUFFLFVBQXVDO1FBQTVFLGlCQU1DO1FBTEcsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO2FBQ2xCLElBQUksQ0FDRCxPQUFPLENBQUMsVUFBQyxJQUErQixJQUFLLE9BQUEsS0FBSSxDQUFDLHFCQUFxQixDQUFDLE1BQU0s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Y28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlLCBMb2dTZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb20sIGZvcmtKb2luLCB0aHJvd0Vycm9yLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBjYXRjaEVycm9yLCBzd2l0Y2hNYXAsIGZsYXRNYXAsIGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWwsIFRhc2tRdWVyeVJlcXVlc3RSZXByZXNlbnRhdGlvbk1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2ZpbHRlci5tb2RlbCc7XG5pbXBvcnQgeyBGb3JtIH0gZnJvbSAnLi4vbW9kZWxzL2Zvcm0ubW9kZWwnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNNb2RlbCB9IGZyb20gJy4uL21vZGVscy90YXNrLWRldGFpbHMubW9kZWwnO1xuaW1wb3J0IHsgVGFza0xpc3RNb2RlbCB9IGZyb20gJy4uL21vZGVscy90YXNrLWxpc3QubW9kZWwnO1xuaW1wb3J0IHtcbiAgICBUYXNrUXVlcnlSZXByZXNlbnRhdGlvbixcbiAgICBBc3NpZ25lZUlkZW50aWZpZXJSZXByZXNlbnRhdGlvblxufSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBUYXNrTGlzdFNlcnZpY2Uge1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGlTZXJ2aWNlOiBBbGZyZXNjb0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbGwgdGhlIGZpbHRlcnMgaW4gdGhlIGxpc3QgdGhhdCBiZWxvbmcgdG8gYSB0YXNrLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhcmdldCB0YXNrXG4gICAgICogQHBhcmFtIGZpbHRlckxpc3QgTGlzdCBvZiBmaWx0ZXJzIHRvIHNlYXJjaCB0aHJvdWdoXG4gICAgICogQHJldHVybnMgRmlsdGVycyBiZWxvbmdpbmcgdG8gdGhlIHRhc2tcbiAgICAgKi9cbiAgICBnZXRGaWx0ZXJGb3JUYXNrQnlJZCh0YXNrSWQ6IHN0cmluZywgZmlsdGVyTGlzdDogRmlsdGVyUmVwcmVzZW50YXRpb25Nb2RlbFtdKTogT2JzZXJ2YWJsZTxGaWx0ZXJSZXByZXNlbnRhdGlvbk1vZGVsPiB7XG4gICAgICAgIHJldHVybiBmcm9tKGZpbHRlckxpc3QpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBmbGF0TWFwKChkYXRhOiBGaWx0ZXJSZXByZXNlbnRhdGlvbk1vZGVsKSA9PiB0aGlzLmlzVGFza1JlbGF0ZWRUb0ZpbHRlcih0YXNrSWQsIGRhdGEpKSxcbiAgICAgICAgICAgICAgICBmaWx0ZXIoKGRhdGE6IEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWwpID0+IGRhdGEgIT0gbnVsbClcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgc2VhcmNoIHF1ZXJ5IGZvciBhIHRhc2sgYmFzZWQgb24gdGhlIHN1cHBsaWVkIGZpbHRlci5cbiAgICAgKiBAcGFyYW0gZmlsdGVyIFRoZSBmaWx0ZXIgdG8gdXNlXG4gICAgICogQHJldHVybnMgVGhlIHNlYXJjaCBxdWVyeVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2VuZXJhdGVUYXNrUmVxdWVzdE5vZGVGcm9tRmlsdGVyKGZpbHRlck1vZGVsOiBGaWx0ZXJSZXByZXNlbnRhdGlvbk1vZGVsKTogVGFza1F1ZXJ5UmVxdWVzdFJlcHJlc2VudGF0aW9uTW9kZWwge1xuICAgICAgICBsZXQgcmVxdWVzdE5vZGUgPSB7XG4gICAgICAgICAgICBhcHBEZWZpbml0aW9uSWQ6IGZpbHRlck1vZGVsLmFwcElkLFxuICAgICAgICAgICAgYXNzaWdubWVudDogZmlsdGVyTW9kZWwuZmlsdGVyLmFzc2lnbm1lbnQsXG4gICAgICAgICAgICBzdGF0ZTogZmlsdGVyTW9kZWwuZmlsdGVyLnN0YXRlLFxuICAgICAgICAgICAgc29ydDogZmlsdGVyTW9kZWwuZmlsdGVyLnNvcnRcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG5ldyBUYXNrUXVlcnlSZXF1ZXN0UmVwcmVzZW50YXRpb25Nb2RlbChyZXF1ZXN0Tm9kZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGEgdGFza0lkIGlzIGZpbHRlcmVkIHdpdGggdGhlIGdpdmVuIGZpbHRlci5cbiAgICAgKiBAcGFyYW0gdGFza0lkIElEIG9mIHRoZSB0YXJnZXQgdGFza1xuICAgICAqIEBwYXJhbSBmaWx0ZXJNb2RlbCBUaGUgZmlsdGVyIHlvdSB3YW50IHRvIGNoZWNrXG4gICAgICogQHJldHVybnMgVGhlIGZpbHRlciBpZiBpdCBpcyByZWxhdGVkIG9yIG51bGwgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgaXNUYXNrUmVsYXRlZFRvRmlsdGVyKHRhc2tJZDogc3RyaW5nLCBmaWx0ZXJNb2RlbDogRmlsdGVyUmVwcmVzZW50YXRpb25Nb2RlbCk6IE9ic2VydmFibGU8RmlsdGVyUmVwcmVzZW50YXRpb25Nb2RlbD4ge1xuICAgICAgICBsZXQgcmVxdWVzdE5vZGVGb3JGaWx0ZXIgPSB0aGlzLmdlbmVyYXRlVGFza1JlcXVlc3ROb2RlRnJvbUZpbHRlcihmaWx0ZXJNb2RlbCk7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuY2FsbEFwaVRhc2tzRmlsdGVyZWQocmVxdWVzdE5vZGVGb3JGaWx0ZXIpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmRhdGEuZmluZCgoZWxlbWVudCkgPT4gZWxlbWVudC5pZCA9PT0gdGFza0lkKSA/IGZpbHRlck1vZGVsIDogbnVsbDtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbGwgdGhlIHRhc2tzIG1hdGNoaW5nIHRoZSBzdXBwbGllZCBxdWVyeS5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdE5vZGUgUXVlcnkgdG8gc2VhcmNoIGZvciB0YXNrc1xuICAgICAqIEByZXR1cm5zIExpc3Qgb2YgdGFza3NcbiAgICAgKi9cbiAgICBnZXRUYXNrcyhyZXF1ZXN0Tm9kZTogVGFza1F1ZXJ5UmVxdWVzdFJlcHJlc2VudGF0aW9uTW9kZWwpOiBPYnNlcnZhYmxlPFRhc2tMaXN0TW9kZWw+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jYWxsQXBpVGFza3NGaWx0ZXJlZChyZXF1ZXN0Tm9kZSkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0YXNrcyBtYXRjaGluZyBhIHF1ZXJ5IGFuZCBzdGF0ZSB2YWx1ZS5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdE5vZGUgUXVlcnkgdG8gc2VhcmNoIGZvciB0YXNrc1xuICAgICAqIEBwYXJhbSBzdGF0ZSBUYXNrIHN0YXRlLiBDYW4gYmUgXCJvcGVuXCIgb3IgXCJjb21wbGV0ZWRcIi5cbiAgICAgKiBAcmV0dXJucyBMaXN0IG9mIHRhc2tzXG4gICAgICovXG4gICAgZmluZFRhc2tzQnlTdGF0ZShyZXF1ZXN0Tm9kZTogVGFza1F1ZXJ5UmVxdWVzdFJlcHJlc2VudGF0aW9uTW9kZWwsIHN0YXRlPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUYXNrTGlzdE1vZGVsPiB7XG4gICAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICAgICAgcmVxdWVzdE5vZGUuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nZXRUYXNrcyhyZXF1ZXN0Tm9kZSlcbiAgICAgICAgICAgIC5waXBlKGNhdGNoRXJyb3IoKCkgPT4gb2YobmV3IFRhc2tMaXN0TW9kZWwoKSkpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGFsbCB0YXNrcyBtYXRjaGluZyBhIHF1ZXJ5IGFuZCBzdGF0ZSB2YWx1ZS5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdE5vZGUgUXVlcnkgdG8gc2VhcmNoIGZvciB0YXNrcy5cbiAgICAgKiBAcGFyYW0gc3RhdGUgVGFzayBzdGF0ZS4gQ2FuIGJlIFwib3BlblwiIG9yIFwiY29tcGxldGVkXCIuXG4gICAgICogQHJldHVybnMgTGlzdCBvZiB0YXNrc1xuICAgICAqL1xuICAgIGZpbmRBbGxUYXNrQnlTdGF0ZShyZXF1ZXN0Tm9kZTogVGFza1F1ZXJ5UmVxdWVzdFJlcHJlc2VudGF0aW9uTW9kZWwsIHN0YXRlPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUYXNrTGlzdE1vZGVsPiB7XG4gICAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICAgICAgcmVxdWVzdE5vZGUuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nZXRUb3RhbFRhc2tzKHJlcXVlc3ROb2RlKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Tm9kZS5zaXplID0gcmVzLnRvdGFsO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRUYXNrcyhyZXF1ZXN0Tm9kZSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbGwgdGFza3MgbWF0Y2hpbmcgdGhlIHN1cHBsaWVkIHF1ZXJ5IGJ1dCBpZ25vcmluZyB0aGUgdGFzayBzdGF0ZS5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdE5vZGUgUXVlcnkgdG8gc2VhcmNoIGZvciB0YXNrc1xuICAgICAqIEByZXR1cm5zIExpc3Qgb2YgdGFza3NcbiAgICAgKi9cbiAgICBmaW5kQWxsVGFza3NXaXRob3V0U3RhdGUocmVxdWVzdE5vZGU6IFRhc2tRdWVyeVJlcXVlc3RSZXByZXNlbnRhdGlvbk1vZGVsKTogT2JzZXJ2YWJsZTxUYXNrTGlzdE1vZGVsPiB7XG4gICAgICAgIHJldHVybiBmb3JrSm9pbihcbiAgICAgICAgICAgIHRoaXMuZmluZFRhc2tzQnlTdGF0ZShyZXF1ZXN0Tm9kZSwgJ29wZW4nKSxcbiAgICAgICAgICAgIHRoaXMuZmluZEFsbFRhc2tCeVN0YXRlKHJlcXVlc3ROb2RlLCAnY29tcGxldGVkJyksXG4gICAgICAgICAgICAoYWN0aXZlVGFza3M6IFRhc2tMaXN0TW9kZWwsIGNvbXBsZXRlZFRhc2tzOiBUYXNrTGlzdE1vZGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFza3MgPSBPYmplY3QuYXNzaWduKHt9LCBhY3RpdmVUYXNrcyk7XG4gICAgICAgICAgICAgICAgdGFza3MudG90YWwgKz0gY29tcGxldGVkVGFza3MudG90YWw7XG4gICAgICAgICAgICAgICAgdGFza3MuZGF0YSA9IHRhc2tzLmRhdGEuY29uY2F0KGNvbXBsZXRlZFRhc2tzLmRhdGEpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0YXNrcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGRldGFpbHMgZm9yIGEgdGFzay5cbiAgICAgKiBAcGFyYW0gdGFza0lkIElEIG9mIHRoZSB0YXJnZXQgdGFzay5cbiAgICAgKiBAcmV0dXJucyBUYXNrIGRldGFpbHNcbiAgICAgKi9cbiAgICBnZXRUYXNrRGV0YWlscyh0YXNrSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmNhbGxBcGlUYXNrRGV0YWlscyh0YXNrSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChkZXRhaWxzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUYXNrRGV0YWlsc01vZGVsKGRldGFpbHMpO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBjaGVja2xpc3QgZm9yIGEgdGFzay5cbiAgICAgKiBAcGFyYW0gaWQgSUQgb2YgdGhlIHRhcmdldCB0YXNrXG4gICAgICogQHJldHVybnMgQXJyYXkgb2YgY2hlY2tsaXN0IHRhc2sgZGV0YWlsc1xuICAgICAqL1xuICAgIGdldFRhc2tDaGVja2xpc3QoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbFtdPiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuY2FsbEFwaVRhc2tDaGVja2xpc3QoaWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrbGlzdHM6IFRhc2tEZXRhaWxzTW9kZWxbXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZvckVhY2goKGNoZWNrbGlzdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tsaXN0cy5wdXNoKG5ldyBUYXNrRGV0YWlsc01vZGVsKGNoZWNrbGlzdCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrbGlzdHM7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYWxsIGF2YWlsYWJsZSByZXVzYWJsZSBmb3Jtcy5cbiAgICAgKiBAcmV0dXJucyBBcnJheSBvZiBmb3JtIGRldGFpbHNcbiAgICAgKi9cbiAgICBnZXRGb3JtTGlzdCgpOiBPYnNlcnZhYmxlPEZvcm1bXT4ge1xuICAgICAgICBsZXQgb3B0cyA9IHtcbiAgICAgICAgICAgICdmaWx0ZXInOiAnbXlSZXVzYWJsZUZvcm1zJywgLy8gU3RyaW5nIHwgZmlsdGVyXG4gICAgICAgICAgICAnc29ydCc6ICdtb2RpZmllZERlc2MnLCAvLyBTdHJpbmcgfCBzb3J0XG4gICAgICAgICAgICAnbW9kZWxUeXBlJzogMiAvLyBJbnRlZ2VyIHwgbW9kZWxUeXBlXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkubW9kZWxzQXBpLmdldE1vZGVscyhvcHRzKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZm9ybXM6IEZvcm1bXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZvckVhY2goKGZvcm0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1zLnB1c2gobmV3IEZvcm0oZm9ybS5pZCwgZm9ybS5uYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybXM7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEF0dGFjaGVzIGEgZm9ybSB0byBhIHRhc2suXG4gICAgICogQHBhcmFtIHRhc2tJZCBJRCBvZiB0aGUgdGFyZ2V0IHRhc2tcbiAgICAgKiBAcGFyYW0gZm9ybUlkIElEIG9mIHRoZSBmb3JtIHRvIGFkZFxuICAgICAqIEByZXR1cm5zIE51bGwgcmVzcG9uc2Ugbm90aWZ5aW5nIHdoZW4gdGhlIG9wZXJhdGlvbiBpcyBjb21wbGV0ZVxuICAgICAqL1xuICAgIGF0dGFjaEZvcm1Ub0FUYXNrKHRhc2tJZDogc3RyaW5nLCBmb3JtSWQ6IG51bWJlcik6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS50YXNrQXBpLmF0dGFjaEZvcm0odGFza0lkLCB7ICdmb3JtSWQnOiBmb3JtSWQgfSkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIHN1YnRhc2sgKGllLCBhIGNoZWNrbGlzdCB0YXNrKSB0byBhIHBhcmVudCB0YXNrLlxuICAgICAqIEBwYXJhbSB0YXNrIFRoZSB0YXNrIHRvIGFkZFxuICAgICAqIEByZXR1cm5zIFRoZSBzdWJ0YXNrIHRoYXQgd2FzIGFkZGVkXG4gICAgICovXG4gICAgYWRkVGFzayh0YXNrOiBUYXNrRGV0YWlsc01vZGVsKTogT2JzZXJ2YWJsZTxUYXNrRGV0YWlsc01vZGVsPiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuY2FsbEFwaUFkZFRhc2sodGFzaykpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlc3BvbnNlOiBUYXNrRGV0YWlsc01vZGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVGFza0RldGFpbHNNb2RlbChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlbGV0ZXMgYSBzdWJ0YXNrIChpZSwgYSBjaGVja2xpc3QgdGFzaykgZnJvbSBhIHBhcmVudCB0YXNrLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgVGhlIHRhc2sgdG8gZGVsZXRlXG4gICAgICogQHJldHVybnMgTnVsbCByZXNwb25zZSBub3RpZnlpbmcgd2hlbiB0aGUgb3BlcmF0aW9uIGlzIGNvbXBsZXRlXG4gICAgICovXG4gICAgZGVsZXRlVGFzayh0YXNrSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICByZXR1cm4gZnJvbTxUYXNrRGV0YWlsc01vZGVsPih0aGlzLmNhbGxBcGlEZWxldGVUYXNrKHRhc2tJZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlcyBhIGZvcm0gZnJvbSBhIHRhc2suXG4gICAgICogQHBhcmFtIHRhc2tJZCBUYXNrIGlkIHJlbGF0ZWQgdG8gZm9ybVxuICAgICAqIEByZXR1cm5zIE51bGwgcmVzcG9uc2Ugbm90aWZ5aW5nIHdoZW4gdGhlIG9wZXJhdGlvbiBpcyBjb21wbGV0ZVxuICAgICAqL1xuICAgIGRlbGV0ZUZvcm0odGFza0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+IHtcbiAgICAgICAgcmV0dXJuIGZyb208VGFza0RldGFpbHNNb2RlbD4odGhpcy5jYWxsQXBpRGVsZXRlRm9ybSh0YXNrSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdpdmVzIGNvbXBsZXRlZCBzdGF0dXMgdG8gYSB0YXNrLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhcmdldCB0YXNrXG4gICAgICogQHJldHVybnMgTnVsbCByZXNwb25zZSBub3RpZnlpbmcgd2hlbiB0aGUgb3BlcmF0aW9uIGlzIGNvbXBsZXRlXG4gICAgICovXG4gICAgY29tcGxldGVUYXNrKHRhc2tJZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS50YXNrQXBpLmNvbXBsZXRlVGFzayh0YXNrSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHRvdGFsIG51bWJlciBvZiB0aGUgdGFza3MgZm91bmQgYnkgYSBxdWVyeS5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdE5vZGUgUXVlcnkgdG8gc2VhcmNoIGZvciB0YXNrc1xuICAgICAqIEByZXR1cm5zIE51bWJlciBvZiB0YXNrc1xuICAgICAqL1xuICAgIHB1YmxpYyBnZXRUb3RhbFRhc2tzKHJlcXVlc3ROb2RlOiBUYXNrUXVlcnlSZXF1ZXN0UmVwcmVzZW50YXRpb25Nb2RlbCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJlcXVlc3ROb2RlLnNpemUgPSAwO1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmNhbGxBcGlUYXNrc0ZpbHRlcmVkKHJlcXVlc3ROb2RlKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBzdGFuZGFsb25lIHRhc2suXG4gICAgICogQHBhcmFtIHRhc2sgRGV0YWlscyBvZiB0aGUgbmV3IHRhc2tcbiAgICAgKiBAcmV0dXJucyBEZXRhaWxzIG9mIHRoZSBuZXdseSBjcmVhdGVkIHRhc2tcbiAgICAgKi9cbiAgICBjcmVhdGVOZXdUYXNrKHRhc2s6IFRhc2tEZXRhaWxzTW9kZWwpOiBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jYWxsQXBpQ3JlYXRlVGFzayh0YXNrKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzcG9uc2U6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUYXNrRGV0YWlsc01vZGVsKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzaWducyBhIHRhc2sgdG8gYSB1c2VyIG9yIGdyb3VwLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgVGhlIHRhc2sgdG8gYXNzaWduXG4gICAgICogQHBhcmFtIHJlcXVlc3ROb2RlIFVzZXIgb3IgZ3JvdXAgdG8gYXNzaWduIHRoZSB0YXNrIHRvXG4gICAgICogQHJldHVybnMgRGV0YWlscyBvZiB0aGUgYXNzaWduZWQgdGFza1xuICAgICAqL1xuICAgIGFzc2lnblRhc2sodGFza0lkOiBzdHJpbmcsIHJlcXVlc3ROb2RlOiBhbnkpOiBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+IHtcbiAgICAgICAgbGV0IGFzc2lnbmVlID0geyBhc3NpZ25lZTogcmVxdWVzdE5vZGUuaWQgfTtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jYWxsQXBpQXNzaWduVGFzayh0YXNrSWQsIGFzc2lnbmVlKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzcG9uc2U6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUYXNrRGV0YWlsc01vZGVsKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzaWducyBhIHRhc2sgdG8gYSB1c2VyLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhc2sgdG8gYXNzaWduXG4gICAgICogQHBhcmFtIHVzZXJJZCBJRCBvZiB0aGUgdXNlciB0byBhc3NpZ24gdGhlIHRhc2sgdG9cbiAgICAgKiBAcmV0dXJucyBEZXRhaWxzIG9mIHRoZSBhc3NpZ25lZCB0YXNrXG4gICAgICovXG4gICAgYXNzaWduVGFza0J5VXNlcklkKHRhc2tJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICBjb25zdCBhc3NpZ25lZSA9IDxBc3NpZ25lZUlkZW50aWZpZXJSZXByZXNlbnRhdGlvbj4geyBhc3NpZ25lZTogdXNlcklkIH07XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuY2FsbEFwaUFzc2lnblRhc2sodGFza0lkLCBhc3NpZ25lZSkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlc3BvbnNlOiBUYXNrRGV0YWlsc01vZGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVGFza0RldGFpbHNNb2RlbChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsYWltcyBhIHRhc2sgZm9yIHRoZSBjdXJyZW50IHVzZXIuXG4gICAgICogQHBhcmFtIHRhc2tJZCBJRCBvZiB0aGUgdGFzayB0byBjbGFpbVxuICAgICAqIEByZXR1cm5zIERldGFpbHMgb2YgdGhlIGNsYWltZWQgdGFza1xuICAgICAqL1xuICAgIGNsYWltVGFzayh0YXNrSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICByZXR1cm4gZnJvbTxUYXNrRGV0YWlsc01vZGVsPih0aGlzLmFwaVNlcnZpY2UudGFza0FwaS5jbGFpbVRhc2sodGFza0lkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVbi1jbGFpbXMgYSB0YXNrIGZvciB0aGUgY3VycmVudCB1c2VyLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhc2sgdG8gdW5jbGFpbVxuICAgICAqIEByZXR1cm5zIE51bGwgcmVzcG9uc2Ugbm90aWZ5aW5nIHdoZW4gdGhlIG9wZXJhdGlvbiBpcyBjb21wbGV0ZVxuICAgICAqL1xuICAgIHVuY2xhaW1UYXNrKHRhc2tJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUYXNrRGV0YWlsc01vZGVsPiB7XG4gICAgICAgIHJldHVybiBmcm9tPFRhc2tEZXRhaWxzTW9kZWw+KHRoaXMuYXBpU2VydmljZS50YXNrQXBpLnVuY2xhaW1UYXNrKHRhc2tJZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgZGV0YWlscyAobmFtZSwgZGVzY3JpcHRpb24sIGR1ZSBkYXRlKSBmb3IgYSB0YXNrLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhc2sgdG8gdXBkYXRlXG4gICAgICogQHBhcmFtIHVwZGF0ZWQgRGF0YSB0byB1cGRhdGUgdGhlIHRhc2sgKGFzIGEgYFRhc2tVcGRhdGVSZXByZXNlbnRhdGlvbmAgaW5zdGFuY2UpLlxuICAgICAqIEByZXR1cm5zIFVwZGF0ZWQgdGFzayBkZXRhaWxzXG4gICAgICovXG4gICAgdXBkYXRlVGFzayh0YXNrSWQ6IGFueSwgdXBkYXRlZCk6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UudGFza0FwaS51cGRhdGVUYXNrKHRhc2tJZCwgdXBkYXRlZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlc3VsdCkgPT4gPFRhc2tEZXRhaWxzTW9kZWw+IHJlc3VsdCksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoZXMgdGhlIFRhc2sgQXVkaXQgaW5mb3JtYXRpb24gaW4gUERGIGZvcm1hdC5cbiAgICAgKiBAcGFyYW0gdGFza0lkIElEIG9mIHRoZSB0YXJnZXQgdGFza1xuICAgICAqIEByZXR1cm5zIEJpbmFyeSBQREYgZGF0YVxuICAgICAqL1xuICAgIGZldGNoVGFza0F1ZGl0UGRmQnlJZCh0YXNrSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8QmxvYj4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UudGFza0FwaS5nZXRUYXNrQXVkaXRQZGYodGFza0lkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgoZGF0YSkgPT4gPEJsb2I+IGRhdGEpLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCB0aGUgVGFzayBBdWRpdCBpbmZvcm1hdGlvbiBpbiBKU09OIGZvcm1hdFxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhcmdldCB0YXNrXG4gICAgICogQHJldHVybnMgSlNPTiBkYXRhXG4gICAgICovXG4gICAgZmV0Y2hUYXNrQXVkaXRKc29uQnlJZCh0YXNrSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS50YXNrQXBpLmdldFRhc2tBdWRpdEpzb24odGFza0lkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGxBcGlUYXNrc0ZpbHRlcmVkKHJlcXVlc3ROb2RlOiBUYXNrUXVlcnlSZXByZXNlbnRhdGlvbik6IFByb21pc2U8VGFza0xpc3RNb2RlbD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcGlTZXJ2aWNlLnRhc2tBcGkubGlzdFRhc2tzKHJlcXVlc3ROb2RlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGxBcGlUYXNrRGV0YWlscyh0YXNrSWQ6IHN0cmluZyk6IFByb21pc2U8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcGlTZXJ2aWNlLnRhc2tBcGkuZ2V0VGFzayh0YXNrSWQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FsbEFwaUFkZFRhc2sodGFzazogVGFza0RldGFpbHNNb2RlbCk6IFByb21pc2U8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcGlTZXJ2aWNlLnRhc2tBcGkuYWRkU3VidGFzayh0YXNrLnBhcmVudFRhc2tJZCwgdGFzayk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxsQXBpRGVsZXRlVGFzayh0YXNrSWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwaVNlcnZpY2UudGFza0FwaS5kZWxldGVUYXNrKHRhc2tJZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxsQXBpRGVsZXRlRm9ybSh0YXNrSWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwaVNlcnZpY2UudGFza0FwaS5yZW1vdmVGb3JtKHRhc2tJZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxsQXBpVGFza0NoZWNrbGlzdCh0YXNrSWQ6IHN0cmluZyk6IFByb21pc2U8VGFza0xpc3RNb2RlbD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcGlTZXJ2aWNlLnRhc2tBcGkuZ2V0Q2hlY2tsaXN0KHRhc2tJZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxsQXBpQ3JlYXRlVGFzayh0YXNrOiBUYXNrRGV0YWlsc01vZGVsKTogUHJvbWlzZTxUYXNrRGV0YWlsc01vZGVsPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwaVNlcnZpY2UudGFza0FwaS5jcmVhdGVOZXdUYXNrKHRhc2spO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FsbEFwaUFzc2lnblRhc2sodGFza0lkOiBzdHJpbmcsIHJlcXVlc3ROb2RlOiBBc3NpZ25lZUlkZW50aWZpZXJSZXByZXNlbnRhdGlvbik6IFByb21pc2U8VGFza0RldGFpbHNNb2RlbD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcGlTZXJ2aWNlLnRhc2tBcGkuYXNzaWduVGFzayh0YXNrSWQsIHJlcXVlc3ROb2RlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUVycm9yKGVycm9yOiBhbnkpIHtcbiAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoZXJyb3IgfHwgJ1NlcnZlciBlcnJvcicpO1xuICAgIH1cblxufVxuIl19