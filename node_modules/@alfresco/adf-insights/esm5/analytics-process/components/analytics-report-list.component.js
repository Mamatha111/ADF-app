/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { Observable } from 'rxjs';
import { AnalyticsService } from '../services/analytics.service';
import { share } from 'rxjs/operators';
var AnalyticsReportListComponent = /** @class */ (function () {
    function AnalyticsReportListComponent(analyticsService) {
        var _this = this;
        this.analyticsService = analyticsService;
        this.layoutType = AnalyticsReportListComponent.LAYOUT_LIST;
        this.selectFirst = false;
        this.reportClick = new EventEmitter();
        this.success = new EventEmitter();
        this.error = new EventEmitter();
        this.reports = [];
        this.report$ = new Observable(function (observer) { return _this.reportObserver = observer; })
            .pipe(share());
    }
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initObserver();
        this.getReportList(this.appId);
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.initObserver = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.report$.subscribe(function (report) {
            _this.reports.push(report);
        });
    };
    /**
     * Reload the component
     */
    /**
     * Reload the component
     * @param {?=} reportId
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.reload = /**
     * Reload the component
     * @param {?=} reportId
     * @return {?}
     */
    function (reportId) {
        this.reset();
        this.getReportList(this.appId, reportId);
    };
    /**
     * Get the report list
     */
    /**
     * Get the report list
     * @param {?} appId
     * @param {?=} reportId
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.getReportList = /**
     * Get the report list
     * @param {?} appId
     * @param {?=} reportId
     * @return {?}
     */
    function (appId, reportId) {
        var _this = this;
        this.analyticsService.getReportList(appId).subscribe(function (res) {
            if (res && res.length === 0) {
                _this.createDefaultReports();
            }
            else {
                res.forEach(function (report) {
                    _this.reportObserver.next(report);
                });
                if (reportId) {
                    _this.selectReportByReportId(reportId);
                }
                if (_this.selectFirst) {
                    _this.selectFirstReport();
                }
                _this.success.emit(res);
            }
        }, function (err) {
            _this.error.emit(err);
        });
    };
    /**
     * Create the default reports and return the report list
     */
    /**
     * Create the default reports and return the report list
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.createDefaultReports = /**
     * Create the default reports and return the report list
     * @return {?}
     */
    function () {
        var _this = this;
        this.analyticsService.createDefaultReports().subscribe(function () {
            _this.analyticsService.getReportList(_this.appId).subscribe(function (response) {
                response.forEach(function (report) {
                    _this.reportObserver.next(report);
                });
                _this.success.emit(response);
            });
        });
    };
    /**
     * Check if the report list is empty
     */
    /**
     * Check if the report list is empty
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isReportsEmpty = /**
     * Check if the report list is empty
     * @return {?}
     */
    function () {
        return this.reports === undefined || (this.reports && this.reports.length === 0);
    };
    /**
     * Reset the list
     */
    /**
     * Reset the list
     * @private
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.reset = /**
     * Reset the list
     * @private
     * @return {?}
     */
    function () {
        if (!this.isReportsEmpty()) {
            this.reports = [];
        }
    };
    /**
     * Select the current report
     * @param report
     */
    /**
     * Select the current report
     * @param {?} report
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.selectReport = /**
     * Select the current report
     * @param {?} report
     * @return {?}
     */
    function (report) {
        this.currentReport = report;
        this.reportClick.emit(report);
    };
    /**
     * @param {?} reportId
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.selectReportByReportId = /**
     * @param {?} reportId
     * @return {?}
     */
    function (reportId) {
        /** @type {?} */
        var reportFound = this.reports.find(function (report) { return report.id === reportId; });
        if (reportFound) {
            this.currentReport = reportFound;
            this.reportClick.emit(reportFound);
        }
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.selectFirstReport = /**
     * @return {?}
     */
    function () {
        this.selectReport(this.reports[0]);
        this.selectFirst = false;
    };
    /**
     * @param {?} report
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isSelected = /**
     * @param {?} report
     * @return {?}
     */
    function (report) {
        return this.currentReport === report ? true : false;
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isList = /**
     * @return {?}
     */
    function () {
        return this.layoutType === AnalyticsReportListComponent.LAYOUT_LIST;
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isGrid = /**
     * @return {?}
     */
    function () {
        return this.layoutType === AnalyticsReportListComponent.LAYOUT_GRID;
    };
    AnalyticsReportListComponent.LAYOUT_LIST = 'LIST';
    AnalyticsReportListComponent.LAYOUT_GRID = 'GRID';
    AnalyticsReportListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-analytics-report-list',
                    template: "<div class=\"adf-analytics-report-list menu-container\">\n    <mat-nav-list *ngIf=\"isList()\">\n        <mat-list-item\n            class=\"adf-activiti-filters__entry\"\n            (click)=\"selectReport(report)\"\n            *ngFor=\"let report of reports; let idx = index\"\n            [class.adf-active]=\"currentReport === report\">\n            <span [attr.id]=\"'report-list-' + idx\" class=\"adf-activiti-filters__label\">\n                <mat-icon mat-list-icon\n                    [attr.data-automation-id]=\"report.name + '_filter'\"\n                    class=\"adf-activiti-filters__entry-icon\">assignment</mat-icon>\n                <span class=\"adf-text\">{{report.name}}</span>\n            </span>\n        </mat-list-item>\n    </mat-nav-list>\n    <div class=\"adf-report-card-grids\" *ngIf=\"isGrid()\">\n        <mat-card (click)=\"selectReport(report)\" class=\"adf-report-card\" *ngFor=\"let report of reports;\">\n            <div class=\"adf-report-card-logo logo\">\n                <mat-icon class=\"adf-report-card-logo-icon\">equalizer</mat-icon>\n            </div>\n            <div mat-card-title class=\"adf-report-card-title\">\n                <h1 class=\"adf-application-title\">{{report.name}}</h1>\n            </div>\n            <div mat-card-content class=\"adf-report-card-content\">\n                <p>{{report.description}}</p>\n            </div>\n            <div mat-card-actions class=\"adf-report-card-actions\">\n                <mat-icon class=\"adf-report-card-actions-icon\" *ngIf=\"isSelected(report)\">done</mat-icon>\n            </div>\n        </mat-card>\n    </div>\n</div>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    AnalyticsReportListComponent.ctorParameters = function () { return [
        { type: AnalyticsService }
    ]; };
    AnalyticsReportListComponent.propDecorators = {
        layoutType: [{ type: Input }],
        appId: [{ type: Input }],
        selectFirst: [{ type: Input }],
        reportClick: [{ type: Output }],
        success: [{ type: Output }],
        error: [{ type: Output }]
    };
    return AnalyticsReportListComponent;
}());
export { AnalyticsReportListComponent };
if (false) {
    /** @type {?} */
    AnalyticsReportListComponent.LAYOUT_LIST;
    /** @type {?} */
    AnalyticsReportListComponent.LAYOUT_GRID;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.layoutType;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.appId;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.selectFirst;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.reportClick;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.success;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.error;
    /**
     * @type {?}
     * @private
     */
    AnalyticsReportListComponent.prototype.reportObserver;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.report$;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.currentReport;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.reports;
    /**
     * @type {?}
     * @private
     */
    AnalyticsReportListComponent.prototype.analyticsService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLXJlcG9ydC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtaW5zaWdodHMvIiwic291cmNlcyI6WyJhbmFseXRpY3MtcHJvY2Vzcy9jb21wb25lbnRzL2FuYWx5dGljcy1yZXBvcnQtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsRyxPQUFPLEVBQUUsVUFBVSxFQUFZLE1BQU0sTUFBTSxDQUFDO0FBRTVDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2QztJQW9DSSxzQ0FBb0IsZ0JBQWtDO1FBQXRELGlCQUdDO1FBSG1CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUF4QnRELGVBQVUsR0FBVyw0QkFBNEIsQ0FBQyxXQUFXLENBQUM7UUFNOUQsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFHN0IsZ0JBQVcsR0FBd0MsSUFBSSxZQUFZLEVBQXlCLENBQUM7UUFHN0YsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFHN0IsVUFBSyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFPM0IsWUFBTyxHQUE0QixFQUFFLENBQUM7UUFHbEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFVBQVUsQ0FBd0IsVUFBQyxRQUFRLElBQUssT0FBQSxLQUFJLENBQUMsY0FBYyxHQUFHLFFBQVEsRUFBOUIsQ0FBOEIsQ0FBQzthQUM3RixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUN2QixDQUFDOzs7O0lBRUQsK0NBQVE7OztJQUFSO1FBQ0ksSUFBSSxDQUFDLFlBQVks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QyxJQUFJOztpQkFDeEM7Ozs7Z0JBUlEsZ0JBQWdCOzs7NkJBY3BCLEtBQUs7d0JBR0wsS0FBSzs4QkFHTCxLQUFLOzhCQUdMLE1BQU07MEJBR04sTUFBTTt3QkFHTixNQUFNOztJQWlJWCxtQ0FBQztDQUFBLEFBM0pELElBMkpDO1NBckpZLDRCQUE0Qjs7O0lBRXJDLHlDQUEyQzs7SUFDM0MseUNBQTJDOztJQUUzQyxrREFDOEQ7O0lBRTlELDZDQUNjOztJQUVkLG1EQUM2Qjs7SUFFN0IsbURBQzZGOztJQUU3RiwrQ0FDNkI7O0lBRTdCLDZDQUMyQjs7Ozs7SUFFM0Isc0RBQXNDOztJQUN0QywrQ0FBeUI7O0lBRXpCLHFEQUFtQjs7SUFFbkIsK0NBQXNDOzs7OztJQUUxQix3REFBMEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgT2JzZXJ2ZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFJlcG9ydFBhcmFtZXRlcnNNb2RlbCB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL3JlcG9ydC9yZXBvcnRQYXJhbWV0ZXJzLm1vZGVsJztcbmltcG9ydCB7IEFuYWx5dGljc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hbmFseXRpY3Muc2VydmljZSc7XG5pbXBvcnQgeyBzaGFyZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtYW5hbHl0aWNzLXJlcG9ydC1saXN0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYW5hbHl0aWNzLXJlcG9ydC1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9hbmFseXRpY3MtcmVwb3J0LWxpc3QuY29tcG9uZW50LnNjc3MnXSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIEFuYWx5dGljc1JlcG9ydExpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgcHVibGljIHN0YXRpYyBMQVlPVVRfTElTVDogc3RyaW5nID0gJ0xJU1QnO1xuICAgIHB1YmxpYyBzdGF0aWMgTEFZT1VUX0dSSUQ6IHN0cmluZyA9ICdHUklEJztcblxuICAgIEBJbnB1dCgpXG4gICAgbGF5b3V0VHlwZTogc3RyaW5nID0gQW5hbHl0aWNzUmVwb3J0TGlzdENvbXBvbmVudC5MQVlPVVRfTElTVDtcblxuICAgIEBJbnB1dCgpXG4gICAgYXBwSWQ6IG51bWJlcjtcblxuICAgIEBJbnB1dCgpXG4gICAgc2VsZWN0Rmlyc3Q6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHJlcG9ydENsaWNrOiBFdmVudEVtaXR0ZXI8UmVwb3J0UGFyYW1ldGVyc01vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8UmVwb3J0UGFyYW1ldGVyc01vZGVsPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgc3VjY2VzcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgcHJpdmF0ZSByZXBvcnRPYnNlcnZlcjogT2JzZXJ2ZXI8YW55PjtcbiAgICByZXBvcnQkOiBPYnNlcnZhYmxlPGFueT47XG5cbiAgICBjdXJyZW50UmVwb3J0OiBhbnk7XG5cbiAgICByZXBvcnRzOiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWxbXSA9IFtdO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhbmFseXRpY3NTZXJ2aWNlOiBBbmFseXRpY3NTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMucmVwb3J0JCA9IG5ldyBPYnNlcnZhYmxlPFJlcG9ydFBhcmFtZXRlcnNNb2RlbD4oKG9ic2VydmVyKSA9PiB0aGlzLnJlcG9ydE9ic2VydmVyID0gb2JzZXJ2ZXIpXG4gICAgICAgICAgICAucGlwZShzaGFyZSgpKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5pbml0T2JzZXJ2ZXIoKTtcblxuICAgICAgICB0aGlzLmdldFJlcG9ydExpc3QodGhpcy5hcHBJZCk7XG4gICAgfVxuXG4gICAgaW5pdE9ic2VydmVyKCkge1xuICAgICAgICB0aGlzLnJlcG9ydCQuc3Vic2NyaWJlKChyZXBvcnQ6IFJlcG9ydFBhcmFtZXRlcnNNb2RlbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZXBvcnRzLnB1c2gocmVwb3J0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVsb2FkIHRoZSBjb21wb25lbnRcbiAgICAgKi9cbiAgICByZWxvYWQocmVwb3J0SWQ/KSB7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgdGhpcy5nZXRSZXBvcnRMaXN0KHRoaXMuYXBwSWQsIHJlcG9ydElkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHJlcG9ydCBsaXN0XG4gICAgICovXG4gICAgZ2V0UmVwb3J0TGlzdChhcHBJZDogbnVtYmVyLCByZXBvcnRJZD86IHN0cmluZykge1xuICAgICAgICB0aGlzLmFuYWx5dGljc1NlcnZpY2UuZ2V0UmVwb3J0TGlzdChhcHBJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlczogUmVwb3J0UGFyYW1ldGVyc01vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVEZWZhdWx0UmVwb3J0cygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5mb3JFYWNoKChyZXBvcnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwb3J0T2JzZXJ2ZXIubmV4dChyZXBvcnQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcG9ydElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJlcG9ydEJ5UmVwb3J0SWQocmVwb3J0SWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdEZpcnN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdEZpcnN0UmVwb3J0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQocmVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSBkZWZhdWx0IHJlcG9ydHMgYW5kIHJldHVybiB0aGUgcmVwb3J0IGxpc3RcbiAgICAgKi9cbiAgICBjcmVhdGVEZWZhdWx0UmVwb3J0cygpIHtcbiAgICAgICAgdGhpcy5hbmFseXRpY3NTZXJ2aWNlLmNyZWF0ZURlZmF1bHRSZXBvcnRzKCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYW5hbHl0aWNzU2VydmljZS5nZXRSZXBvcnRMaXN0KHRoaXMuYXBwSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgKHJlc3BvbnNlOiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaCgocmVwb3J0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBvcnRPYnNlcnZlci5uZXh0KHJlcG9ydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzcy5lbWl0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIHJlcG9ydCBsaXN0IGlzIGVtcHR5XG4gICAgICovXG4gICAgaXNSZXBvcnRzRW1wdHkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcG9ydHMgPT09IHVuZGVmaW5lZCB8fCAodGhpcy5yZXBvcnRzICYmIHRoaXMucmVwb3J0cy5sZW5ndGggPT09IDApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0IHRoZSBsaXN0XG4gICAgICovXG4gICAgcHJpdmF0ZSByZXNldCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUmVwb3J0c0VtcHR5KCkpIHtcbiAgICAgICAgICAgIHRoaXMucmVwb3J0cyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VsZWN0IHRoZSBjdXJyZW50IHJlcG9ydFxuICAgICAqIEBwYXJhbSByZXBvcnRcbiAgICAgKi9cbiAgICBwdWJsaWMgc2VsZWN0UmVwb3J0KHJlcG9ydDogYW55KSB7XG4gICAgICAgIHRoaXMuY3VycmVudFJlcG9ydCA9IHJlcG9ydDtcbiAgICAgICAgdGhpcy5yZXBvcnRDbGljay5lbWl0KHJlcG9ydCk7XG4gICAgfVxuXG4gICAgcHVibGljIHNlbGVjdFJlcG9ydEJ5UmVwb3J0SWQocmVwb3J0SWQpIHtcbiAgICAgICAgbGV0IHJlcG9ydEZvdW5kID0gdGhpcy5yZXBvcnRzLmZpbmQoKHJlcG9ydCkgPT4gcmVwb3J0LmlkID09PSByZXBvcnRJZCk7XG4gICAgICAgIGlmIChyZXBvcnRGb3VuZCkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVwb3J0ID0gcmVwb3J0Rm91bmQ7XG4gICAgICAgICAgICB0aGlzLnJlcG9ydENsaWNrLmVtaXQocmVwb3J0Rm91bmQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VsZWN0Rmlyc3RSZXBvcnQoKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0UmVwb3J0KHRoaXMucmVwb3J0c1swXSk7XG4gICAgICAgIHRoaXMuc2VsZWN0Rmlyc3QgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpc1NlbGVjdGVkKHJlcG9ydDogYW55KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRSZXBvcnQgPT09IHJlcG9ydCA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc0xpc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxheW91dFR5cGUgPT09IEFuYWx5dGljc1JlcG9ydExpc3RDb21wb25lbnQuTEFZT1VUX0xJU1Q7XG4gICAgfVxuXG4gICAgaXNHcmlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sYXlvdXRUeXBlID09PSBBbmFseXRpY3NSZXBvcnRMaXN0Q29tcG9uZW50LkxBWU9VVF9HUklEO1xuICAgIH1cbn1cbiJdfQ==