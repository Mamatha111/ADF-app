/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* tslint:disable:no-input-rename  */
import { MOMENT_DATE_FORMATS, MomentDateAdapter, UserPreferencesService, UserPreferenceValues } from '@alfresco/adf-core';
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { DateAdapter, MAT_DATE_FORMATS } from '@angular/material';
import moment from 'moment-es6';
var ɵ0 = MOMENT_DATE_FORMATS;
var DateRangeWidgetComponent = /** @class */ (function () {
    function DateRangeWidgetComponent(dateAdapter, userPreferencesService) {
        this.dateAdapter = dateAdapter;
        this.userPreferencesService = userPreferencesService;
        this.FORMAT_DATE_ACTIVITI = 'YYYY-MM-DD';
        this.SHOW_FORMAT = 'DD/MM/YYYY';
        this.dateRangeChanged = new EventEmitter();
        this.startDatePicker = moment();
        this.endDatePicker = moment();
    }
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.userPreferencesService.select(UserPreferenceValues.Locale).subscribe(function (locale) {
            _this.dateAdapter.setLocale(locale);
        });
        /** @type {?} */
        var momentDateAdapter = (/** @type {?} */ (this.dateAdapter));
        momentDateAdapter.overrideDisplayFormat = this.SHOW_FORMAT;
        if (this.field) {
            if (this.field.value && this.field.value.startDate) {
                this.startDatePicker = moment(this.field.value.startDate, this.FORMAT_DATE_ACTIVITI);
            }
            if (this.field.value && this.field.value.endDate) {
                this.endDatePicker = moment(this.field.value.endDate, this.FORMAT_DATE_ACTIVITI);
            }
        }
        /** @type {?} */
        var startDateControl = new FormControl(this.startDatePicker);
        startDateControl.setValidators(Validators.required);
        this.dateRange.addControl('startDate', startDateControl);
        /** @type {?} */
        var endDateControl = new FormControl(this.endDatePicker);
        endDateControl.setValidators(Validators.required);
        this.dateRange.addControl('endDate', endDateControl);
        this.dateRange.setValidators(this.dateCheck);
        this.dateRange.valueChanges.subscribe(function () { return _this.onGroupValueChanged(); });
    };
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.onGroupValueChanged = /**
     * @return {?}
     */
    function () {
        if (this.dateRange.valid) {
            /** @type {?} */
            var dateStart = this.convertToMomentDateWithTime(this.dateRange.controls.startDate.value);
            /** @type {?} */
            var endStart = this.convertToMomentDateWithTime(this.dateRange.controls.endDate.value);
            this.dateRangeChanged.emit({ startDate: dateStart, endDate: endStart });
        }
    };
    /**
     * @param {?} date
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.convertToMomentDateWithTime = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        return moment(date, this.FORMAT_DATE_ACTIVITI, true).format(this.FORMAT_DATE_ACTIVITI) + 'T00:00:00.000Z';
    };
    /**
     * @param {?} formControl
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.dateCheck = /**
     * @param {?} formControl
     * @return {?}
     */
    function (formControl) {
        /** @type {?} */
        var startDate = moment(formControl.get('startDate').value);
        /** @type {?} */
        var endDate = moment(formControl.get('endDate').value);
        /** @type {?} */
        var isAfterCheck = startDate.isAfter(endDate);
        return isAfterCheck ? { 'greaterThan': true } : null;
    };
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.isStartDateGreaterThanEndDate = /**
     * @return {?}
     */
    function () {
        return this.dateRange && this.dateRange.errors && this.dateRange.errors.greaterThan;
    };
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.isStartDateEmpty = /**
     * @return {?}
     */
    function () {
        return this.dateRange && this.dateRange.controls.startDate && !this.dateRange.controls.startDate.valid;
    };
    DateRangeWidgetComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-date-range-widget',
                    template: "<label>{{field.nameKey | translate}}</label><br>\n<div [formGroup]=\"dateRange\">\n    <small *ngIf=\"isStartDateGreaterThanEndDate()\" class=\"adf-date-range-analytics-text-danger\">\n       {{'DATE-WIDGET.MESSAGES.START-LESS-THAN-END-DATE' | translate}}\n    </small>\n    <small *ngIf=\"isStartDateEmpty()\" class=\"adf-date-range-analytics-text-danger\">\n       {{'DATE-WIDGET.MESSAGES.START-DATE-REQUIRED' | translate}}\n    </small>\n\n            <mat-grid-list cols=\"2\" rowHeight=\"80px\">\n                <mat-grid-tile>\n                    <mat-form-field>\n                        <input\n                            matInput\n                            [min]=\"minDate\"\n                            [max]=\"maxDate\"\n                            formControlName=\"startDate\"\n                            [matDatepicker]=\"startDate\"\n                            [value]=\"startDatePicker\"\n                            (keydown)=\"true\"\n                            (dateChange)=\"onGroupValueChanged()\"\n                            placeholder=\"{{'DATE-WIDGET.START-DATE' | translate}}\"\n                            id=\"startDate_id\"\n                            required>\n                        <mat-datepicker-toggle matSuffix [for]=\"startDate\" ></mat-datepicker-toggle>\n                    </mat-form-field>\n                    <mat-datepicker\n                        #startDate\n                        [touchUi]=\"true\">\n                    </mat-datepicker>\n                </mat-grid-tile>\n                <mat-grid-tile>\n                    <mat-form-field>\n                        <input\n                            matInput\n                            [min]=\"minDate\"\n                            [max]=\"maxDate\"\n                            formControlName=\"endDate\"\n                            [matDatepicker]=\"endDate\"\n                            [value]=\"endDatePicker\"\n                            (keydown)=\"true\"\n                            (dateChange)=\"onGroupValueChanged()\"\n                            placeholder=\"{{'DATE-WIDGET.END-DATE' | translate}}\"\n                            id=\"endDate_id\"\n                            required>\n                        <mat-datepicker-toggle matSuffix [for]=\"endDate\" ></mat-datepicker-toggle>\n                    </mat-form-field>\n                    <mat-datepicker\n                        #endDate\n                        [touchUi]=\"true\">\n                    </mat-datepicker>\n                </mat-grid-tile>\n            </mat-grid-list>\n</div>\n",
                    providers: [
                        { provide: DateAdapter, useClass: MomentDateAdapter },
                        { provide: MAT_DATE_FORMATS, useValue: ɵ0 }
                    ],
                    encapsulation: ViewEncapsulation.None,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    DateRangeWidgetComponent.ctorParameters = function () { return [
        { type: DateAdapter },
        { type: UserPreferencesService }
    ]; };
    DateRangeWidgetComponent.propDecorators = {
        dateRange: [{ type: Input, args: ['group',] }],
        field: [{ type: Input }],
        dateRangeChanged: [{ type: Output }]
    };
    return DateRangeWidgetComponent;
}());
export { DateRangeWidgetComponent };
if (false) {
    /** @type {?} */
    DateRangeWidgetComponent.prototype.FORMAT_DATE_ACTIVITI;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.SHOW_FORMAT;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.dateRange;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.field;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.dateRangeChanged;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.minDate;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.maxDate;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.startDatePicker;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.endDatePicker;
    /**
     * @type {?}
     * @private
     */
    DateRangeWidgetComponent.prototype.dateAdapter;
    /**
     * @type {?}
     * @private
     */
    DateRangeWidgetComponent.prototype.userPreferencesService;
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS53aWRnZXQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWluc2lnaHRzLyIsInNvdXJjZXMiOlsiYW5hbHl0aWNzLXByb2Nlc3MvY29tcG9uZW50cy93aWRnZXRzL2RhdGUtcmFuZ2UvZGF0ZS1yYW5nZS53aWRnZXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxpQkFBaUIsRUFBRSxzQkFBc0IsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFILE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEcsT0FBTyxFQUFtQixXQUFXLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JGLE9BQU8sRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRSxPQUFPLE1BQU0sTUFBTSxZQUFZLENBQUM7U0FRYyxtQkFBbUI7QUFMakU7SUE0Qkksa0NBQ1ksV0FBZ0MsRUFDaEMsc0JBQThDO1FBRDlDLGdCQUFXLEdBQVgsV0FBVyxDQUFxQjtRQUNoQywyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBbkJuRCx5QkFBb0IsR0FBVyxZQUFZLENBQUM7UUFDNUMsZ0JBQVcsR0FBVyxZQUFZLENBQUM7UUFTMUMscUJBQWdCLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFJOUQsb0JBQWUsR0FBVyxNQUFNLEVBQUUsQ0FBQztRQUNuQyxrQkFBYSxHQUFXLE1BQU0sRUFBRSxDQUFDO0lBS2pDLENBQUM7Ozs7SUFFRCwyQ0FBUTs7O0lBQVI7UUFBQSxpQkE0QkM7UUEzQkcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMs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REFBaUM7Ozs7O0lBRzdCLCtDQUF3Qzs7Ozs7SUFDeEMsMERBQXNEIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLyogdHNsaW50OmRpc2FibGU6bm8taW5wdXQtcmVuYW1lICAqL1xuXG5pbXBvcnQgeyBNT01FTlRfREFURV9GT1JNQVRTLCBNb21lbnREYXRlQWRhcHRlciwgVXNlclByZWZlcmVuY2VzU2VydmljZSwgVXNlclByZWZlcmVuY2VWYWx1ZXMgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgRm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IERhdGVBZGFwdGVyLCBNQVRfREFURV9GT1JNQVRTIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQtZXM2JztcbmltcG9ydCB7IE1vbWVudCB9IGZyb20gJ21vbWVudCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLWRhdGUtcmFuZ2Utd2lkZ2V0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZGF0ZS1yYW5nZS53aWRnZXQuaHRtbCcsXG4gICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtwcm92aWRlOiBEYXRlQWRhcHRlciwgdXNlQ2xhc3M6IE1vbWVudERhdGVBZGFwdGVyfSxcbiAgICAgICAge3Byb3ZpZGU6IE1BVF9EQVRFX0ZPUk1BVFMsIHVzZVZhbHVlOiBNT01FTlRfREFURV9GT1JNQVRTfV0sXG4gICAgc3R5bGVVcmxzOiBbJy4vZGF0ZS1yYW5nZS53aWRnZXQuc2NzcyddLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgRGF0ZVJhbmdlV2lkZ2V0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIHB1YmxpYyBGT1JNQVRfREFURV9BQ1RJVklUSTogc3RyaW5nID0gJ1lZWVktTU0tREQnO1xuICAgIHB1YmxpYyBTSE9XX0ZPUk1BVDogc3RyaW5nID0gJ0REL01NL1lZWVknO1xuXG4gICAgQElucHV0KCdncm91cCcpXG4gICAgcHVibGljIGRhdGVSYW5nZTogRm9ybUdyb3VwO1xuXG4gICAgQElucHV0KClcbiAgICBmaWVsZDogYW55O1xuXG4gICAgQE91dHB1dCgpXG4gICAgZGF0ZVJhbmdlQ2hhbmdlZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIG1pbkRhdGU6IE1vbWVudDtcbiAgICBtYXhEYXRlOiBNb21lbnQ7XG4gICAgc3RhcnREYXRlUGlja2VyOiBNb21lbnQgPSBtb21lbnQoKTtcbiAgICBlbmREYXRlUGlja2VyOiBNb21lbnQgPSBtb21lbnQoKTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcjxNb21lbnQ+LFxuICAgICAgICBwcml2YXRlIHVzZXJQcmVmZXJlbmNlc1NlcnZpY2U6IFVzZXJQcmVmZXJlbmNlc1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy51c2VyUHJlZmVyZW5jZXNTZXJ2aWNlLnNlbGVjdChVc2VyUHJlZmVyZW5jZVZhbHVlcy5Mb2NhbGUpLnN1YnNjcmliZSgobG9jYWxlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRhdGVBZGFwdGVyLnNldExvY2FsZShsb2NhbGUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgbW9tZW50RGF0ZUFkYXB0ZXIgPSA8TW9tZW50RGF0ZUFkYXB0ZXI+IHRoaXMuZGF0ZUFkYXB0ZXI7XG4gICAgICAgIG1vbWVudERhdGVBZGFwdGVyLm92ZXJyaWRlRGlzcGxheUZvcm1hdCA9IHRoaXMuU0hPV19GT1JNQVQ7XG5cbiAgICAgICAgaWYgKHRoaXMuZmllbGQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkLnZhbHVlICYmIHRoaXMuZmllbGQudmFsdWUuc3RhcnREYXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydERhdGVQaWNrZXIgPSBtb21lbnQodGhpcy5maWVsZC52YWx1ZS5zdGFydERhdGUsIHRoaXMuRk9STUFUX0RBVEVfQUNUSVZJVEkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5maWVsZC52YWx1ZSAmJiB0aGlzLmZpZWxkLnZhbHVlLmVuZERhdGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuZERhdGVQaWNrZXIgPSBtb21lbnQodGhpcy5maWVsZC52YWx1ZS5lbmREYXRlLCB0aGlzLkZPUk1BVF9EQVRFX0FDVElWSVRJKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBzdGFydERhdGVDb250cm9sID0gbmV3IEZvcm1Db250cm9sKHRoaXMuc3RhcnREYXRlUGlja2VyKTtcbiAgICAgICAgc3RhcnREYXRlQ29udHJvbC5zZXRWYWxpZGF0b3JzKFZhbGlkYXRvcnMucmVxdWlyZWQpO1xuICAgICAgICB0aGlzLmRhdGVSYW5nZS5hZGRDb250cm9sKCdzdGFydERhdGUnLCBzdGFydERhdGVDb250cm9sKTtcblxuICAgICAgICBsZXQgZW5kRGF0ZUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2wodGhpcy5lbmREYXRlUGlja2VyKTtcbiAgICAgICAgZW5kRGF0ZUNvbnRyb2wuc2V0VmFsaWRhdG9ycyhWYWxpZGF0b3JzLnJlcXVpcmVkKTtcbiAgICAgICAgdGhpcy5kYXRlUmFuZ2UuYWRkQ29udHJvbCgnZW5kRGF0ZScsIGVuZERhdGVDb250cm9sKTtcblxuICAgICAgICB0aGlzLmRhdGVSYW5nZS5zZXRWYWxpZGF0b3JzKHRoaXMuZGF0ZUNoZWNrKTtcbiAgICAgICAgdGhpcy5kYXRlUmFuZ2UudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSgoKSA9PiB0aGlzLm9uR3JvdXBWYWx1ZUNoYW5nZWQoKSk7XG4gICAgfVxuXG4gICAgb25Hcm91cFZhbHVlQ2hhbmdlZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0ZVJhbmdlLnZhbGlkKSB7XG4gICAgICAgICAgICBsZXQgZGF0ZVN0YXJ0ID0gdGhpcy5jb252ZXJ0VG9Nb21lbnREYXRlV2l0aFRpbWUodGhpcy5kYXRlUmFuZ2UuY29udHJvbHMuc3RhcnREYXRlLnZhbHVlKTtcbiAgICAgICAgICAgIGxldCBlbmRTdGFydCA9IHRoaXMuY29udmVydFRvTW9tZW50RGF0ZVdpdGhUaW1lKHRoaXMuZGF0ZVJhbmdlLmNvbnRyb2xzLmVuZERhdGUudmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5kYXRlUmFuZ2VDaGFuZ2VkLmVtaXQoe3N0YXJ0RGF0ZTogZGF0ZVN0YXJ0LCBlbmREYXRlOiBlbmRTdGFydH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29udmVydFRvTW9tZW50RGF0ZVdpdGhUaW1lKGRhdGU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gbW9tZW50KGRhdGUsIHRoaXMuRk9STUFUX0RBVEVfQUNUSVZJVEksIHRydWUpLmZvcm1hdCh0aGlzLkZPUk1BVF9EQVRFX0FDVElWSVRJKSArICdUMDA6MDA6MDAuMDAwWic7XG4gICAgfVxuXG4gICAgZGF0ZUNoZWNrKGZvcm1Db250cm9sOiBBYnN0cmFjdENvbnRyb2wpIHtcbiAgICAgICAgbGV0IHN0YXJ0RGF0ZSA9IG1vbWVudChmb3JtQ29udHJvbC5nZXQoJ3N0YXJ0RGF0ZScpLnZhbHVlKTtcbiAgICAgICAgbGV0IGVuZERhdGUgPSBtb21lbnQoZm9ybUNvbnRyb2wuZ2V0KCdlbmREYXRlJykudmFsdWUpO1xuICAgICAgICBsZXQgaXNBZnRlckNoZWNrID0gc3RhcnREYXRlLmlzQWZ0ZXIoZW5kRGF0ZSk7XG4gICAgICAgIHJldHVybiBpc0FmdGVyQ2hlY2sgPyB7J2dyZWF0ZXJUaGFuJzogdHJ1ZX0gOiBudWxsO1xuICAgIH1cblxuICAgIGlzU3RhcnREYXRlR3JlYXRlclRoYW5FbmREYXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRlUmFuZ2UgJiYgdGhpcy5kYXRlUmFuZ2UuZXJyb3JzICYmIHRoaXMuZGF0ZVJhbmdlLmVycm9ycy5ncmVhdGVyVGhhbjtcbiAgICB9XG5cbiAgICBpc1N0YXJ0RGF0ZUVtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRlUmFuZ2UgJiYgdGhpcy5kYXRlUmFuZ2UuY29udHJvbHMuc3RhcnREYXRlICYmICF0aGlzLmRhdGVSYW5nZS5jb250cm9scy5zdGFydERhdGUudmFsaWQ7XG4gICAgfVxufVxuIl19