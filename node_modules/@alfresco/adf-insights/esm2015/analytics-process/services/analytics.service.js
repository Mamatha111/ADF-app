/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { AlfrescoApiService, LogService } from '@alfresco/adf-core';
import { Injectable } from '@angular/core';
import { Observable, from, throwError } from 'rxjs';
import { ParameterValueModel } from '../../diagram/models/report/parameterValue.model';
import { ReportParametersModel } from '../../diagram/models/report/reportParameters.model';
import { BarChart } from '../../diagram/models/chart/barChart.model';
import { DetailsTableChart } from '../../diagram/models/chart/detailsTableChart.model';
import { HeatMapChart } from '../../diagram/models/chart/heatMapChart.model';
import { MultiBarChart } from '../../diagram/models/chart/multiBarChart.model';
import { PieChart } from '../../diagram/models/chart/pieChart.model';
import { TableChart } from '../../diagram/models/chart/tableChart.model';
import { map, catchError } from 'rxjs/operators';
export class AnalyticsService {
    /**
     * @param {?} apiService
     * @param {?} logService
     */
    constructor(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
    }
    /**
     * Retrieve all the Deployed app
     * @param {?} appId
     * @return {?}
     */
    getReportList(appId) {
        return from(this.apiService.getInstance().activiti.reportApi.getReportList())
            .pipe(map((res) => {
            /** @type {?} */
            let reports = [];
            res.forEach((report) => {
                /** @type {?} */
                let reportModel = new ReportParametersModel(report);
                if (this.isReportValid(appId, report)) {
                    reports.push(reportModel);
                }
            });
            return reports;
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * Retrieve Report by name
     * @param {?} reportName - string - The name of report
     * @return {?}
     */
    getReportByName(reportName) {
        return from(this.apiService.getInstance().activiti.reportApi.getReportList())
            .pipe(map((response) => {
            return response.find((report) => report.name === reportName);
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @private
     * @param {?} appId
     * @param {?} report
     * @return {?}
     */
    isReportValid(appId, report) {
        /** @type {?} */
        let isValid = true;
        if (appId && appId !== 0 && report.name.includes('Process definition overview')) {
            isValid = false;
        }
        return isValid;
    }
    /**
     * @param {?} reportId
     * @return {?}
     */
    getReportParams(reportId) {
        return from(this.apiService.getInstance().activiti.reportApi.getReportParams(reportId))
            .pipe(map((res) => {
            return new ReportParametersModel(res);
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} type
     * @param {?} appId
     * @param {?=} reportId
     * @param {?=} processDefinitionId
     * @return {?}
     */
    getParamValuesByType(type, appId, reportId, processDefinitionId) {
        if (type === 'status') {
            return this.getProcessStatusValues();
        }
        else if (type === 'processDefinition') {
            if (appId === null || appId === undefined) {
                return this.getProcessDefinitionsValuesNoApp();
            }
            else {
                return this.getProcessDefinitionsValues(appId);
            }
        }
        else if (type === 'dateInterval') {
            return this.getDateIntervalValues();
        }
        else if (type === 'task' && reportId && processDefinitionId) {
            return this.getTasksByProcessDefinitionId(reportId, processDefinitionId);
        }
        else {
            return new Observable((observer) => {
                observer.next(null);
                observer.complete();
            });
        }
    }
    /**
     * @return {?}
     */
    getProcessStatusValues() {
        /** @type {?} */
        let paramOptions = [];
        paramOptions.push(new ParameterValueModel({ id: 'All', name: 'All' }));
        paramOptions.push(new ParameterValueModel({ id: 'Active', name: 'Active' }));
        paramOptions.push(new ParameterValueModel({ id: 'Complete', name: 'Complete' }));
        return new Observable((observer) => {
            observer.next(paramOptions);
            observer.complete();
        });
    }
    /**
     * @return {?}
     */
    getDateIntervalValues() {
        /** @type {?} */
        let paramOptions = [];
        paramOptions.push(new ParameterValueModel({ id: 'byHour', name: 'By hour' }));
        paramOptions.push(new ParameterValueModel({ id: 'byDay', name: 'By day' }));
        paramOptions.push(new ParameterValueModel({ id: 'byWeek', name: 'By week' }));
        paramOptions.push(new ParameterValueModel({ id: 'byMonth', name: 'By month' }));
        paramOptions.push(new ParameterValueModel({ id: 'byYear', name: 'By year' }));
        return new Observable((observer) => {
            observer.next(paramOptions);
            observer.complete();
        });
    }
    /**
     * @return {?}
     */
    getMetricValues() {
        /** @type {?} */
        let paramOptions = [];
        paramOptions.push(new ParameterValueModel({ id: 'totalCount', name: 'Number of times a step is executed' }));
        paramOptions.push(new ParameterValueModel({ id: 'totalTime', name: 'Total time spent in a process step' }));
        paramOptions.push(new ParameterValueModel({ id: 'avgTime', name: 'Average time spent in a process step' }));
        return new Observable((observer) => {
            observer.next(paramOptions);
            observer.complete();
        });
    }
    /**
     * @return {?}
     */
    getProcessDefinitionsValuesNoApp() {
        return from(this.apiService.getInstance().activiti.reportApi.getProcessDefinitions())
            .pipe(map((res) => {
            /** @type {?} */
            let paramOptions = [];
            res.forEach((opt) => {
                paramOptions.push(new ParameterValueModel(opt));
            });
            return paramOptions;
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} appId
     * @return {?}
     */
    getProcessDefinitionsValues(appId) {
        /** @type {?} */
        let options = { 'appDefinitionId': appId };
        return from(this.apiService.getInstance().activiti.processDefinitionsApi.getProcessDefinitions(options))
            .pipe(map((res) => {
            /** @type {?} */
            let paramOptions = [];
            res.data.forEach((opt) => {
                paramOptions.push(new ParameterValueModel(opt));
            });
            return paramOptions;
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} reportId
     * @param {?} processDefinitionId
     * @return {?}
     */
    getTasksByProcessDefinitionId(reportId, processDefinitionId) {
        return from(this.apiService.getInstance().activiti.reportApi.getTasksByProcessDefinitionId(reportId, processDefinitionId))
            .pipe(map((res) => {
            /** @type {?} */
            let paramOptions = [];
            res.forEach((opt) => {
                paramOptions.push(new ParameterValueModel({ id: opt, name: opt }));
            });
            return paramOptions;
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    getReportsByParams(reportId, paramsQuery) {
        return from(this.apiService.getInstance().activiti.reportApi.getReportsByParams(reportId, paramsQuery))
            .pipe(map((res) => {
            /** @type {?} */
            let elements = [];
            res.elements.forEach((chartData) => {
                if (chartData.type === 'pieChart') {
                    elements.push(new PieChart(chartData));
                }
                else if (chartData.type === 'table') {
                    elements.push(new TableChart(chartData));
                }
                else if (chartData.type === 'processDefinitionHeatMap') {
                    elements.push(new HeatMapChart(chartData));
                }
                else if (chartData.type === 'masterDetailTable') {
                    elements.push(new DetailsTableChart(chartData));
                }
                else if (chartData.type === 'barChart') {
                    elements.push(new BarChart(chartData));
                }
                else if (chartData.type === 'multiBarChart') {
                    elements.push(new MultiBarChart(chartData));
                }
            });
            return elements;
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @return {?}
     */
    createDefaultReports() {
        return from(this.apiService.getInstance().activiti.reportApi.createDefaultReports())
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} reportId
     * @param {?} name
     * @return {?}
     */
    updateReport(reportId, name) {
        return from(this.apiService.getInstance().activiti.reportApi.updateReport(reportId, name))
            .pipe(map(() => this.logService.info('upload')), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    exportReportToCsv(reportId, paramsQuery) {
        return from(this.apiService.getInstance().activiti.reportApi.exportToCsv(reportId, paramsQuery))
            .pipe(map((res) => {
            this.logService.info('export');
            return res;
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    saveReport(reportId, paramsQuery) {
        return from(this.apiService.getInstance().activiti.reportApi.saveReport(reportId, paramsQuery))
            .pipe(map(() => {
            this.logService.info('save');
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @param {?} reportId
     * @return {?}
     */
    deleteReport(reportId) {
        return from(this.apiService.getInstance().activiti.reportApi.deleteReport(reportId))
            .pipe(map(() => {
            this.logService.info('delete');
        }), catchError((err) => this.handleError(err)));
    }
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    handleError(error) {
        this.logService.error(error);
        return throwError(error || 'Server error');
    }
    /**
     * @param {?} res
     * @return {?}
     */
    toJson(res) {
        return res || {};
    }
}
AnalyticsService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
AnalyticsService.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: LogService }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    AnalyticsService.prototype.apiService;
    /**
     * @type {?}
     * @private
     */
    AnalyticsService.prototype.logService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWluc2lnaHRzLyIsInNvdXJjZXMiOlsiYW5hbHl0aWNzLXByb2Nlc3Mvc2VydmljZXMvYW5hbHl0aWNzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBQzNGLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUVyRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUN2RixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFDN0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQy9FLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUNyRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDekUsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUdqRCxNQUFNLE9BQU8sZ0JBQWdCOzs7OztJQUV6QixZQUFvQixVQUE4QixFQUM5QixVQUFzQjtRQUR0QixlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUM5QixlQUFVLEdBQVYsVUFBVSxDQUFZO0lBQzFDLENBQUM7Ozs7OztJQUtELGFBQWEsQ0FBQyxLQUFhO1FB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SSxjQUFjLENBQUMsQ0FBQztJQUMvQyxDQUFDOzs7OztJQUVELE1BQU0sQ0FBQyxHQUFRO1FBQ1gsT0FBTyxHQUFHLElBQUksRUFBRSxDQUFDO0lBQ3JCLENBQUM7OztZQXJQSixVQUFVOzs7O1lBZkYsa0JBQWtCO1lBQUUsVUFBVTs7Ozs7OztJQWtCdkIsc0NBQXNDOzs7OztJQUN0QyxzQ0FBOEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBbGZyZXNjb0FwaVNlcnZpY2UsIExvZ1NlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9odHRwJztcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb20sIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFBhcmFtZXRlclZhbHVlTW9kZWwgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9yZXBvcnQvcGFyYW1ldGVyVmFsdWUubW9kZWwnO1xuaW1wb3J0IHsgUmVwb3J0UGFyYW1ldGVyc01vZGVsIH0gZnJvbSAnLi4vLi4vZGlhZ3JhbS9tb2RlbHMvcmVwb3J0L3JlcG9ydFBhcmFtZXRlcnMubW9kZWwnO1xuaW1wb3J0IHsgQmFyQ2hhcnQgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9jaGFydC9iYXJDaGFydC5tb2RlbCc7XG5pbXBvcnQgeyBDaGFydCB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL2NoYXJ0L2NoYXJ0Lm1vZGVsJztcbmltcG9ydCB7IERldGFpbHNUYWJsZUNoYXJ0IH0gZnJvbSAnLi4vLi4vZGlhZ3JhbS9tb2RlbHMvY2hhcnQvZGV0YWlsc1RhYmxlQ2hhcnQubW9kZWwnO1xuaW1wb3J0IHsgSGVhdE1hcENoYXJ0IH0gZnJvbSAnLi4vLi4vZGlhZ3JhbS9tb2RlbHMvY2hhcnQvaGVhdE1hcENoYXJ0Lm1vZGVsJztcbmltcG9ydCB7IE11bHRpQmFyQ2hhcnQgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9jaGFydC9tdWx0aUJhckNoYXJ0Lm1vZGVsJztcbmltcG9ydCB7IFBpZUNoYXJ0IH0gZnJvbSAnLi4vLi4vZGlhZ3JhbS9tb2RlbHMvY2hhcnQvcGllQ2hhcnQubW9kZWwnO1xuaW1wb3J0IHsgVGFibGVDaGFydCB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL2NoYXJ0L3RhYmxlQ2hhcnQubW9kZWwnO1xuaW1wb3J0IHsgbWFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQW5hbHl0aWNzU2VydmljZSB7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBhbGwgdGhlIERlcGxveWVkIGFwcFxuICAgICAqL1xuICAgIGdldFJlcG9ydExpc3QoYXBwSWQ6IG51bWJlcik6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdGl2aXRpLnJlcG9ydEFwaS5nZXRSZXBvcnRMaXN0KCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZXBvcnRzOiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWxbXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgocmVwb3J0OiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXBvcnRNb2RlbCA9IG5ldyBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwocmVwb3J0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUmVwb3J0VmFsaWQoYXBwSWQsIHJlcG9ydCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRzLnB1c2gocmVwb3J0TW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcG9ydHM7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIFJlcG9ydCBieSBuYW1lXG4gICAgICogQHBhcmFtIHJlcG9ydE5hbWUgLSBzdHJpbmcgLSBUaGUgbmFtZSBvZiByZXBvcnRcbiAgICAgKi9cbiAgICBnZXRSZXBvcnRCeU5hbWUocmVwb3J0TmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLmdldFJlcG9ydExpc3QoKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZmluZCgocmVwb3J0KSA9PiByZXBvcnQubmFtZSA9PT0gcmVwb3J0TmFtZSk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNSZXBvcnRWYWxpZChhcHBJZDogbnVtYmVyLCByZXBvcnQ6IFJlcG9ydFBhcmFtZXRlcnNNb2RlbCkge1xuICAgICAgICBsZXQgaXNWYWxpZDogYm9vbGVhbiA9IHRydWU7XG4gICAgICAgIGlmIChhcHBJZCAmJiBhcHBJZCAhPT0gMCAmJiByZXBvcnQubmFtZS5pbmNsdWRlcygnUHJvY2VzcyBkZWZpbml0aW9uIG92ZXJ2aWV3JykpIHtcbiAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNWYWxpZDtcbiAgICB9XG5cbiAgICBnZXRSZXBvcnRQYXJhbXMocmVwb3J0SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdGl2aXRpLnJlcG9ydEFwaS5nZXRSZXBvcnRQYXJhbXMocmVwb3J0SWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlcG9ydFBhcmFtZXRlcnNNb2RlbChyZXMpO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQYXJhbVZhbHVlc0J5VHlwZSh0eXBlOiBzdHJpbmcsIGFwcElkOiBudW1iZXIsIHJlcG9ydElkPzogc3RyaW5nLCBwcm9jZXNzRGVmaW5pdGlvbklkPzogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0eXBlID09PSAnc3RhdHVzJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvY2Vzc1N0YXR1c1ZhbHVlcygpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdwcm9jZXNzRGVmaW5pdGlvbicpIHtcbiAgICAgICAgICAgIGlmIChhcHBJZCA9PT0gbnVsbCB8fCBhcHBJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb25zVmFsdWVzTm9BcHAoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb25zVmFsdWVzKGFwcElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnZGF0ZUludGVydmFsJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0ZUludGVydmFsVmFsdWVzKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3Rhc2snICYmIHJlcG9ydElkICYmIHByb2Nlc3NEZWZpbml0aW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRhc2tzQnlQcm9jZXNzRGVmaW5pdGlvbklkKHJlcG9ydElkLCBwcm9jZXNzRGVmaW5pdGlvbklkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgob2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KG51bGwpO1xuICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFByb2Nlc3NTdGF0dXNWYWx1ZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgbGV0IHBhcmFtT3B0aW9uczogUGFyYW1ldGVyVmFsdWVNb2RlbFtdID0gW107XG5cbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ0FsbCcsIG5hbWU6ICdBbGwnIH0pKTtcbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ0FjdGl2ZScsIG5hbWU6ICdBY3RpdmUnIH0pKTtcbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ0NvbXBsZXRlJywgbmFtZTogJ0NvbXBsZXRlJyB9KSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcikgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChwYXJhbU9wdGlvbnMpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0RGF0ZUludGVydmFsVmFsdWVzKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGxldCBwYXJhbU9wdGlvbnM6IFBhcmFtZXRlclZhbHVlTW9kZWxbXSA9IFtdO1xuXG4gICAgICAgIHBhcmFtT3B0aW9ucy5wdXNoKG5ldyBQYXJhbWV0ZXJWYWx1ZU1vZGVsKHsgaWQ6ICdieUhvdXInLCBuYW1lOiAnQnkgaG91cicgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnYnlEYXknLCBuYW1lOiAnQnkgZGF5JyB9KSk7XG4gICAgICAgIHBhcmFtT3B0aW9ucy5wdXNoKG5ldyBQYXJhbWV0ZXJWYWx1ZU1vZGVsKHsgaWQ6ICdieVdlZWsnLCBuYW1lOiAnQnkgd2VlaycgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnYnlNb250aCcsIG5hbWU6ICdCeSBtb250aCcgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnYnlZZWFyJywgbmFtZTogJ0J5IHllYXInIH0pKTtcblxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyKSA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KHBhcmFtT3B0aW9ucyk7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRNZXRyaWNWYWx1ZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgbGV0IHBhcmFtT3B0aW9uczogUGFyYW1ldGVyVmFsdWVNb2RlbFtdID0gW107XG5cbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ3RvdGFsQ291bnQnLCBuYW1lOiAnTnVtYmVyIG9mIHRpbWVzIGEgc3RlcCBpcyBleGVjdXRlZCcgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAndG90YWxUaW1lJywgbmFtZTogJ1RvdGFsIHRpbWUgc3BlbnQgaW4gYSBwcm9jZXNzIHN0ZXAnIH0pKTtcbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ2F2Z1RpbWUnLCBuYW1lOiAnQXZlcmFnZSB0aW1lIHNwZW50IGluIGEgcHJvY2VzcyBzdGVwJyB9KSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcikgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChwYXJhbU9wdGlvbnMpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0UHJvY2Vzc0RlZmluaXRpb25zVmFsdWVzTm9BcHAoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLmdldFByb2Nlc3NEZWZpbml0aW9ucygpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGFyYW1PcHRpb25zOiBQYXJhbWV0ZXJWYWx1ZU1vZGVsW10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKG9wdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwob3B0KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1PcHRpb25zO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQcm9jZXNzRGVmaW5pdGlvbnNWYWx1ZXMoYXBwSWQ6IG51bWJlcik6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGxldCBvcHRpb25zID0geyAnYXBwRGVmaW5pdGlvbklkJzogYXBwSWQgfTtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucHJvY2Vzc0RlZmluaXRpb25zQXBpLmdldFByb2Nlc3NEZWZpbml0aW9ucyhvcHRpb25zKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmFtT3B0aW9uczogUGFyYW1ldGVyVmFsdWVNb2RlbFtdID0gW107XG4gICAgICAgICAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goKG9wdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwob3B0KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1PcHRpb25zO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRUYXNrc0J5UHJvY2Vzc0RlZmluaXRpb25JZChyZXBvcnRJZDogc3RyaW5nLCBwcm9jZXNzRGVmaW5pdGlvbklkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkuZ2V0VGFza3NCeVByb2Nlc3NEZWZpbml0aW9uSWQocmVwb3J0SWQsIHByb2Nlc3NEZWZpbml0aW9uSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGFyYW1PcHRpb25zOiBQYXJhbWV0ZXJWYWx1ZU1vZGVsW10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKG9wdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogb3B0LCBuYW1lOiBvcHQgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtT3B0aW9ucztcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgZ2V0UmVwb3J0c0J5UGFyYW1zKHJlcG9ydElkOiBudW1iZXIsIHBhcmFtc1F1ZXJ5OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkuZ2V0UmVwb3J0c0J5UGFyYW1zKHJlcG9ydElkLCBwYXJhbXNRdWVyeSkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBlbGVtZW50czogQ2hhcnRbXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICByZXMuZWxlbWVudHMuZm9yRWFjaCgoY2hhcnREYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhcnREYXRhLnR5cGUgPT09ICdwaWVDaGFydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKG5ldyBQaWVDaGFydChjaGFydERhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhcnREYXRhLnR5cGUgPT09ICd0YWJsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKG5ldyBUYWJsZUNoYXJ0KGNoYXJ0RGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFydERhdGEudHlwZSA9PT0gJ3Byb2Nlc3NEZWZpbml0aW9uSGVhdE1hcCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKG5ldyBIZWF0TWFwQ2hhcnQoY2hhcnREYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXJ0RGF0YS50eXBlID09PSAnbWFzdGVyRGV0YWlsVGFibGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChuZXcgRGV0YWlsc1RhYmxlQ2hhcnQoY2hhcnREYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXJ0RGF0YS50eXBlID09PSAnYmFyQ2hhcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChuZXcgQmFyQ2hhcnQoY2hhcnREYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXJ0RGF0YS50eXBlID09PSAnbXVsdGlCYXJDaGFydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKG5ldyBNdWx0aUJhckNoYXJ0KGNoYXJ0RGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudHM7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIGNyZWF0ZURlZmF1bHRSZXBvcnRzKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdGl2aXRpLnJlcG9ydEFwaS5jcmVhdGVEZWZhdWx0UmVwb3J0cygpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMudG9Kc29uKSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgdXBkYXRlUmVwb3J0KHJlcG9ydElkOiBudW1iZXIsIG5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdGl2aXRpLnJlcG9ydEFwaS51cGRhdGVSZXBvcnQocmVwb3J0SWQsIG5hbWUpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKCgpID0+IHRoaXMubG9nU2VydmljZS5pbmZvKCd1cGxvYWQnKSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIGV4cG9ydFJlcG9ydFRvQ3N2KHJlcG9ydElkOiBzdHJpbmcsIHBhcmFtc1F1ZXJ5OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkuZXhwb3J0VG9Dc3YocmVwb3J0SWQsIHBhcmFtc1F1ZXJ5KSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmluZm8oJ2V4cG9ydCcpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBzYXZlUmVwb3J0KHJlcG9ydElkOiBzdHJpbmcsIHBhcmFtc1F1ZXJ5OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkuc2F2ZVJlcG9ydChyZXBvcnRJZCwgcGFyYW1zUXVlcnkpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmluZm8oJ3NhdmUnKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgZGVsZXRlUmVwb3J0KHJlcG9ydElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkuZGVsZXRlUmVwb3J0KHJlcG9ydElkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5pbmZvKCdkZWxldGUnKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVFcnJvcihlcnJvcjogUmVzcG9uc2UpIHtcbiAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoZXJyb3IgfHwgJ1NlcnZlciBlcnJvcicpO1xuICAgIH1cblxuICAgIHRvSnNvbihyZXM6IGFueSkge1xuICAgICAgICByZXR1cm4gcmVzIHx8IHt9O1xuICAgIH1cbn1cbiJdfQ==