/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ViewEncapsulation } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { AuthenticationService } from '../services/authentication.service';
import { DiscoveryApiService } from '../services/discovery-api.service';
import { ObjectDataTableAdapter } from '../datatable/data/object-datatable-adapter';
import { AppConfigService, AppConfigValues } from '../app-config/app-config.service';
export class AboutComponent {
    /**
     * @param {?} http
     * @param {?} appConfig
     * @param {?} authService
     * @param {?} discovery
     */
    constructor(http, appConfig, authService, discovery) {
        this.http = http;
        this.appConfig = appConfig;
        this.authService = authService;
        this.discovery = discovery;
        this.githubUrlCommitAlpha = 'https://github.com/Alfresco/alfresco-ng2-components/commits/';
        this.ecmHost = '';
        this.bpmHost = '';
        this.ecmVersion = null;
        this.bpmVersion = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.authService.isEcmLoggedIn()) {
            this.discovery.getEcmProductInfo().subscribe((ecmVers) => {
                this.ecmVersion = ecmVers;
                this.modules = new ObjectDataTableAdapter(this.ecmVersion.modules, [
                    { type: 'text', key: 'id', title: 'ABOUT.TABLE_HEADERS.MODULES.ID', sortable: true },
                    { type: 'text', key: 'title', title: 'ABOUT.TABLE_HEADERS.MODULES.TITLE', sortable: true },
                    { type: 'text', key: 'version', title: 'ABOUT.TABLE_HEADERS.MODULES.DESCRIPTION', sortable: true },
                    { type: 'text', key: 'installDate', title: 'ABOUT.TABLE_HEADERS.MODULES.INSTALL_DATE', sortable: true },
                    { type: 'text', key: 'installState', title: 'ABOUT.TABLE_HEADERS.MODULES.INSTALL_STATE', sortable: true },
                    { type: 'text', key: 'versionMin', title: 'ABOUT.TABLE_HEADERS.MODULES.VERSION_MIN', sortable: true },
                    { type: 'text', key: 'versionMax', title: 'ABOUT.TABLE_HEADERS.MODULES.VERSION_MAX', sortable: true }
                ]);
                this.status = new ObjectDataTableAdapter([this.ecmVersion.status], [
                    { type: 'text', key: 'isReadOnly', title: 'ABOUT.TABLE_HEADERS.STATUS.READ_ONLY', sortable: true },
                    { type: 'text', key: 'isAuditEnabled', title: 'ABOUT.TABLE_HEADERS.STATUS.AUDIT_ENABLED', sortable: true },
                    { type: 'text', key: 'isQuickShareEnabled', title: 'ABOUT.TABLE_HEADERS.STATUS.QUICK_SHARE_ENABLED', sortable: true },
                    { type: 'text', key: 'isThumbnailGenerationEnabled', title: 'ABOUT.TABLE_HEADERS.STATUS.THUMBNAIL_ENABLED', sortable: true }
                ]);
                this.license = new ObjectDataTableAdapter([this.ecmVersion.license], [
                    { type: 'text', key: 'issuedAt', title: 'ABOUT.TABLE_HEADERS.LICENSE.ISSUES_AT', sortable: true },
                    { type: 'text', key: 'expiresAt', title: 'ABOUT.TABLE_HEADERS.LICENSE.EXPIRES_AT', sortable: true },
                    { type: 'text', key: 'remainingDays', title: 'ABOUT.TABLE_HEADERS.LICENSE.REMAINING_DAYS', sortable: true },
                    { type: 'text', key: 'holder', title: 'ABOUT.TABLE_HEADERS.LICENSE.HOLDER', sortable: true },
                    { type: 'text', key: 'mode', title: 'ABOUT.TABLE_HEADERS.LICENSE.MODE', sortable: true },
                    { type: 'text', key: 'isClusterEnabled', title: 'ABOUT.TABLE_HEADERS.LICENSE.CLUSTER_ENABLED', sortable: true },
                    { type: 'text', key: 'isCryptodocEnabled', title: 'ABOUT.TABLE_HEADERS.LICENSE.CRYPTODOC_ENABLED', sortable: true }
                ]);
            });
        }
        if (this.authService.isBpmLoggedIn()) {
            this.discovery.getBpmProductInfo().subscribe((bpmVers) => {
                this.bpmVersion = bpmVers;
            });
        }
        this.http.get('/versions.json?' + new Date()).subscribe((response) => {
            /** @type {?} */
            const regexp = new RegExp('^(@alfresco)');
            /** @type {?} */
            const alfrescoPackages = Object.keys(response.dependencies).filter((val) => {
                return regexp.test(val);
            });
            /** @type {?} */
            const alfrescoPackagesTableRepresentation = [];
            alfrescoPackages.forEach((val) => {
                alfrescoPackagesTableRepresentation.push({
                    name: val,
                    version: response.dependencies[val].version
                });
            });
            this.gitHubLinkCreation(alfrescoPackagesTableRepresentation);
            this.data = new ObjectDataTableAdapter(alfrescoPackagesTableRepresentation, [
                { type: 'text', key: 'name', title: 'Name', sortable: true },
                { type: 'text', key: 'version', title: 'Version', sortable: true }
            ]);
        });
        this.ecmHost = this.appConfig.get(AppConfigValues.ECMHOST);
        this.bpmHost = this.appConfig.get(AppConfigValues.BPMHOST);
    }
    /**
     * @private
     * @param {?} alfrescoPackagesTableRepresentation
     * @return {?}
     */
    gitHubLinkCreation(alfrescoPackagesTableRepresentation) {
        /** @type {?} */
        const corePackage = alfrescoPackagesTableRepresentation.find((packageUp) => {
            return packageUp.name === '@alfresco/adf-core';
        });
        if (corePackage) {
            /** @type {?} */
            const commitIsh = corePackage.version.split('-');
            if (commitIsh.length > 1) {
                this.githubUrlCommitAlpha = this.githubUrlCommitAlpha + commitIsh[1];
            }
            else {
                this.githubUrlCommitAlpha = this.githubUrlCommitAlpha + corePackage.version;
            }
        }
    }
}
AboutComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-about',
                template: "<div class=\"adf-about-container\">\n    <h3>{{ 'ABOUT.SERVER_SETTINGS.TITLE' | translate }}</h3>\n    <mat-list>\n        <small>{{ 'ABOUT.SERVER_SETTINGS.DESCRIPTION' | translate }}</small>\n        <mat-list-item>\n            <h4 matLine> {{ 'ABOUT.SERVER_SETTINGS.PROCESS_SERVICE_HOST' | translate: { value: bpmHost } }}</h4>\n        </mat-list-item>\n        <mat-divider></mat-divider>\n        <mat-list-item>\n            <h4 matLine>{{ 'ABOUT.SERVER_SETTINGS.PROCESS_SERVICE_HOST' | translate: { value: ecmHost } }}</h4>\n        </mat-list-item>\n    </mat-list>\n\n    <h3>{{ 'ABOUT.VERSIONS.TITLE' | translate }}</h3>\n    <div *ngIf=\"bpmVersion\">\n        <h3>{{ 'ABOUT.VERSIONS.PROCESS_SERVICE' | translate }}</h3>\n        <label> {{ 'ABOUT.VERSIONS.LABELS.EDITION' | translate }} </label> {{ bpmVersion.edition }}\n        <p></p>\n        <label> {{ 'ABOUT.VERSIONS.LABELS.VERSION' | translate }} </label> {{ bpmVersion.majorVersion }}.{{ bpmVersion.minorVersion }}.{{ bpmVersion.revisionVersion }}\n    </div>\n    <div *ngIf=\"ecmVersion\">\n        <h3>{{ 'ABOUT.VERSIONS.CONTENT_SERVICE' | translate }}</h3>\n        <label>{{ 'ABOUT.VERSIONS.LABELS.EDITION' | translate }}</label> {{ ecmVersion.edition }}\n        <p></p>\n        <label> {{ 'ABOUT.VERSIONS.LABELS.VERSION' | translate }} </label> {{ ecmVersion.version.display }}\n        <p></p>\n        <h4>{{ 'ABOUT.VERSIONS.LABELS.LICENSE' | translate }}</h4>\n        <adf-datatable [data]=\"license\"></adf-datatable>\n\n        <h4> {{ 'ABOUT.VERSIONS.LABELS.STATUS' | translate }}</h4>\n        <adf-datatable [data]=\"status\"></adf-datatable>\n\n        <h4>{{ 'ABOUT.VERSIONS.LABELS.MODULES' | translate }}</h4>\n\n        <adf-datatable [data]=\"modules\"></adf-datatable>\n    </div>\n\n    <div *ngIf=\"githubUrlCommitAlpha\">\n        <h3>{{ 'ABOUT.SOURCE_CODE.TITLE' | translate }}</h3>\n        <small>{{ 'ABOUT.SOURCE_CODE.DESCRIPTION' | translate }}</small>\n        <div>\n            <a [href]=\"githubUrlCommitAlpha\">{{githubUrlCommitAlpha}}</a>\n        </div>\n    </div>\n\n    <h3>{{ 'ABOUT.PACKAGES.TITLE' | translate }}</h3>\n    <small>{{ 'ABOUT.PACKAGES.DESCRIPTION' | translate }}</small>\n    <adf-datatable [data]=\"data\"></adf-datatable>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-about-container{padding:10px}.adf-table-version{width:60%;border:0;border-spacing:0;text-align:center}"]
            }] }
];
/** @nocollapse */
AboutComponent.ctorParameters = () => [
    { type: HttpClient },
    { type: AppConfigService },
    { type: AuthenticationService },
    { type: DiscoveryApiService }
];
if (false) {
    /** @type {?} */
    AboutComponent.prototype.data;
    /** @type {?} */
    AboutComponent.prototype.status;
    /** @type {?} */
    AboutComponent.prototype.license;
    /** @type {?} */
    AboutComponent.prototype.modules;
    /** @type {?} */
    AboutComponent.prototype.githubUrlCommitAlpha;
    /** @type {?} */
    AboutComponent.prototype.ecmHost;
    /** @type {?} */
    AboutComponent.prototype.bpmHost;
    /** @type {?} */
    AboutComponent.prototype.ecmVersion;
    /** @type {?} */
    AboutComponent.prototype.bpmVersion;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.appConfig;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.authService;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.discovery;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJvdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFsZnJlc2NvL2FkZi1jb3JlLyIsInNvdXJjZXMiOlsiYWJvdXQvYWJvdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFBRSxTQUFTLEVBQVUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBRTNFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQVFyRixNQUFNLE9BQU8sY0FBYzs7Ozs7OztJQWN2QixZQUFvQixJQUFnQixFQUNoQixTQUEyQixFQUMzQixXQUFrQyxFQUNsQyxTQUE4QjtRQUg5QixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQzNCLGdCQUFXLEdBQVgsV0FBVyxDQUF1QjtRQUNsQyxjQUFTLEdBQVQsU0FBUyxDQUFxQjtRQVhsRCx5QkFBb0IsR0FBRyw4REFBOEQsQ0FBQztRQUV0RixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUViLGVBQVUsR0FBMkIsSUFBSSxDQUFDO1FBQzFDLGVBQVUsR0FBMkIsSUFBSSxDQUFDO0lBTTFDLENBQUM7Ozs7SUFFRCxRQUFRO1FBRUosSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ2xDLElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxP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O2FBQ3hFO2lCQUFNO2dCQUNILElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsb0JBQW9CLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQzthQUMvRTtTQUNKO0lBQ0wsQ0FBQzs7O1lBNUdKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsV0FBVztnQkFDckIsa3VFQUFxQztnQkFFckMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7O2FBQ3hDOzs7O1lBWlEsVUFBVTtZQUtWLGdCQUFnQjtZQUpoQixxQkFBcUI7WUFFckIsbUJBQW1COzs7O0lBWXhCLDhCQUE2Qjs7SUFDN0IsZ0NBQStCOztJQUMvQixpQ0FBZ0M7O0lBQ2hDLGlDQUFnQzs7SUFDaEMsOENBQXNGOztJQUV0RixpQ0FBYTs7SUFDYixpQ0FBYTs7SUFFYixvQ0FBMEM7O0lBQzFDLG9DQUEwQzs7Ozs7SUFFOUIsOEJBQXdCOzs7OztJQUN4QixtQ0FBbUM7Ozs7O0lBQ25DLHFDQUEwQzs7Ozs7SUFDMUMsbUNBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQXV0aGVudGljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBCcG1Qcm9kdWN0VmVyc2lvbk1vZGVsLCBFY21Qcm9kdWN0VmVyc2lvbk1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2R1Y3QtdmVyc2lvbi5tb2RlbCc7XG5pbXBvcnQgeyBEaXNjb3ZlcnlBcGlTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvZGlzY292ZXJ5LWFwaS5zZXJ2aWNlJztcbmltcG9ydCB7IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIgfSBmcm9tICcuLi9kYXRhdGFibGUvZGF0YS9vYmplY3QtZGF0YXRhYmxlLWFkYXB0ZXInO1xuaW1wb3J0IHsgQXBwQ29uZmlnU2VydmljZSwgQXBwQ29uZmlnVmFsdWVzIH0gZnJvbSAnLi4vYXBwLWNvbmZpZy9hcHAtY29uZmlnLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1hYm91dCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2Fib3V0LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9hYm91dC5jb21wb25lbnQuc2NzcyddLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgQWJvdXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgZGF0YTogT2JqZWN0RGF0YVRhYmxlQWRhcHRlcjtcbiAgICBzdGF0dXM6IE9iamVjdERhdGFUYWJsZUFkYXB0ZXI7XG4gICAgbGljZW5zZTogT2JqZWN0RGF0YVRhYmxlQWRhcHRlcjtcbiAgICBtb2R1bGVzOiBPYmplY3REYXRhVGFibGVBZGFwdGVyO1xuICAgIGdpdGh1YlVybENvbW1pdEFscGhhID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9jb21taXRzLyc7XG5cbiAgICBlY21Ib3N0ID0gJyc7XG4gICAgYnBtSG9zdCA9ICcnO1xuXG4gICAgZWNtVmVyc2lvbjogRWNtUHJvZHVjdFZlcnNpb25Nb2RlbCA9IG51bGw7XG4gICAgYnBtVmVyc2lvbjogQnBtUHJvZHVjdFZlcnNpb25Nb2RlbCA9IG51bGw7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aGVudGljYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZGlzY292ZXJ5OiBEaXNjb3ZlcnlBcGlTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG5cbiAgICAgICAgaWYgKHRoaXMuYXV0aFNlcnZpY2UuaXNFY21Mb2dnZWRJbigpKSB7XG4gICAgICAgICAgICB0aGlzLmRpc2NvdmVyeS5nZXRFY21Qcm9kdWN0SW5mbygpLnN1YnNjcmliZSgoZWNtVmVycykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZWNtVmVyc2lvbiA9IGVjbVZlcnM7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm1vZHVsZXMgPSBuZXcgT2JqZWN0RGF0YVRhYmxlQWRhcHRlcih0aGlzLmVjbVZlcnNpb24ubW9kdWxlcywgW1xuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaWQnLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTU9EVUxFUy5JRCcsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICd0aXRsZScsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5NT0RVTEVTLlRJVExFJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ3ZlcnNpb24nLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTU9EVUxFUy5ERVNDUklQVElPTicsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpbnN0YWxsRGF0ZScsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5NT0RVTEVTLklOU1RBTExfREFURScsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpbnN0YWxsU3RhdGUnLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTU9EVUxFUy5JTlNUQUxMX1NUQVRFJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ3ZlcnNpb25NaW4nLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTU9EVUxFUy5WRVJTSU9OX01JTicsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICd2ZXJzaW9uTWF4JywgdGl0bGU6ICdBQk9VVC5UQUJMRV9IRUFERVJTLk1PRFVMRVMuVkVSU0lPTl9NQVgnLCBzb3J0YWJsZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgXSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IG5ldyBPYmplY3REYXRhVGFibGVBZGFwdGVyKFt0aGlzLmVjbVZlcnNpb24uc3RhdHVzXSwgW1xuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaXNSZWFkT25seScsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5TVEFUVVMuUkVBRF9PTkxZJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ2lzQXVkaXRFbmFibGVkJywgdGl0bGU6ICdBQk9VVC5UQUJMRV9IRUFERVJTLlNUQVRVUy5BVURJVF9FTkFCTEVEJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ2lzUXVpY2tTaGFyZUVuYWJsZWQnLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuU1RBVFVTLlFVSUNLX1NIQVJFX0VOQUJMRUQnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaXNUaHVtYm5haWxHZW5lcmF0aW9uRW5hYmxlZCcsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5TVEFUVVMuVEhVTUJOQUlMX0VOQUJMRUQnLCBzb3J0YWJsZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgXSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmxpY2Vuc2UgPSBuZXcgT2JqZWN0RGF0YVRhYmxlQWRhcHRlcihbdGhpcy5lY21WZXJzaW9uLmxpY2Vuc2VdLCBbXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpc3N1ZWRBdCcsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5MSUNFTlNFLklTU1VFU19BVCcsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdleHBpcmVzQXQnLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTElDRU5TRS5FWFBJUkVTX0FUJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ3JlbWFpbmluZ0RheXMnLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTElDRU5TRS5SRU1BSU5JTkdfREFZUycsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdob2xkZXInLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTElDRU5TRS5IT0xERVInLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnbW9kZScsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5MSUNFTlNFLk1PREUnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaXNDbHVzdGVyRW5hYmxlZCcsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5MSUNFTlNFLkNMVVNURVJfRU5BQkxFRCcsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpc0NyeXB0b2RvY0VuYWJsZWQnLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTElDRU5TRS5DUllQVE9ET0NfRU5BQkxFRCcsIHNvcnRhYmxlOiB0cnVlIH1cbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYXV0aFNlcnZpY2UuaXNCcG1Mb2dnZWRJbigpKSB7XG4gICAgICAgICAgICB0aGlzLmRpc2NvdmVyeS5nZXRCcG1Qcm9kdWN0SW5mbygpLnN1YnNjcmliZSgoYnBtVmVycykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYnBtVmVyc2lvbiA9IGJwbVZlcnM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaHR0cC5nZXQoJy92ZXJzaW9ucy5qc29uPycgKyBuZXcgRGF0ZSgpKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2V4cCA9IG5ldyBSZWdFeHAoJ14oQGFsZnJlc2NvKScpO1xuXG4gICAgICAgICAgICBjb25zdCBhbGZyZXNjb1BhY2thZ2VzID0gT2JqZWN0LmtleXMocmVzcG9uc2UuZGVwZW5kZW5jaWVzKS5maWx0ZXIoKHZhbCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWdleHAudGVzdCh2YWwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGFsZnJlc2NvUGFja2FnZXNUYWJsZVJlcHJlc2VudGF0aW9uID0gW107XG4gICAgICAgICAgICBhbGZyZXNjb1BhY2thZ2VzLmZvckVhY2goKHZhbCkgPT4ge1xuICAgICAgICAgICAgICAgIGFsZnJlc2NvUGFja2FnZXNUYWJsZVJlcHJlc2VudGF0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWwsXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb246IHJlc3BvbnNlLmRlcGVuZGVuY2llc1t2YWxdLnZlcnNpb25cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmdpdEh1YkxpbmtDcmVhdGlvbihhbGZyZXNjb1BhY2thZ2VzVGFibGVSZXByZXNlbnRhdGlvbik7XG5cbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IG5ldyBPYmplY3REYXRhVGFibGVBZGFwdGVyKGFsZnJlc2NvUGFja2FnZXNUYWJsZVJlcHJlc2VudGF0aW9uLCBbXG4gICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ25hbWUnLCB0aXRsZTogJ05hbWUnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICd2ZXJzaW9uJywgdGl0bGU6ICdWZXJzaW9uJywgc29ydGFibGU6IHRydWUgfVxuICAgICAgICAgICAgXSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5lY21Ib3N0ID0gdGhpcy5hcHBDb25maWcuZ2V0PHN0cmluZz4oQXBwQ29uZmlnVmFsdWVzLkVDTUhPU1QpO1xuICAgICAgICB0aGlzLmJwbUhvc3QgPSB0aGlzLmFwcENvbmZpZy5nZXQ8c3RyaW5nPihBcHBDb25maWdWYWx1ZXMuQlBNSE9TVCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnaXRIdWJMaW5rQ3JlYXRpb24oYWxmcmVzY29QYWNrYWdlc1RhYmxlUmVwcmVzZW50YXRpb24pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29yZVBhY2thZ2UgPSBhbGZyZXNjb1BhY2thZ2VzVGFibGVSZXByZXNlbnRhdGlvbi5maW5kKChwYWNrYWdlVXApID0+IHtcbiAgICAgICAgICAgIHJldHVybiBwYWNrYWdlVXAubmFtZSA9PT0gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChjb3JlUGFja2FnZSkge1xuICAgICAgICAgICAgY29uc3QgY29tbWl0SXNoID0gY29yZVBhY2thZ2UudmVyc2lvbi5zcGxpdCgnLScpO1xuICAgICAgICAgICAgaWYgKGNvbW1pdElzaC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5naXRodWJVcmxDb21taXRBbHBoYSA9IHRoaXMuZ2l0aHViVXJsQ29tbWl0QWxwaGEgKyBjb21taXRJc2hbMV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2l0aHViVXJsQ29tbWl0QWxwaGEgPSB0aGlzLmdpdGh1YlVybENvbW1pdEFscGhhICsgY29yZVBhY2thZ2UudmVyc2lvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==