/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, ViewEncapsulation, ChangeDetectorRef, HostBinding } from '@angular/core';
import { Pagination } from '@alfresco/js-api';
import { PaginationModel } from '../models/pagination.model';
import { UserPreferencesService, UserPreferenceValues } from '../services/user-preferences.service';
var PaginationComponent = /** @class */ (function () {
    function PaginationComponent(cdr, userPreferencesService) {
        var _this = this;
        this.cdr = cdr;
        this.userPreferencesService = userPreferencesService;
        /**
         * Pagination object.
         */
        this.pagination = PaginationComponent.DEFAULT_PAGINATION;
        /**
         * Emitted when pagination changes in any way.
         */
        this.change = new EventEmitter();
        /**
         * Emitted when the page number changes.
         */
        this.changePageNumber = new EventEmitter();
        /**
         * Emitted when the page size changes.
         */
        this.changePageSize = new EventEmitter();
        /**
         * Emitted when the next page is requested.
         */
        this.nextPage = new EventEmitter();
        /**
         * Emitted when the previous page is requested.
         */
        this.prevPage = new EventEmitter();
        this.userPreferencesService.select(UserPreferenceValues.PaginationSize).subscribe(function (pagSize) {
            _this.pagination.maxItems = pagSize;
        });
    }
    /**
     * @return {?}
     */
    PaginationComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.supportedPageSizes) {
            this.supportedPageSizes = this.userPreferencesService.supportedPageSizes;
        }
        if (this.target) {
            this.paginationSubscription = this.target.pagination.subscribe(function (pagination) {
                if (pagination.count === 0 && !_this.isFirstPage) {
                    _this.goPrevious();
                }
                _this.pagination = pagination;
                _this.cdr.detectChanges();
            });
        }
        if (!this.pagination) {
            this.pagination = PaginationComponent.DEFAULT_PAGINATION;
        }
    };
    Object.defineProperty(PaginationComponent.prototype, "lastPage", {
        get: /**
         * @return {?}
         */
        function () {
            var _a = this.pagination, maxItems = _a.maxItems, totalItems = _a.totalItems;
            return (totalItems && maxItems)
                ? Math.ceil(totalItems / maxItems)
                : 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "current", {
        get: /**
         * @return {?}
         */
        function () {
            var _a = this.pagination, maxItems = _a.maxItems, skipCount = _a.skipCount;
            return (skipCount && maxItems)
                ? Math.floor(skipCount / maxItems) + 1
                : 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "isLastPage", {
        get: /**
         * @return {?}
         */
        function () {
            return this.current === this.lastPage;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "isFirstPage", {
        get: /**
         * @return {?}
         */
        function () {
            return this.current === 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "next", {
        get: /**
         * @return {?}
         */
        function () {
            return this.isLastPage ? this.current : this.current + 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "previous", {
        get: /**
         * @return {?}
         */
        function () {
            return this.isFirstPage ? 1 : this.current - 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "hasItems", {
        get: /**
         * @return {?}
         */
        function () {
            return this.pagination && this.pagination.count > 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "isEmpty", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.hasItems;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "range", {
        get: /**
         * @return {?}
         */
        function () {
            var _a = this.pagination, skipCount = _a.skipCount, maxItems = _a.maxItems, totalItems = _a.totalItems;
            var isLastPage = this.isLastPage;
            /** @type {?} */
            var start = totalItems ? skipCount + 1 : 0;
            /** @type {?} */
            var end = isLastPage ? totalItems : skipCount + maxItems;
            return [start, end];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationComponent.prototype, "pages", {
        get: /**
         * @return {?}
         */
        function () {
            return Array(this.lastPage)
                .fill('n')
                .map(function (item, index) { return (index + 1); });
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PaginationComponent.prototype.goNext = /**
     * @return {?}
     */
    function () {
        if (this.hasItems) {
            /** @type {?} */
            var maxItems = this.pagination.maxItems;
            /** @type {?} */
            var skipCount = (this.next - 1) * maxItems;
            this.pagination.skipCount = skipCount;
            this.handlePaginationEvent(PaginationComponent.ACTIONS.NEXT_PAGE, {
                skipCount: skipCount,
                maxItems: maxItems
            });
        }
    };
    /**
     * @return {?}
     */
    PaginationComponent.prototype.goPrevious = /**
     * @return {?}
     */
    function () {
        if (this.hasItems) {
            /** @type {?} */
            var maxItems = this.pagination.maxItems;
            /** @type {?} */
            var skipCount = (this.previous - 1) * maxItems;
            this.pagination.skipCount = skipCount;
            this.handlePaginationEvent(PaginationComponent.ACTIONS.PREV_PAGE, {
                skipCount: skipCount,
                maxItems: maxItems
            });
        }
    };
    /**
     * @param {?} pageNumber
     * @return {?}
     */
    PaginationComponent.prototype.onChangePageNumber = /**
     * @param {?} pageNumber
     * @return {?}
     */
    function (pageNumber) {
        if (this.hasItems) {
            /** @type {?} */
            var maxItems = this.pagination.maxItems;
            /** @type {?} */
            var skipCount = (pageNumber - 1) * maxItems;
            this.pagination.skipCount = skipCount;
            this.handlePaginationEvent(PaginationComponent.ACTIONS.CHANGE_PAGE_NUMBER, {
                skipCount: skipCount,
                maxItems: maxItems
            });
        }
    };
    /**
     * @param {?} maxItems
     * @return {?}
     */
    PaginationComponent.prototype.onChangePageSize = /**
     * @param {?} maxItems
     * @return {?}
     */
    function (maxItems) {
        this.pagination.skipCount = 0;
        this.userPreferencesService.paginationSize = maxItems;
        this.handlePaginationEvent(PaginationComponent.ACTIONS.CHANGE_PAGE_SIZE, {
            skipCount: 0,
            maxItems: maxItems
        });
    };
    /**
     * @param {?} action
     * @param {?} params
     * @return {?}
     */
    PaginationComponent.prototype.handlePaginationEvent = /**
     * @param {?} action
     * @param {?} params
     * @return {?}
     */
    function (action, params) {
        var _a = PaginationComponent.ACTIONS, NEXT_PAGE = _a.NEXT_PAGE, PREV_PAGE = _a.PREV_PAGE, CHANGE_PAGE_NUMBER = _a.CHANGE_PAGE_NUMBER, CHANGE_PAGE_SIZE = _a.CHANGE_PAGE_SIZE;
        var _b = this, change = _b.change, changePageNumber = _b.changePageNumber, changePageSize = _b.changePageSize, nextPage = _b.nextPage, prevPage = _b.prevPage, pagination = _b.pagination;
        /** @type {?} */
        var paginationModel = Object.assign({}, pagination, params);
        if (action === NEXT_PAGE) {
            nextPage.emit(paginationModel);
        }
        if (action === PREV_PAGE) {
            prevPage.emit(paginationModel);
        }
        if (action === CHANGE_PAGE_NUMBER) {
            changePageNumber.emit(paginationModel);
        }
        if (action === CHANGE_PAGE_SIZE) {
            changePageSize.emit(paginationModel);
        }
        change.emit(params);
        if (this.target) {
            this.target.updatePagination(params);
        }
    };
    /**
     * @return {?}
     */
    PaginationComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.paginationSubscription) {
            this.paginationSubscription.unsubscribe();
        }
    };
    PaginationComponent.DEFAULT_PAGINATION = new Pagination({
        skipCount: 0,
        maxItems: 25,
        totalItems: 0
    });
    PaginationComponent.ACTIONS = {
        NEXT_PAGE: 'NEXT_PAGE',
        PREV_PAGE: 'PREV_PAGE',
        CHANGE_PAGE_SIZE: 'CHANGE_PAGE_SIZE',
        CHANGE_PAGE_NUMBER: 'CHANGE_PAGE_NUMBER'
    };
    PaginationComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-pagination',
                    host: { 'class': 'adf-pagination' },
                    template: "<ng-container *ngIf=\"hasItems\">\n    <div class=\"adf-pagination__block adf-pagination__range-block\">\n        <span class=\"adf-pagination__range\">\n            {{\n                'CORE.PAGINATION.ITEMS_RANGE' | translate: {\n                    range: range.join('-'),\n                    total: pagination.totalItems\n                }\n            }}\n        </span>\n    </div>\n\n    <div class=\"adf-pagination__block adf-pagination__perpage-block\">\n        <span>\n            {{ 'CORE.PAGINATION.ITEMS_PER_PAGE' | translate }}\n        </span>\n\n        <span class=\"adf-pagination__max-items\">\n            {{ pagination.maxItems }}\n        </span>\n\n        <button\n            mat-icon-button\n            [attr.aria-label]=\"'CORE.PAGINATION.ARIA.ITEMS_PER_PAGE' | translate\"\n            [matMenuTriggerFor]=\"pageSizeMenu\">\n            <mat-icon>arrow_drop_down</mat-icon>\n        </button>\n\n        <mat-menu #pageSizeMenu=\"matMenu\" class=\"adf-pagination__page-selector\">\n            <button\n                mat-menu-item\n                *ngFor=\"let pageSize of supportedPageSizes\"\n                (click)=\"onChangePageSize(pageSize)\">\n                {{ pageSize }}\n            </button>\n        </mat-menu>\n    </div>\n\n    <div class=\"adf-pagination__block adf-pagination__actualinfo-block\">\n        <span class=\"adf-pagination__current-page\">\n            {{ 'CORE.PAGINATION.CURRENT_PAGE' | translate: { number: current } }}\n        </span>\n\n        <button\n            mat-icon-button\n            [attr.aria-label]=\"'CORE.PAGINATION.ARIA.CURRENT_PAGE' | translate\"\n            [matMenuTriggerFor]=\"pagesMenu\"\n            *ngIf=\"pages.length > 1\">\n            <mat-icon>arrow_drop_down</mat-icon>\n        </button>\n\n        <span class=\"adf-pagination__total-pages\">\n            {{ 'CORE.PAGINATION.TOTAL_PAGES' | translate: { total: pages.length } }}\n        </span>\n\n        <mat-menu #pagesMenu=\"matMenu\" class=\"adf-pagination__page-selector\">\n            <button\n                mat-menu-item\n                *ngFor=\"let pageNumber of pages\"\n                (click)=\"onChangePageNumber(pageNumber)\">\n                {{ pageNumber }}\n            </button>\n        </mat-menu>\n    </div>\n\n    <div class=\"adf-pagination__block adf-pagination__controls-block\">\n        <button\n            class=\"adf-pagination__previous-button\"\n            mat-icon-button\n            [attr.aria-label]=\"'CORE.PAGINATION.ARIA.PREVIOUS_PAGE' | translate\"\n            [disabled]=\"isFirstPage\"\n            (click)=\"goPrevious()\">\n            <mat-icon>keyboard_arrow_left</mat-icon>\n        </button>\n\n        <button\n            class=\"adf-pagination__next-button\"\n            mat-icon-button\n            [attr.aria-label]=\"'CORE.PAGINATION.ARIA.NEXT_PAGE' | translate\"\n            [disabled]=\"isLastPage\"\n            (click)=\"goNext()\">\n            <mat-icon>keyboard_arrow_right</mat-icon>\n        </button>\n    </div>\n</ng-container>\n",
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    encapsulation: ViewEncapsulation.None,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    PaginationComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: UserPreferencesService }
    ]; };
    PaginationComponent.propDecorators = {
        target: [{ type: Input }],
        supportedPageSizes: [{ type: Input }],
        pagination: [{ type: Input }],
        change: [{ type: Output }],
        changePageNumber: [{ type: Output }],
        changePageSize: [{ type: Output }],
        nextPage: [{ type: Output }],
        prevPage: [{ type: Output }],
        isEmpty: [{ type: HostBinding, args: ['class.adf-pagination__empty',] }]
    };
    return PaginationComponent;
}());
export { PaginationComponent };
if (false) {
    /** @type {?} */
    PaginationComponent.DEFAULT_PAGINATION;
    /** @type {?} */
    PaginationComponent.ACTIONS;
    /**
     * Component that provides custom pagination support.
     * @type {?}
     */
    PaginationComponent.prototype.target;
    /**
     * An array of page sizes.
     * @type {?}
     */
    PaginationComponent.prototype.supportedPageSizes;
    /**
     * Pagination object.
     * @type {?}
     */
    PaginationComponent.prototype.pagination;
    /**
     * Emitted when pagination changes in any way.
     * @type {?}
     */
    PaginationComponent.prototype.change;
    /**
     * Emitted when the page number changes.
     * @type {?}
     */
    PaginationComponent.prototype.changePageNumber;
    /**
     * Emitted when the page size changes.
     * @type {?}
     */
    PaginationComponent.prototype.changePageSize;
    /**
     * Emitted when the next page is requested.
     * @type {?}
     */
    PaginationComponent.prototype.nextPage;
    /**
     * Emitted when the previous page is requested.
     * @type {?}
     */
    PaginationComponent.prototype.prevPage;
    /**
     * @type {?}
     * @private
     */
    PaginationComponent.prototype.paginationSubscription;
    /**
     * @type {?}
     * @private
     */
    PaginationComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    PaginationComponent.prototype.userPreferencesService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWNvcmUvIiwic291cmNlcyI6WyJwYWdpbmF0aW9uL3BhZ2luYXRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFDSCx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsaUJBQWlCLEVBQzFGLGlCQUFpQixFQUFhLFdBQVcsRUFDNUMsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBSTlDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUVwRztJQXlESSw2QkFBb0IsR0FBc0IsRUFBVSxzQkFBOEM7UUFBbEcsaUJBSUM7UUFKbUIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFBVSwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCOzs7O1FBeEJsRyxlQUFVLEdBQW9CLG1CQUFtQixDQUFDLGtCQUFrQixDQUFDOzs7O1FBSXJFLFdBQU0sR0FBa0MsSUFBSSxZQUFZLEVBQW1CLENBQUM7Ozs7UUFJNUUscUJBQWdCLEdBQWtDLElBQUksWUFBWSxFQUFtQixDQUFDOzs7O1FBSXRGLG1CQUFjLEdBQWtDLElBQUksWUFBWSxFQUFtQixDQUFDOzs7O1FBSXBGLGFBQVEsR0FBa0MsSUFBSSxZQUFZLEVBQW1CLENBQUM7Ozs7UUFJOUUsYUFBUSxHQUFrQyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUsxRSxJQUFJLENBQUMsc0JBQXNCLENBQUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLGNBQWMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxVQUFDLE9BQU87WUFDdEYsS0FBSSxDQUFD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UUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFO29CQUNuQyxtZ0dBQTBDO29CQUUxQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtvQkFDL0MsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7O2lCQUN4Qzs7OztnQkFqQkcsaUJBQWlCO2dCQVFaLHNCQUFzQjs7O3lCQTBCMUIsS0FBSztxQ0FJTCxLQUFLOzZCQUlMLEtBQUs7eUJBSUwsTUFBTTttQ0FJTixNQUFNO2lDQUlOLE1BQU07MkJBSU4sTUFBTTsyQkFJTixNQUFNOzBCQXFFTixXQUFXLFNBQUMsNkJBQTZCOztJQW9IOUMsMEJBQUM7Q0FBQSxBQTdPRCxJQTZPQztTQXJPWSxtQkFBbUI7OztJQUU1Qix1Q0FJRzs7SUFFSCw0QkFLRTs7Ozs7SUFHRixxQ0FDMkI7Ozs7O0lBRzNCLGlEQUM2Qjs7Ozs7SUFHN0IseUNBQ3FFOzs7OztJQUdyRSxxQ0FDNEU7Ozs7O0lBRzVFLCtDQUNzRjs7Ozs7SUFHdEYsNkNBQ29GOzs7OztJQUdwRix1Q0FDOEU7Ozs7O0lBRzlFLHVDQUM4RTs7Ozs7SUFFOUUscURBQTZDOzs7OztJQUVqQyxrQ0FBOEI7Ozs7O0lBQUUscURBQXNEIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCwgVmlld0VuY2Fwc3VsYXRpb24sXG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9uRGVzdHJveSwgSG9zdEJpbmRpbmdcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBhZ2luYXRpb24gfSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcbmltcG9ydCB7IFBhZ2luYXRlZENvbXBvbmVudCB9IGZyb20gJy4vcGFnaW5hdGVkLWNvbXBvbmVudC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUGFnaW5hdGlvbkNvbXBvbmVudEludGVyZmFjZSB9IGZyb20gJy4vcGFnaW5hdGlvbi1jb21wb25lbnQuaW50ZXJmYWNlJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUGFnaW5hdGlvbk1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL3BhZ2luYXRpb24ubW9kZWwnO1xuaW1wb3J0IHsgVXNlclByZWZlcmVuY2VzU2VydmljZSwgVXNlclByZWZlcmVuY2VWYWx1ZXMgfSBmcm9tICcuLi9zZXJ2aWNlcy91c2VyLXByZWZlcmVuY2VzLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1wYWdpbmF0aW9uJyxcbiAgICBob3N0OiB7ICdjbGFzcyc6ICdhZGYtcGFnaW5hdGlvbicgfSxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcGFnaW5hdGlvbi5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vcGFnaW5hdGlvbi5jb21wb25lbnQuc2NzcyddLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgUGFnaW5hdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBQYWdpbmF0aW9uQ29tcG9uZW50SW50ZXJmYWNlIHtcblxuICAgIHN0YXRpYyBERUZBVUxUX1BBR0lOQVRJT046IFBhZ2luYXRpb24gPSBuZXcgUGFnaW5hdGlvbih7XG4gICAgICAgIHNraXBDb3VudDogMCxcbiAgICAgICAgbWF4SXRlbXM6IDI1LFxuICAgICAgICB0b3RhbEl0ZW1zOiAwXG4gICAgfSk7XG5cbiAgICBzdGF0aWMgQUNUSU9OUyA9IHtcbiAgICAgICAgTkVYVF9QQUdFOiAnTkVYVF9QQUdFJyxcbiAgICAgICAgUFJFVl9QQUdFOiAnUFJFVl9QQUdFJyxcbiAgICAgICAgQ0hBTkdFX1BBR0VfU0laRTogJ0NIQU5HRV9QQUdFX1NJWkUnLFxuICAgICAgICBDSEFOR0VfUEFHRV9OVU1CRVI6ICdDSEFOR0VfUEFHRV9OVU1CRVInXG4gICAgfTtcblxuICAgIC8qKiBDb21wb25lbnQgdGhhdCBwcm92aWRlcyBjdXN0b20gcGFnaW5hdGlvbiBzdXBwb3J0LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgdGFyZ2V0OiBQYWdpbmF0ZWRDb21wb25lbnQ7XG5cbiAgICAvKiogQW4gYXJyYXkgb2YgcGFnZSBzaXplcy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHN1cHBvcnRlZFBhZ2VTaXplczogbnVtYmVyW107XG5cbiAgICAvKiogUGFnaW5hdGlvbiBvYmplY3QuICovXG4gICAgQElucHV0KClcbiAgICBwYWdpbmF0aW9uOiBQYWdpbmF0aW9uTW9kZWwgPSBQYWdpbmF0aW9uQ29tcG9uZW50LkRFRkFVTFRfUEFHSU5BVElPTjtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gcGFnaW5hdGlvbiBjaGFuZ2VzIGluIGFueSB3YXkuICovXG4gICAgQE91dHB1dCgpXG4gICAgY2hhbmdlOiBFdmVudEVtaXR0ZXI8UGFnaW5hdGlvbk1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8UGFnaW5hdGlvbk1vZGVsPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgcGFnZSBudW1iZXIgY2hhbmdlcy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBjaGFuZ2VQYWdlTnVtYmVyOiBFdmVudEVtaXR0ZXI8UGFnaW5hdGlvbk1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8UGFnaW5hdGlvbk1vZGVsPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgcGFnZSBzaXplIGNoYW5nZXMuICovXG4gICAgQE91dHB1dCgpXG4gICAgY2hhbmdlUGFnZVNpemU6IEV2ZW50RW1pdHRlcjxQYWdpbmF0aW9uTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxQYWdpbmF0aW9uTW9kZWw+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBuZXh0IHBhZ2UgaXMgcmVxdWVzdGVkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIG5leHRQYWdlOiBFdmVudEVtaXR0ZXI8UGFnaW5hdGlvbk1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8UGFnaW5hdGlvbk1vZGVsPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgcHJldmlvdXMgcGFnZSBpcyByZXF1ZXN0ZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgcHJldlBhZ2U6IEV2ZW50RW1pdHRlcjxQYWdpbmF0aW9uTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxQYWdpbmF0aW9uTW9kZWw+KCk7XG5cbiAgICBwcml2YXRlIHBhZ2luYXRpb25TdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSB1c2VyUHJlZmVyZW5jZXNTZXJ2aWNlOiBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMudXNlclByZWZlcmVuY2VzU2VydmljZS5zZWxlY3QoVXNlclByZWZlcmVuY2VWYWx1ZXMuUGFnaW5hdGlvblNpemUpLnN1YnNjcmliZSgocGFnU2l6ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uLm1heEl0ZW1zID0gcGFnU2l6ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdXBwb3J0ZWRQYWdlU2l6ZXMpIHtcbiAgICAgICAgICAgIHRoaXMuc3VwcG9ydGVkUGFnZVNpemVzID0gdGhpcy51c2VyUHJlZmVyZW5jZXNTZXJ2aWNlLnN1cHBvcnRlZFBhZ2VTaXplcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uU3Vic2NyaXB0aW9uID0gdGhpcy50YXJnZXQucGFnaW5hdGlvbi5zdWJzY3JpYmUoKHBhZ2luYXRpb246IFBhZ2luYXRpb25Nb2RlbCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2luYXRpb24uY291bnQgPT09IDAgJiYgIXRoaXMuaXNGaXJzdFBhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nb1ByZXZpb3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uID0gcGFnaW5hdGlvbjtcbiAgICAgICAgICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5wYWdpbmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnBhZ2luYXRpb24gPSBQYWdpbmF0aW9uQ29tcG9uZW50LkRFRkFVTFRfUEFHSU5BVElPTjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBsYXN0UGFnZSgpOiBudW1iZXIge1xuICAgICAgICBjb25zdCB7IG1heEl0ZW1zLCB0b3RhbEl0ZW1zIH0gPSB0aGlzLnBhZ2luYXRpb247XG5cbiAgICAgICAgcmV0dXJuICh0b3RhbEl0ZW1zICYmIG1heEl0ZW1zKVxuICAgICAgICAgICAgPyBNYXRoLmNlaWwodG90YWxJdGVtcyAvIG1heEl0ZW1zKVxuICAgICAgICAgICAgOiAxO1xuICAgIH1cblxuICAgIGdldCBjdXJyZW50KCk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHsgbWF4SXRlbXMsIHNraXBDb3VudCB9ID0gdGhpcy5wYWdpbmF0aW9uO1xuXG4gICAgICAgIHJldHVybiAoc2tpcENvdW50ICYmIG1heEl0ZW1zKVxuICAgICAgICAgICAgPyBNYXRoLmZsb29yKHNraXBDb3VudCAvIG1heEl0ZW1zKSArIDFcbiAgICAgICAgICAgIDogMTtcbiAgICB9XG5cbiAgICBnZXQgaXNMYXN0UGFnZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudCA9PT0gdGhpcy5sYXN0UGFnZTtcbiAgICB9XG5cbiAgICBnZXQgaXNGaXJzdFBhZ2UoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQgPT09IDE7XG4gICAgfVxuXG4gICAgZ2V0IG5leHQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNMYXN0UGFnZSA/IHRoaXMuY3VycmVudCA6IHRoaXMuY3VycmVudCArIDE7XG4gICAgfVxuXG4gICAgZ2V0IHByZXZpb3VzKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzRmlyc3RQYWdlID8gMSA6IHRoaXMuY3VycmVudCAtIDE7XG4gICAgfVxuXG4gICAgZ2V0IGhhc0l0ZW1zKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uICYmIHRoaXMucGFnaW5hdGlvbi5jb3VudCA+IDA7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5hZGYtcGFnaW5hdGlvbl9fZW1wdHknKVxuICAgIGdldCBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIXRoaXMuaGFzSXRlbXM7XG4gICAgfVxuXG4gICAgZ2V0IHJhbmdlKCk6IG51bWJlcltdIHtcbiAgICAgICAgY29uc3QgeyBza2lwQ291bnQsIG1heEl0ZW1zLCB0b3RhbEl0ZW1zIH0gPSB0aGlzLnBhZ2luYXRpb247XG4gICAgICAgIGNvbnN0IHsgaXNMYXN0UGFnZSB9ID0gdGhpcztcblxuICAgICAgICBjb25zdCBzdGFydCA9IHRvdGFsSXRlbXMgPyBza2lwQ291bnQgKyAxIDogMDtcbiAgICAgICAgY29uc3QgZW5kID0gaXNMYXN0UGFnZSA/IHRvdGFsSXRlbXMgOiBza2lwQ291bnQgKyBtYXhJdGVtcztcblxuICAgICAgICByZXR1cm4gW3N0YXJ0LCBlbmRdO1xuICAgIH1cblxuICAgIGdldCBwYWdlcygpOiBudW1iZXJbXSB7XG4gICAgICAgIHJldHVybiBBcnJheSh0aGlzLmxhc3RQYWdlKVxuICAgICAgICAgICAgLmZpbGwoJ24nKVxuICAgICAgICAgICAgLm1hcCgoaXRlbSwgaW5kZXgpID0+IChpbmRleCArIDEpKTtcbiAgICB9XG5cbiAgICBnb05leHQoKSB7XG4gICAgICAgIGlmICh0aGlzLmhhc0l0ZW1zKSB7XG4gICAgICAgICAgICBjb25zdCBtYXhJdGVtcyA9IHRoaXMucGFnaW5hdGlvbi5tYXhJdGVtcztcbiAgICAgICAgICAgIGNvbnN0IHNraXBDb3VudCA9ICh0aGlzLm5leHQgLSAxKSAqIG1heEl0ZW1zO1xuICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnNraXBDb3VudCA9IHNraXBDb3VudDtcblxuICAgICAgICAgICAgdGhpcy5oYW5kbGVQYWdpbmF0aW9uRXZlbnQoUGFnaW5hdGlvbkNvbXBvbmVudC5BQ1RJT05TLk5FWFRfUEFHRSwge1xuICAgICAgICAgICAgICAgIHNraXBDb3VudCxcbiAgICAgICAgICAgICAgICBtYXhJdGVtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnb1ByZXZpb3VzKCkge1xuICAgICAgICBpZiAodGhpcy5oYXNJdGVtcykge1xuICAgICAgICAgICAgY29uc3QgbWF4SXRlbXMgPSB0aGlzLnBhZ2luYXRpb24ubWF4SXRlbXM7XG4gICAgICAgICAgICBjb25zdCBza2lwQ291bnQgPSAodGhpcy5wcmV2aW91cyAtIDEpICogbWF4SXRlbXM7XG4gICAgICAgICAgICB0aGlzLnBhZ2luYXRpb24uc2tpcENvdW50ID0gc2tpcENvdW50O1xuXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVBhZ2luYXRpb25FdmVudChQYWdpbmF0aW9uQ29tcG9uZW50LkFDVElPTlMuUFJFVl9QQUdFLCB7XG4gICAgICAgICAgICAgICAgc2tpcENvdW50LFxuICAgICAgICAgICAgICAgIG1heEl0ZW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uQ2hhbmdlUGFnZU51bWJlcihwYWdlTnVtYmVyOiBudW1iZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzSXRlbXMpIHtcbiAgICAgICAgICAgIGNvbnN0IG1heEl0ZW1zID0gdGhpcy5wYWdpbmF0aW9uLm1heEl0ZW1zO1xuICAgICAgICAgICAgY29uc3Qgc2tpcENvdW50ID0gKHBhZ2VOdW1iZXIgLSAxKSAqIG1heEl0ZW1zO1xuICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnNraXBDb3VudCA9IHNraXBDb3VudDtcblxuICAgICAgICAgICAgdGhpcy5oYW5kbGVQYWdpbmF0aW9uRXZlbnQoUGFnaW5hdGlvbkNvbXBvbmVudC5BQ1RJT05TLkNIQU5HRV9QQUdFX05VTUJFUiwge1xuICAgICAgICAgICAgICAgIHNraXBDb3VudCxcbiAgICAgICAgICAgICAgICBtYXhJdGVtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkNoYW5nZVBhZ2VTaXplKG1heEl0ZW1zOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnNraXBDb3VudCA9IDA7XG4gICAgICAgIHRoaXMudXNlclByZWZlcmVuY2VzU2VydmljZS5wYWdpbmF0aW9uU2l6ZSA9IG1heEl0ZW1zO1xuICAgICAgICB0aGlzLmhhbmRsZVBhZ2luYXRpb25FdmVudChQYWdpbmF0aW9uQ29tcG9uZW50LkFDVElPTlMuQ0hBTkdFX1BBR0VfU0laRSwge1xuICAgICAgICAgICAgc2tpcENvdW50OiAwLFxuICAgICAgICAgICAgbWF4SXRlbXNcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaGFuZGxlUGFnaW5hdGlvbkV2ZW50KGFjdGlvbjogc3RyaW5nLCBwYXJhbXM6IFBhZ2luYXRpb25Nb2RlbCkge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBORVhUX1BBR0UsXG4gICAgICAgICAgICBQUkVWX1BBR0UsXG4gICAgICAgICAgICBDSEFOR0VfUEFHRV9OVU1CRVIsXG4gICAgICAgICAgICBDSEFOR0VfUEFHRV9TSVpFXG4gICAgICAgIH0gPSBQYWdpbmF0aW9uQ29tcG9uZW50LkFDVElPTlM7XG5cbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgY2hhbmdlLFxuICAgICAgICAgICAgY2hhbmdlUGFnZU51bWJlcixcbiAgICAgICAgICAgIGNoYW5nZVBhZ2VTaXplLFxuICAgICAgICAgICAgbmV4dFBhZ2UsXG4gICAgICAgICAgICBwcmV2UGFnZSxcbiAgICAgICAgICAgIHBhZ2luYXRpb25cbiAgICAgICAgfSA9IHRoaXM7XG5cbiAgICAgICAgY29uc3QgcGFnaW5hdGlvbk1vZGVsOiBQYWdpbmF0aW9uTW9kZWwgPSBPYmplY3QuYXNzaWduKHt9LCBwYWdpbmF0aW9uLCBwYXJhbXMpO1xuXG4gICAgICAgIGlmIChhY3Rpb24gPT09IE5FWFRfUEFHRSkge1xuICAgICAgICAgICAgbmV4dFBhZ2UuZW1pdChwYWdpbmF0aW9uTW9kZWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gUFJFVl9QQUdFKSB7XG4gICAgICAgICAgICBwcmV2UGFnZS5lbWl0KHBhZ2luYXRpb25Nb2RlbCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWN0aW9uID09PSBDSEFOR0VfUEFHRV9OVU1CRVIpIHtcbiAgICAgICAgICAgIGNoYW5nZVBhZ2VOdW1iZXIuZW1pdChwYWdpbmF0aW9uTW9kZWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gQ0hBTkdFX1BBR0VfU0laRSkge1xuICAgICAgICAgICAgY2hhbmdlUGFnZVNpemUuZW1pdChwYWdpbmF0aW9uTW9kZWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgY2hhbmdlLmVtaXQocGFyYW1zKTtcblxuICAgICAgICBpZiAodGhpcy50YXJnZXQpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0LnVwZGF0ZVBhZ2luYXRpb24ocGFyYW1zKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5wYWdpbmF0aW9uU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnBhZ2luYXRpb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==